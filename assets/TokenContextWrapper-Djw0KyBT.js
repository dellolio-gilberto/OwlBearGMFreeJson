import{S as r,u as h,j as l}from"./main-D4A3q17J.js";import{M as u,i as o,aW as p,D as g,r as k,O as c}from"./diceHelper-DyDajmT-.js";const f=u()(i=>({tokens:null,changeList:[],setTokens:d=>i(n=>{const s=new Map,a=[];return d.forEach(e=>{if(o in e.metadata){const t=e.metadata[o];n.tokens&&n.tokens.has(e.id)?(s.set(e.id,{data:t,item:e}),p(t,n.tokens.get(e.id).data)?e.createdUserId!==n.tokens.get(e.id).item.createdUserId?a.push({changeType:"owner-changed",id:e.id,oldData:null,newData:null}):e.visible!==n.tokens.get(e.id).item.visible?a.push({changeType:"visibility-changed",id:e.id,oldData:null,newData:null}):g.isEqual(e.position,n.tokens.get(e.id).item.position)||a.push({changeType:"position-changed",id:e.id,oldData:null,newData:null}):a.push({changeType:"update-metadata",id:e.id,oldData:n.tokens.get(e.id).data,newData:t})):(a.push({changeType:"new",id:e.id,oldData:null,newData:t}),s.set(e.id,{data:t,item:e}))}}),n.tokens&&[...n.tokens].filter(e=>!s.has(e[0])).forEach(e=>{a.push({changeType:"delete",id:e[0],oldData:e[1].data,newData:null})}),a.length>0?{changeList:a,tokens:s}:n})})),D=i=>{const{isReady:d}=r(),n=f(h(a=>a.setTokens)),s=async()=>{const a=await c.scene.items.getItems(e=>o in e.metadata&&e.metadata[o].hpTrackerActive);n(a)};return k.useEffect(()=>{if(d)return s(),c.scene.items.onChange(async a=>{const e=a.filter(t=>o in t.metadata&&t.metadata[o].hpTrackerActive);n(Array.from(e))})},[d]),l.jsx(l.Fragment,{children:i.children})};export{D as T,f as u};
