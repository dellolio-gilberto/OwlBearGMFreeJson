import{r as x,i as c,H as f,g as C,O as H,h as N,I as k,R as M}from"./diceHelper-2N3CDH4Q.js";import{S as P,j as t,C as w,L as I,u as y,b as R,a as S,R as T}from"./main-Lqi2BWae.js";import{t as b,b as A,g as O,c as B,d as E,e as L,f as D,h as F,i as W,j as q,T as G}from"./Token-s6Nmlwl7.js";import{T as K,u as v}from"./TokenContextWrapper-C3wxQVSq.js";import{H as V,M as j,A as $,I as z,P as J}from"./usePfApi-CVdqn_vY.js";import"./DiceButtonWrapper-DnQmdp51.js";const Q=()=>{const[o,r]=x.useState([]),{isReady:a}=P(),i=async()=>{const p=await H.player.getSelection();r(p??[])};return x.useEffect(()=>{a&&i()},[a]),t.jsx(w,{component:"popover",children:t.jsx(K,{children:o.length===1?t.jsx(X,{id:o[0]}):o.length>1?t.jsx(U,{ids:o}):t.jsx(I,{className:"popover-spinner"})})})},U=({ids:o})=>{const r=v(y(n=>n.tokens)),a=x.useRef(null),{room:i}=R(),p=S(),e=r?[...r.values()].filter(n=>o.includes(n.item.id)).map(n=>n.item):[],m=async n=>{await N(e.map(d=>d.id),d=>{d.forEach(l=>{if(c in l.metadata){const s=l.metadata[c],u=s.hp+n;u<s.hp&&s.stats.tempHp&&s.stats.tempHp>0&&(s.stats.tempHp=Math.max(s.stats.tempHp-(s.hp-u),0)),s.hp=Math.min(i!=null&&i.allowNegativeNumbers?u:Math.max(u,0),s.maxHp+(s.stats.tempHp||0));const g=e.find(h=>h.id===l.id);if(g&&c in g.metadata){const h=g.metadata[c];k(g,{...h,hp:s.hp,stats:{...h.stats,tempHp:s.stats.tempHp}})}l.metadata[c]={...s}}})})};return t.jsxs("div",{className:"popover multi-selection",children:[t.jsx("ul",{className:"token-names",children:e==null?void 0:e.map((n,d)=>{if(c in n.metadata){const l=n.metadata[c];return t.jsx("li",{className:"token-entry",style:{background:`linear-gradient(to right, ${f(l,"0.4")}, #1C1B22 90%, #1C1B22 )`},children:C(n)},d)}})}),t.jsxs("div",{className:"changes",children:[t.jsxs("div",{className:"hp",children:[t.jsx("input",{className:"input",ref:a,type:"number",defaultValue:0}),t.jsx("button",{className:"heal",title:"heal",onClick:()=>{a.current&&m(parseInt(a.current.value))},children:"Heal"}),t.jsx("button",{className:"damage",title:"damage",onClick:()=>{a.current&&m(parseInt(a.current.value)*-1)},children:"Damage"})]}),p.role==="GM"?t.jsxs("div",{className:"settings",children:[t.jsxs("div",{className:"setting",children:[t.jsx(V,{percent:100,name:"hp",color:"#888888"}),t.jsx(j,{onClick:async()=>{await b(e,i)},onContextMenu:async()=>{await A(e)},active:O(e),players:B(e),tooltip:"Show HP on map (right click for players)"})]}),t.jsxs("div",{className:"setting",children:[t.jsx($,{}),t.jsx(j,{onClick:async()=>{await E(e)},onContextMenu:async()=>{await L(e)},active:D(e),players:F(e),tooltip:"Show AC on map (right click for players)"})]}),t.jsxs("div",{className:"setting",children:[t.jsx(z,{}),t.jsx(J,{active:W(e),onClick:()=>{q(e)}})]})]}):null]})]})},X=o=>{const r=o.id,a=v(y(e=>{var m;return(m=e.tokens)==null?void 0:m.get(o.id)})),i=a==null?void 0:a.data,p=a==null?void 0:a.item;return r&&i&&p?t.jsx("div",{className:"popover",children:t.jsx(G,{id:r,popover:!0,selected:!1})}):null},Y=T.createRoot(document.querySelector("#app"));Y.render(M.createElement(Q));
