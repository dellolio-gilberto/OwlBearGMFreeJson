import{Q as as,t as Te,w as ls,x as cs,y as rs,u as L,j as e,L as te,b as K,M as os,r as ds,a as ne}from"./main-DYu6tYf4.js";import{u as ke}from"./TokenContextWrapper-Cemxqcxe.js";import{r as b,ax as us,g as ze,ay as ms,Q as Se,h as qe,i as le,az as Re,L as hs,N as xs,aA as X,D as w,M as Oe,P as Ae,S as Ie,aB as ce,e as ue,aC as Pe,aD as js,aE as ps,aF as Ee,aG as fs,c as gs,d as me,aH as Le,aI as vs,f as _e,O as U,at as re,a6 as bs,aJ as Be,aK as ae,aL as Me,j as He,aM as Je,k as Ve,l as We,a as _s,aN as Ns,aO as Ke,a3 as ys,a5 as ks,aP as Ss}from"./diceHelper-DyDajmT-.js";import{e as Qe,g as Ge,f as Ue,h as ws,i as $s,j as Cs}from"./usePfApi-CFFrf9IC.js";import{j as V,i as O,k as I,l as ee,a as Ds,g as oe}from"./DiceButtonWrapper-Mk8GPeRD.js";import{R as Ts}from"./RollLog-Cm9qf6a_.js";var Rs=class extends as{constructor(s,n){super(s,n)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(s){super.setOptions({...s,behavior:Te()})}getOptimisticResult(s){return s.behavior=Te(),super.getOptimisticResult(s)}fetchNextPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"backward"}}})}createResult(s,n){var j,x;const{state:i}=s,a=super.createResult(s,n),{isFetching:t,isRefetching:h,isError:l,isRefetchError:c}=a,o=(x=(j=i.fetchMeta)==null?void 0:j.fetchMore)==null?void 0:x.direction,d=l&&o==="forward",p=t&&o==="forward",r=l&&o==="backward",m=t&&o==="backward";return{...a,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:ls(n,i.data),hasPreviousPage:cs(n,i.data),isFetchNextPageError:d,isFetchingNextPage:p,isFetchPreviousPageError:r,isFetchingPreviousPage:m,isRefetchError:c&&!d&&!r,isRefetching:h&&!p&&!m}}};function Ze(s,n){return rs(s,Rs)}const Xe=b.createContext(null),P=()=>{const s=b.useContext(Xe);if(s===null)throw new Error("E5StatblockContext is not set");return s},Es=s=>{const n=ke(L(i=>{var a;return(a=i.tokens)==null?void 0:a.get(s.itemId)}));if(n){const i=n.data,a=n.item,t=us(i,s.statblock.stats,s.statblock.equipment||[]);return e.jsx(Xe.Provider,{value:{tokenName:ze(a),data:i,item:a,statblock:s.statblock,itemId:s.itemId,stats:{strength:t.stats.strength,dexterity:t.stats.dexterity,constitution:t.stats.constitution,wisdom:t.stats.wisdom,intelligence:t.stats.intelligence,charisma:t.stats.charisma},equipmentBonuses:t},children:s.children})}return e.jsx(te,{})},Ls="_statblock_14qyr_1",Fs="_title_14qyr_11",zs="_name_14qyr_20",qs="_note_14qyr_27",Os="_headerActions_14qyr_33",W={statblock:Ls,title:Fs,name:zs,note:qs,headerActions:Os},As="_values_1bw4j_1",Is={values:As},Ps=()=>{const{item:s}=P();return e.jsxs("div",{className:Is.values,children:[e.jsx(Qe,{id:s.id}),e.jsx(Ge,{id:s.id})]})},Bs="_content_19vac_10",Ms="_tabs_19vac_27",Hs="_tab_19vac_27",Js="_activeTab_19vac_51",Vs="_wrapper_19vac_57",Ws="_actionWrapper_19vac_67",Z={content:Bs,tabs:Ms,tab:Hs,activeTab:Js,wrapper:Vs,actionWrapper:Ws},Ks="_lineBreak_1ql1p_1",Qs="_line_1ql1p_1",Gs="_fancyLine_1ql1p_25",Us="_decoration_1ql1p_30",de={lineBreak:Ks,line:Qs,fancyLine:Gs,decoration:Us},E=()=>e.jsx("div",{className:de.lineBreak,children:e.jsx("span",{className:de.line})}),M=()=>e.jsx("div",{className:de.fancyLine,children:e.jsx("span",{className:de.decoration})}),Zs="_general_bqxrl_1",Xs="_hitDiceWrapper_bqxrl_5",Ys="_hitDice_bqxrl_5",et="_stats_bqxrl_15",st="_savingThrows_bqxrl_22",tt="_stat_bqxrl_15",nt="_name_bqxrl_35",it="_value_bqxrl_48",at="_header_bqxrl_64",lt="_infos_bqxrl_75",ct="_ac_bqxrl_82",H={general:Zs,hitDiceWrapper:Xs,hitDice:Ys,stats:et,savingThrows:st,stat:tt,name:nt,value:it,header:at,infos:lt,ac:ct},he=({about:s,slug:n,statblock:i,stats:a,context:t,defaultOpen:h,hideTitle:l})=>{const c=K.getState().room,[o,d]=ms(`${Se}.about.${n}`,!!h);return s?e.jsxs("div",{className:`about ${l?"no-title":""}`,children:[l?null:e.jsx("h3",{children:"About"}),e.jsx("button",{className:`expand ${o?"open":null}`,onClick:()=>d(!o)}),e.jsx("div",{className:`about-content-wrapper ${o?"open":"hidden"}`,children:e.jsx("div",{className:"about-content",children:e.jsx(V,{text:s,context:t||(i==null?void 0:i.name)||"Custom Roll",statblock:i==null?void 0:i.name,stats:a||{strength:(i==null?void 0:i.stats.strength)||0,dexterity:(i==null?void 0:i.stats.dexterity)||0,constitution:(i==null?void 0:i.stats.constitution)||0,intelligence:(i==null?void 0:i.stats.intelligence)||0,wisdom:(i==null?void 0:i.stats.wisdom)||0,charisma:(i==null?void 0:i.stats.charisma)||0},proficiencyBonus:(c==null?void 0:c.ruleset)==="e5"?i.proficiency_bonus:null})})})]}):null},rt="_box_9rgpd_1",ot="_used_9rgpd_16",dt="_unused_9rgpd_22",pe={box:rt,used:ot,unused:dt},ut=({limitValues:s,itemId:n})=>e.jsx(e.Fragment,{children:Array(s.max).fill(0).map((i,a)=>{const t=a<s.used;return e.jsx("div",{className:`limit-use ${t?"used":""}`,onClick:async()=>{await qe([n],h=>{h.forEach(l=>{var c;if(l){const o=l.metadata[le];if(o){const d=(c=o.stats.limits)==null?void 0:c.findIndex(p=>p.id===s.id);d!==void 0&&(l.metadata[le].stats.limits[d].used=t?s.used-1:s.used+1)}}})})}},a)})}),mt=({limitValues:s,itemId:n})=>{const i=s.max-s.used,a=async l=>{await qe([n],c=>{c.forEach(o=>{var d;if(o){const p=o.metadata[le];if(p){const r=(d=p.stats.limits)==null?void 0:d.findIndex(m=>m.id===s.id);r!==void 0&&(o.metadata[le].stats.limits[r].used=Math.max(Math.min(s.used+l,s.max),0))}}})})},t=Re(async()=>await a(5),async()=>await a(1),500),h=Re(async()=>await a(-5),async()=>await a(-1),500);return e.jsxs("div",{className:`${pe.box} limit-box`,children:[s.used>0?e.jsx(O,{content:"Click to reduce uses by one (Long press for -5)",children:e.jsx("div",{className:pe.used,style:{flexGrow:s.used},...h,children:s.used})}):null,i>0?e.jsx(O,{content:"Click to mark on use (Long press for +5)",children:e.jsx("div",{className:pe.unused,style:{flexGrow:i},...t,children:i})}):null]})},Y=({limit:s,title:n,limitValues:i,itemId:a,hideReset:t,hideDescription:h})=>{const l=()=>n==="name"?e.jsx("h4",{children:s.name}):n==="uses"?e.jsx("b",{children:"uses"}):null;return e.jsxs("div",{className:"limit",children:[e.jsxs("div",{className:"limit-heading",children:[l(),e.jsx("div",{className:"limit-uses",children:i.max>10?e.jsx(mt,{limitValues:i,itemId:a}):e.jsx(ut,{limitValues:i,itemId:a})})]}),s.description&&!h?e.jsx(os,{remarkPlugins:[ds],children:s.description}):null,s.resets&&!t?e.jsxs("div",{children:[e.jsx("b",{children:"Resets after:"})," ",s.resets.join(", ")]}):null]})},ht=["strength","dexterity","constitution","intelligence","wisdom","charisma"],xt=()=>{var d,p;const{statblock:s,stats:n,tokenName:i,item:a,equipmentBonuses:t,data:h}=P(),l=(d=h.stats.limits)==null?void 0:d.find(r=>r.id==="Hit Dice");let c=null,o=null;if(s.hp.hit_dice)try{c={name:"Hit Dice",uses:Number(s.hp.hit_dice.split("d")[0]),resets:["Long Rest"]},o=s.hp.hit_dice.split("d")[1].split("+")[0]}catch{}return e.jsxs("div",{className:H.general,children:[e.jsxs("div",{className:H.ac,children:[e.jsx("b",{children:"Armor Class:"})," ",e.jsx(Ue,{id:a.id,hideExtras:!0}),s.armor_class.special?e.jsxs("span",{children:["(",s.armor_class.special,")"]}):null]}),e.jsxs("div",{children:[e.jsx("b",{children:"Speed:"})," ",Object.entries(s.speed).map(([r,m])=>{if(r!=="notes"){const f=t.statblockBonuses.speed[r];if(m||f)return`${r} ${m+f} ft.`}return null}).filter(r=>!!r).join(", ")]}),s.proficiency_bonus?e.jsxs("div",{children:[e.jsx("b",{children:"Proficiency Bonus:"})," ",s.proficiency_bonus]}):null,e.jsx(E,{}),c&&l&&o?e.jsxs("div",{className:H.hitDiceWrapper,children:[e.jsx("h3",{className:H.hitDice,children:"Hit Dice"}),e.jsx(Y,{limit:c,title:"uses",limitValues:l,itemId:a.id,hideReset:!0}),e.jsx("div",{className:"dice-button-wrapper",children:e.jsx(I,{dice:`1d${o}+CON`,text:`1d${o}+CON`,context:"Hit Dice",stats:n,statblock:i,onRoll:async r=>{let m=0;try{r&&"total"in r?m=r.total:r&&"values"in r&&(m=r.values.map(f=>f.value).reduce((f,j)=>f+j,0))}catch{}if(m){const f={...h,hp:Math.min(h.hp+m,h.maxHp)};await hs(a,f),await xs(f,[a.id])}await X(a.id,l)},limitReached:c.uses===l.used,proficiencyBonus:s.proficiency_bonus})}),e.jsx(E,{})]}):null,e.jsxs("ul",{className:H.stats,children:[e.jsxs("li",{className:H.header,children:[e.jsx("div",{}),e.jsx("div",{children:"Check"}),e.jsx("div",{children:"Save"})]}),ht.map(r=>{const m=`${r}_save`,f=t.stats[r],j=Math.floor((f-10)/2),x=s.saving_throws[m]||j,u=Object.hasOwn(t.statblockBonuses.savingThrows,m)?x+t.statblockBonuses.savingThrows[m]:x;return e.jsxs("li",{className:H.stat,children:[e.jsxs("div",{className:H.name,children:[e.jsx("span",{children:r.substring(0,3)}),e.jsx("span",{children:f})]}),e.jsxs("div",{className:H.value,children:[e.jsx(I,{dice:`d20${Intl.NumberFormat("en-US",{signDisplay:"always"}).format(Math.floor((f-10)/2))}`,text:Intl.NumberFormat("en-US",{signDisplay:"always"}).format(Math.floor((f-10)/2)),stats:n,context:`${w.capitalize(r)}: Check`,statblock:i,proficiencyBonus:s.proficiency_bonus}),e.jsx(I,{dice:`d20${Intl.NumberFormat("en-US",{signDisplay:"always"}).format(Math.floor(u))}`,text:Intl.NumberFormat("en-US",{signDisplay:"always"}).format(Math.floor(u)),stats:n,context:`${w.capitalize(r.substring(0,3))}: Save`,statblock:i,proficiencyBonus:s.proficiency_bonus})]})]},r)})]}),e.jsx(E,{}),s.limits&&s.limits.length>0?e.jsxs("div",{children:[e.jsx("h3",{className:H.hitDice,children:"Limits"}),s.limits.map((r,m)=>{var j,x;return((j=h.stats.limits)==null?void 0:j.find(u=>u.id===r.name))?e.jsxs("div",{children:[e.jsx(Y,{limit:r,title:"name",limitValues:(x=h.stats.limits)==null?void 0:x.find(u=>u.id===r.name),itemId:a.id}),e.jsx(E,{})]},m):null})]}):null,e.jsxs("ul",{className:H.infos,children:[s.senses||t.statblockBonuses.senses?e.jsxs("li",{children:[e.jsx("b",{children:"Senses:"})," ",(s.senses||[]).concat(...t.statblockBonuses.senses).join(", ")]}):null,e.jsxs("li",{children:[e.jsx("b",{children:"Languages:"})," ",(p=s.languages)==null?void 0:p.join(", ")]}),s.challenge_rating||!w.isNull(s.cr)?e.jsxs("li",{children:[e.jsx("b",{children:"Challenge:"})," ",s.cr," ",s.challenge_rating?`(${s.challenge_rating})`:null]}):null,s.damage_vulnerabilities||t.statblockBonuses.damageVulnerabilities?e.jsxs("li",{children:[e.jsx("b",{children:"Damage Vulnerabilities:"})," ",s.damage_vulnerabilities," ",t.statblockBonuses.damageVulnerabilities]}):null,s.damage_resistances||t.statblockBonuses.damageResistances?e.jsxs("li",{children:[e.jsx("b",{children:"Damage Resistances:"})," ",s.damage_resistances," ",t.statblockBonuses.damageResistances]}):null,s.damage_immunities||t.statblockBonuses.damageImmunities?e.jsxs("li",{children:[e.jsx("b",{children:"Damage Immunities:"})," ",s.damage_immunities," ",t.statblockBonuses.damageResistances]}):null,s.condition_immunities||t.statblockBonuses.conditionImmunities?e.jsxs("li",{children:[e.jsx("b",{children:"Condition Immunities:"})," ",s.condition_immunities," ",t.statblockBonuses.conditionImmunities]}):null]}),e.jsx(E,{}),e.jsx(he,{about:s.about,slug:s.slug,statblock:s,stats:n,context:s.name})]})},jt="_heading_quifz_1",pt="_skills_quifz_7",ft="_skill_quifz_7",fe={heading:jt,skills:pt,skill:ft},gt=(s,n)=>{let i=0;return s==="acrobatics"?i=n.dexterity:s==="animal_handling"?i=n.wisdom:s==="arcana"?i=n.intelligence:s==="athletics"?i=n.strength:s==="deception"?i=n.charisma:s==="history"?i=n.intelligence:s==="insight"?i=n.wisdom:s==="intimidation"?i=n.charisma:s==="investigation"?i=n.intelligence:s==="medicine"?i=n.wisdom:s==="nature"?i=n.intelligence:s==="perception"?i=n.wisdom:s==="performance"||s==="persuasion"?i=n.charisma:s==="religion"?i=n.intelligence:s==="sleight_of_hand"||s==="stealth"?i=n.dexterity:s==="survival"&&(i=n.wisdom),Math.floor((i-10)/2)},vt=()=>{const{statblock:s,stats:n,tokenName:i,equipmentBonuses:a}=P();return e.jsxs("div",{children:[e.jsx("h3",{className:fe.heading,children:"Skills"}),e.jsx(M,{}),e.jsx("ul",{className:fe.skills,children:s.skills?Object.entries(s.skills).map(([t,h])=>{const l=(h||gt(t,n))+a.statblockBonuses.skills[t]+(a.statblockBonuses.proficiencies.includes(t)?s.proficiency_bonus:0);return e.jsxs("li",{className:fe.skill,style:{background:`linear-gradient(to right, #3f3f3f, transparent  ${l/10*100}%)`},children:[e.jsx("b",{children:w.capitalize(t.replaceAll("_"," "))}),e.jsx(I,{dice:`d20${Intl.NumberFormat("en-US",{signDisplay:"always"}).format(Math.floor(l))}`,text:Intl.NumberFormat("en-US",{signDisplay:"always"}).format(Math.floor(l)),stats:n,context:`${w.capitalize(t)}: Check`,statblock:i,proficiencyBonus:s.proficiency_bonus})]},t)}):null})]})},xe=Oe()(Ae(s=>({activeTab:{},setActiveTab:(n,i)=>s(a=>{const t=a.activeTab;return a.activeTab[n]!==i?(t[n]=i,{activeTab:t}):a})}),{name:`${Se}.activeTab`,storage:Ie(()=>localStorage)})),bt="_heading_1jstp_1",_t="_itemName_1jstp_7",Fe={heading:bt,itemName:_t},ge=({ability:s,proficient:n,range:i})=>{var x;const{item:a,stats:t,data:h,tokenName:l,statblock:c}=P(),o=(x=h.stats.limits)==null?void 0:x.find(u=>{var g;return u.id===((g=s.limit)==null?void 0:g.name)}),d=o&&o.max===o.used,p=b.useMemo(()=>{let u={bonus:void 0,stat:""};const g=(v,S,y)=>{const D=Math.floor((S-10)/2);return w.isUndefined(y.bonus)||D>y.bonus?{bonus:D,stat:v}:y};return s.stat_bonus&&s.stat_bonus.forEach(v=>{v==="STR"?u=g(v,t.strength,u):v==="DEX"?u=g(v,t.dexterity,u):v==="CON"?u=g(v,t.constitution,u):v==="INT"?u=g(v,t.intelligence,u):v==="WIS"?u=g(v,t.wisdom,u):v==="CHA"&&(u=g(v,t.charisma,u))}),u},[s,t]),r=s.attack_bonus||0,m=n&&c.proficiency_bonus?c.proficiency_bonus:0,f=(p.bonus||0)+r+m,j=b.useMemo(()=>{const u=[];return r&&u.push(`Attack: ${r}`),p.bonus&&u.push(`Stat (${p.stat}): ${p.bonus}`),m&&u.push(`Proficiency: ${m}`),u.join(", ")},[r,p,m]);return s.needs_proficiency&&!n?null:e.jsxs("li",{className:"e5-ability",children:[e.jsxs("span",{className:"ability-info",children:[e.jsx("b",{className:"ability-name",children:s.name}),i?e.jsxs("div",{children:[e.jsx("b",{children:"Range: "}),e.jsx("span",{children:i.replace("units","ft")})]}):null,s.limit&&h.stats.limits&&o?e.jsx(Y,{limit:s.limit,title:"uses",limitValues:o,itemId:a.id}):null]}),e.jsx(he,{slug:s.name,statblock:c,stats:t,about:s.desc||"",context:w.capitalize(s.name),defaultOpen:!0,hideTitle:!0}),e.jsxs("span",{className:"ability-extra-info",children:[s.stat_bonus&&s.stat_bonus.length>0||r!=0?e.jsxs("span",{className:"extra-info-with-button",children:[e.jsx("i",{children:"Hit:"}),e.jsx(O,{content:j,duration:200,delay:1e3,children:e.jsx("span",{children:e.jsx(I,{dice:`d20+${f}`,text:`+${f}`,context:`${w.capitalize(s.name)}: To Hit`,statblock:l,stats:t,onRoll:async()=>{await X(a.id,o)},limitReached:d,proficiencyBonus:c.proficiency_bonus})})})]}):null,s.damage_dice?e.jsxs("span",{className:"extra-info-with-button",children:[e.jsx("i",{children:"Damage:"}),w.isInteger(Number(s.damage_dice))?e.jsx("b",{children:s.damage_dice}):e.jsx(I,{dice:s.damage_dice,text:s.damage_dice,context:`${w.capitalize(s.name)}: Damage`,statblock:l,stats:t,onRoll:s.attack_bonus?void 0:async()=>{await X(a.id,o)},limitReached:s.attack_bonus?void 0:d,damageDie:!0,proficiencyBonus:c.proficiency_bonus})]}):null]})]},s.name)},Nt="_itemCharges_vtf5f_1",yt={itemCharges:Nt},we=({equippedItem:s,showReset:n})=>{var h;const{data:i,item:a}=P(),t=(h=i.stats.limits)==null?void 0:h.find(l=>{var c;return l.id===((c=s==null?void 0:s.charges)==null?void 0:c.name)});return e.jsx(e.Fragment,{children:s!=null&&s.charges&&t?e.jsxs("div",{className:yt.itemCharges,children:["Charges:",e.jsx(Y,{limit:s.charges,title:"none",hideReset:!n,hideDescription:!0,limitValues:t,itemId:a.id})]}):null})},G=({heading:s,abilities:n,abilityKey:i})=>{var c,o,d,p;const{statblock:a,equipmentBonuses:t,data:h}=P(),l=t.itemActions.items.flatMap(r=>({item:r.itemId,abilities:i in r?r[i]:[]}));return e.jsxs("div",{children:[e.jsx("h3",{className:Fe.heading,children:s}),e.jsx(M,{}),n==null?void 0:n.map((r,m)=>e.jsxs("div",{children:[e.jsx(ge,{ability:r,proficient:!!r.use_proficiency}),e.jsx(E,{})]},m)),(o=(c=a.equipment)==null?void 0:c.filter(r=>r.embedded&&ce(h,r)))==null?void 0:o.map(r=>l.filter(m=>m.item===r.item.id).map(m=>m.abilities.map((f,j)=>e.jsxs("div",{children:[e.jsx(ge,{ability:f,proficient:r.proficient}),e.jsx(E,{})]},j)))),(p=(d=a.equipment)==null?void 0:d.filter(r=>!r.embedded&&ce(h,r)))==null?void 0:p.map(r=>l.filter(m=>m.item===r.item.id).map((m,f)=>m.abilities.length?e.jsxs("div",{children:[e.jsx("h4",{className:Fe.itemName,children:r==null?void 0:r.item.name}),e.jsx(we,{equippedItem:r.item}),e.jsx(M,{}),m.abilities.map((j,x)=>e.jsxs("div",{children:[e.jsx(ge,{ability:j,proficient:r.proficient,range:r.item.tags&&r.item.tags.includes("throw")&&r.item.range||r.item.range?r.item.range:void 0}),e.jsx(E,{})]},x))]},f):null))]})},kt="_content_vnnfs_1",St="_tabs_vnnfs_18",wt="_tab_vnnfs_18",$t="_activeTab_vnnfs_42",Ct="_wrapper_vnnfs_48",Dt="_actionWrapper_vnnfs_53",z={content:kt,tabs:St,tab:wt,activeTab:$t,wrapper:Ct,actionWrapper:Dt},Tt=()=>{const{statblock:s,item:n}=P(),{activeTab:i,setActiveTab:a}=xe(),t=`${n.id}-action`,h=b.useMemo(()=>{var d,p,r,m,f,j,x,u;const o=[];return((d=s.actions)!=null&&d.length||(p=s.equipment)!=null&&p.some(g=>{var v,S;return(S=(v=g.item.bonus)==null?void 0:v.actions)==null?void 0:S.length}))&&o.push("action"),((r=s.bonus_actions)!=null&&r.length||(m=s.equipment)!=null&&m.some(g=>{var v,S;return(S=(v=g.item.bonus)==null?void 0:v.bonus_actions)==null?void 0:S.length}))&&o.push("bonus"),((f=s.reactions)!=null&&f.length||(j=s.equipment)!=null&&j.some(g=>{var v,S;return(S=(v=g.item.bonus)==null?void 0:v.reactions)==null?void 0:S.length}))&&o.push("reaction"),(x=s.mythic_actions)!=null&&x.length&&o.push("mythic"),(u=s.lair_actions)!=null&&u.length&&o.push("lair"),o},[s]),l=t in i?i[t]:h[0],c=b.useMemo(()=>l==="action"?e.jsx(G,{heading:"Actions",abilities:s.actions,abilityKey:"actions"}):l==="bonus"?e.jsx(G,{heading:"Bonus Actions",abilities:s.bonus_actions,abilityKey:"bonus_actions"}):l==="reaction"?e.jsx(G,{heading:"Reactions",abilities:s.reactions,abilityKey:"reactions"}):l==="mythic"?e.jsx(G,{heading:"Mythic Actions",abilities:s.mythic_actions,abilityKey:"mythic_actions"}):l==="lair"?e.jsx(G,{heading:"Lair Actions",abilities:s.lair_actions,abilityKey:"lair_actions"}):e.jsx(e.Fragment,{}),[l,s]);return e.jsx(e.Fragment,{children:h.length===1?e.jsx(e.Fragment,{children:c}):e.jsxs("div",{className:z.actionWrapper,children:[e.jsx("ul",{className:z.tabs,children:h.map((o,d)=>e.jsx("li",{className:l===o?`${z.tab} ${z.activeTab}`:z.tab,onClick:()=>a(t,o),children:o},d))}),e.jsx("div",{className:z.content,children:c})]})})},Rt="_spellFilters_1mi4b_1",Et="_left_1mi4b_9",Lt="_spellFilter_1mi4b_1",Ft="_active_1mi4b_22",zt="_sticky_1mi4b_27",B={spellFilters:Rt,left:Et,spellFilter:Lt,active:Ft,sticky:zt},Ye=s=>e.jsx("div",{className:`${B.spellFilters} ${s.left?B.left:null}`,children:s.filters.map(n=>{let i=!1;return n==="All"&&s.spellFilter.length===0||n==="Cant"&&s.spellFilter.indexOf(0)>=0||n==="Const"&&s.spellFilter.indexOf(-1)>=0?i=!0:i=s.spellFilter.indexOf(parseInt(n))>=0,e.jsx("button",{className:`button ${B.spellFilter} ${i?B.active:null}`,onClick:()=>{if(n==="All")s.setSpellFilter([]);else if(n==="Cant"){const a=Array.from(s.spellFilter);a.indexOf(0)>=0?a.splice(a.indexOf(0),1):a.push(0),s.setSpellFilter(a)}else if(n==="Const"){const a=Array.from(s.spellFilter);a.indexOf(-1)>=0?a.splice(a.indexOf(-1),1):a.push(-1),s.setSpellFilter(a)}else{const a=parseInt(n),t=Array.from(s.spellFilter);t.indexOf(a)>=0?t.splice(t.indexOf(a),1):t.push(a),s.setSpellFilter(t)}},children:n},n)})}),qt="_heading_gze6k_1",Ot="_top_gze6k_7",At="_info_gze6k_13",It="_sticky_gze6k_24",Pt="_spellAttack_gze6k_37",Bt="_spellList_gze6k_43",Mt="_spellMain_gze6k_48",Ht="_spellInfo_gze6k_55",Jt="_spellHeader_gze6k_61",Vt="_spellName_gze6k_67",Wt="_spellLevel_gze6k_74",Kt="_spellDamage_gze6k_79",Qt="_spellComponents_gze6k_83",Gt="_materialDetails_gze6k_90",Ut="_spellMoreInfo_gze6k_96",Zt="_open_gze6k_102",Xt="_moreInfoContent_gze6k_106",Yt="_micOpen_gze6k_116",en="_infoBits_gze6k_120",R={heading:qt,top:Ot,info:At,sticky:It,spellAttack:Pt,spellList:Bt,spellMain:Mt,spellInfo:Ht,spellHeader:Jt,spellName:Vt,spellLevel:Wt,spellDamage:Kt,spellComponents:Qt,materialDetails:Gt,spellMoreInfo:Ut,open:Zt,moreInfoContent:Xt,micOpen:Yt,infoBits:en},sn="_spellSlots_1bdb5_1",tn="_spellSlotLimits_1bdb5_5",nn="_spellSlotEntry_1bdb5_11",an="_spellSlotLevel_1bdb5_21",ie={spellSlots:sn,spellSlotLimits:tn,spellSlotEntry:nn,spellSlotLevel:an},ln=()=>{const{statblock:s,item:n,data:i}=P();return e.jsx(e.Fragment,{children:s.spell_slots&&s.spell_slots.length>0?e.jsx("div",{className:ie.spellSlots,children:e.jsx("div",{className:ie.spellSlotLimits,children:s.spell_slots.sort((a,t)=>a.level-t.level).map((a,t)=>{var l;const h=(l=i.stats.limits)==null?void 0:l.find(c=>c.id===a.limit.name);return h?e.jsxs("div",{className:ie.spellSlotEntry,children:[e.jsxs("div",{className:ie.spellSlotLevel,children:["Level: ",a.level]}),e.jsx(Y,{limit:a.limit,title:"none",hideReset:!0,limitValues:h,itemId:n.id})]},t):null})})}):null})},ve=({spell:s,statblock:n,stats:i,spellSlots:a,charges:t,chargesUsed:h,tokenData:l,itemId:c,dc:o,attack:d,embedded:p})=>{var D;const[r,m]=b.useState(!1),f=P(),j=K(L(T=>T.room)),x=ue(L(T=>T.addRoll)),u=()=>s.level===0?"Cantrip":s.level===1?"1st level":s.level===2?"2nd level":s.level===3?"3rd level":`${s.level}th level`,g=s.desc?Pe(s.desc):null,v=b.useMemo(()=>{var T;if(w.isUndefined(t)){if(a)return(T=a==null?void 0:a.find(C=>C.level===s.level))==null?void 0:T.limit}else return t},[a,s,t]),S=(D=l==null?void 0:l.stats.limits)==null?void 0:D.find(T=>T.id===(v==null?void 0:v.name)),y=b.useMemo(()=>s.level===0?!1:S&&S.max<S.used+(h||1)||a&&a.length>0&&!v,[s,S,a,v]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:R.spellMain,children:[e.jsxs("div",{className:R.spellInfo,children:[e.jsxs("div",{className:R.spellHeader,children:[e.jsx("h4",{className:R.spellName,children:s.name}),e.jsxs("span",{className:R.spellLevel,children:["(",u(),")"]}),p&&t&&S&&c?e.jsx(Y,{limit:t,title:"none",limitValues:S,itemId:c,hideDescription:!0,hideReset:!0}):null,h?e.jsxs("span",{className:R.spellLevel,children:["(uses ",h," charges)"]}):null,a&&a.length>0||t?e.jsx(O,{content:"No more spellslots",disabled:!y,children:e.jsx("div",{className:`button-wrapper enabled ${j!=null&&j.disableDiceRoller?"calculated":"three-d-dice"}`,children:s.is_attack&&d?e.jsx(e.Fragment,{children:e.jsx(I,{dice:`1d20+${d}`,text:`+${d}&nbspattack`,context:`${w.capitalize(s.name)}: Attack`,statblock:n,stats:i,onRoll:async()=>{c&&S&&await X(c,S,h)},limitReached:y,proficiencyBonus:f.statblock.proficiency_bonus})}):e.jsx("button",{className:`dice-button button ${y?"limit":""}`,onClick:async()=>{c&&S&&await X(c,S,h),await js(`${s.name}: Cast`,x,n)},children:"cast"})})}):null]}),s.dc?e.jsxs("span",{className:R.spellDamage,children:["DC: ",s.dc,e.jsx(I,{dice:"1d20",text:`DC ${o}`,context:`${w.capitalize(s.name)}: Attack`,stats:i,proficiencyBonus:f.statblock.proficiency_bonus})]}):null,g?e.jsxs("span",{className:R.spellDamage,children:["Damage:"," ",e.jsx(I,{dice:g,text:g,context:`${w.capitalize(s.name)}: Damage`,stats:i,statblock:n,limitReached:y,damageDie:!0,proficiencyBonus:f.statblock.proficiency_bonus})]}):null,e.jsxs("div",{className:R.spellComponents,children:[s.verbal?"V":null,s.somatic?"S":null,e.jsxs("span",{className:"spell-materials",children:[s.material?"M":null,e.jsx("span",{className:R.materialDetails,children:s.materials?` (${s.materials})`:null})]})]})]}),e.jsx("button",{className:`expand ${r?"open":null}`,onClick:()=>m(!r)})]}),e.jsx("div",{className:`${R.spellMoreInfo} ${r?R.open:null}`,children:e.jsxs("div",{className:`${R.moreInfoContent} ${r?R.micOpen:null}`,children:[e.jsxs("div",{className:R.infoBits,children:[s.school.name?e.jsxs("span",{children:[e.jsx("b",{children:"School"}),": ",s.school.name]}):null,s.archetypes&&s.archetypes.length>0?e.jsxs("span",{children:[e.jsx("b",{children:"Archetypes"}),": ",s.archetypes.map(T=>T.name).join(", ")]}):null,s.circles&&s.circles.length>0?e.jsxs("span",{children:[e.jsx("b",{children:"Circles"}),": ",s.circles.map(T=>T.name).join(", ")]}):null,s.classes&&s.classes.length>0?e.jsxs("span",{children:[e.jsx("b",{children:"Classes"}),": ",s.classes.map(T=>T.name).join(", ")]}):null,e.jsxs("span",{children:[e.jsx("b",{children:"Casting Time"}),": ",s.casting_time]}),e.jsxs("span",{children:[e.jsx("b",{children:"Range"}),": ",s.range]}),e.jsxs("span",{children:[e.jsx("b",{children:"Can be Ritual"}),": ",s.ritual?"Yes":"No"]}),e.jsxs("span",{children:[e.jsx("b",{children:"Duration"}),": ",s.duration]}),e.jsxs("span",{children:[e.jsx("b",{children:"Concentration"}),": ",s.concentration?"Yes":"No"]})]}),e.jsxs("div",{children:[e.jsx("b",{children:"Description"}),":",e.jsx(V,{text:s.desc||"",context:`${w.capitalize(s.name)}`,stats:i,statblock:n,onRoll:async()=>{c&&S&&await X(c,S)},limitReached:y,proficiencyBonus:f.statblock.proficiency_bonus})]}),s.higher_level?e.jsxs("div",{children:[e.jsx("b",{children:"Higher Levels"}),":"," ",e.jsx(V,{text:s.higher_level,stats:i,context:`${w.capitalize(s.name)}: Higher Level`,statblock:n,proficiencyBonus:f.statblock.proficiency_bonus})]}):null]})})]})},cn=()=>{var r,m,f,j;const[s,n]=b.useState([]),{stats:i,data:a,item:t,tokenName:h,statblock:l,equipmentBonuses:c}=P(),o=l.spells||[],d=c.statblockBonuses.spells.flatMap(x=>({item:x.itemId,spells:x.spells.map(u=>({spell:u.spell,charges:u.charges}))})),p=["All"].concat(o.map(x=>x.level===0?"Cant":x.level===1?"1st":x.level===2?"2nd":x.level===3?"3rd":`${x.level}th`)).concat(d.flatMap(x=>x.spells.map(u=>u.spell.level===0?"Cant":u.spell.level===1?"1st":u.spell.level===2?"2nd":u.spell.level===3?"3rd":`${u.spell.level}th`))).filter((x,u,g)=>g.indexOf(x)===u).sort((x,u)=>x==="All"?-1:u==="All"?1:x==="Cant"?-1:u==="Cant"?1:parseInt(x)-parseInt(u));return e.jsxs("div",{className:"spells",children:[e.jsx("div",{className:R.top,children:e.jsx("h3",{className:R.heading,children:"Spells"})}),e.jsx(M,{}),e.jsxs("div",{className:R.sticky,children:[e.jsx(Ye,{filters:p,spellFilter:s,setSpellFilter:n}),e.jsxs("div",{className:R.info,children:[l.spell_dc?e.jsxs("span",{children:["DC ",l.spell_dc]}):null,l.spell_attack?e.jsxs("span",{className:R.spellAttack,children:["Attack"," ",e.jsx(I,{dice:`d20+${l.spell_attack}`,text:`+${l.spell_attack}`,context:"Spell Attack",stats:i,proficiencyBonus:l.proficiency_bonus})]}):null]}),e.jsx(ln,{})]}),e.jsxs("ul",{className:R.spellList,children:[e.jsx("li",{children:e.jsx(E,{})}),o.sort((x,u)=>x.level-u.level).filter(x=>s.indexOf(x.level)>=0||s.length===0).map((x,u)=>e.jsxs("li",{children:[e.jsx(ve,{spell:x,statblock:h,stats:i,spellSlots:l.spell_slots,tokenData:a,itemId:t.id,dc:l.spell_dc,attack:l.spell_attack}),e.jsx(E,{})]},`${x.name}${u}`)),(m=(r=l.equipment)==null?void 0:r.filter(x=>x.embedded&&ce(a,x)))==null?void 0:m.map(x=>d.filter(u=>u.item===x.item.id).map(u=>u.spells.filter(g=>s.indexOf(g.spell.level)>=0||s.length===0).sort((g,v)=>g.spell.level-v.spell.level).map((g,v)=>e.jsxs("li",{children:[e.jsx(ve,{spell:g.spell,statblock:h,stats:i,spellSlots:l.spell_slots,charges:x.item.charges,chargesUsed:g.charges,tokenData:a,itemId:t.id,dc:l.spell_dc,attack:l.spell_attack,embedded:!0}),e.jsx(E,{})]},`${g.spell.name}${v}`)))),(j=(f=l.equipment)==null?void 0:f.filter(x=>!x.embedded&&ce(a,x)))==null?void 0:j.map(x=>d.filter(u=>u.item===x.item.id).map((u,g)=>u.spells.length?e.jsxs("li",{children:[e.jsx("h4",{className:R.heading,children:x.item.name}),e.jsx(we,{equippedItem:x.item}),e.jsx(M,{}),u.spells.filter(v=>s.indexOf(v.spell.level)>=0||s.length===0).sort((v,S)=>v.spell.level-S.spell.level).map((v,S)=>e.jsxs("div",{children:[e.jsx(ve,{spell:v.spell,statblock:h,stats:i,tokenData:a,charges:x.item.charges,chargesUsed:v.charges,itemId:t.id,dc:l.spell_dc,attack:l.spell_attack}),e.jsx(E,{})]},`${v.spell.name}${S}`))]},g):null))]})]})},rn="_heading_1x8jz_1",on="_items_1x8jz_7",dn="_top_1x8jz_14",un="_itemName_1x8jz_21",mn="_info_1x8jz_28",hn="_cost_1x8jz_34",xn="_gp_1x8jz_41",jn="_cp_1x8jz_45",pn="_sp_1x8jz_49",fn="_ep_1x8jz_53",gn="_pp_1x8jz_57",vn="_equipmentOptions_1x8jz_61",J={heading:rn,items:on,top:dn,itemName:un,info:mn,cost:hn,gp:xn,cp:jn,sp:pn,ep:fn,pp:gn,equipmentOptions:vn},es=Oe()(Ae(s=>({filter:{filter:{consumable:!1,isEquipped:!1,isAttuned:!1,search:""},sort:"name"},setFilter:n=>s(()=>({filter:n}))}),{name:`${Se}.inventory-filter`,storage:Ie(()=>localStorage)})),bn=()=>{const[s,n]=es(L(i=>[i.filter,i.setFilter]));return e.jsxs("div",{style:{display:"flex",gap:"10px",paddingBlock:"6px"},className:B.sticky,children:[e.jsxs("label",{children:["Sort:",e.jsxs("select",{value:s.sort,onChange:i=>{n({...s,sort:i.currentTarget.value})},children:[e.jsx("option",{children:"name"}),e.jsx("option",{children:"cost"}),e.jsx("option",{children:"equipped"}),e.jsx("option",{children:"attuned"})]})]}),e.jsxs("div",{className:`${B.spellFilters} ${B.left}`,style:{alignItems:"center"},children:[e.jsx(O,{content:"is equipped",children:e.jsx("button",{className:`button ${B.spellFilter} ${s.filter.isEquipped?B.active:null}`,onClick:()=>{n({...s,filter:{...s.filter,isEquipped:!s.filter.isEquipped}})},children:"equ"})}),e.jsx(O,{content:"is attuned",children:e.jsx("button",{className:`button ${B.spellFilter} ${s.filter.isAttuned?B.active:null}`,onClick:()=>{n({...s,filter:{...s.filter,isAttuned:!s.filter.isAttuned}})},children:"att"})}),e.jsx(O,{content:"can be consumed",children:e.jsx("button",{className:`button ${B.spellFilter} ${s.filter.consumable?B.active:null}`,onClick:()=>{n({...s,filter:{...s.filter,consumable:!s.filter.consumable}})},children:"con"})}),e.jsx(O,{content:"search",children:e.jsx("input",{style:{width:"40px",height:"20px",flexGrow:1},type:"text",value:s.filter.search,onChange:i=>{n({...s,filter:{...s.filter,search:i.target.value}})}})})]})]})},_n=({equipment:s})=>{const{statblock:n,stats:i,data:a,item:t}=P();return e.jsxs("li",{children:[e.jsxs("div",{className:J.top,children:[e.jsxs("span",{className:J.info,children:[e.jsxs("h4",{className:J.itemName,children:[s.count?`${s.count}x `:null,s.item.name]}),e.jsxs("span",{children:[s.item.consumable?e.jsx(O,{content:"Can be consumed",children:e.jsx("i",{children:"C"})}):null,s.proficient?e.jsx(O,{content:"proficient",children:e.jsx("i",{children:"P"})}):null,s.loot?e.jsx(O,{content:"loot",children:e.jsx("i",{children:"L"})}):null,s.item.sentient?e.jsx(O,{content:"sentient",children:e.jsx("i",{children:"S"})}):null]})]}),e.jsx("div",{className:J.cost,children:s.item.cost?e.jsx(e.Fragment,{children:Object.entries(s.item.cost).map(([h,l])=>h!=="id"&&l?e.jsxs("span",{className:J[h],children:[l,h]},h):null)}):null})]}),e.jsxs("span",{className:J.equipmentOptions,children:[s.item.can_equip?e.jsxs("label",{"aria-label":"equipped",children:["equipped:",e.jsx("input",{type:"checkbox",checked:ps(a,s),onChange:async h=>{var o,d;const l=[...((o=a.equipment)==null?void 0:o.equipped)||[]],c=[...((d=a.equipment)==null?void 0:d.attuned)||[]];h.target.checked?l.push(s.item.slug):l.splice(l.findIndex(p=>p===s.item.slug),1),await Ee(a,l,c,n,t)}})]}):null,s.item.requires_attuning?e.jsxs("label",{"aria-label":"attuned",children:["attuned:",e.jsx("input",{type:"checkbox",checked:fs(a,s),onChange:async h=>{var o,d;const l=[...((o=a.equipment)==null?void 0:o.equipped)||[]],c=[...((d=a.equipment)==null?void 0:d.attuned)||[]];h.target.checked?c.push(s.item.slug):c.splice(c.findIndex(p=>p===s.item.slug),1),await Ee(a,l,c,n,t)}})]}):null]}),e.jsx(we,{equippedItem:s.item}),e.jsx(he,{slug:s.item.name,statblock:n,stats:i,about:s.item.description,context:s.item.name}),e.jsx(E,{})]},s.id)},Nn=()=>{var t,h;const{statblock:s}=P(),n=es(l=>l.filter),i=(l,c)=>{var o,d,p,r,m,f,j,x,u,g;if(n.sort==="name")return l.item.name.localeCompare(c.item.name);if(n.sort==="cost"){const v=(((o=l.item.cost)==null?void 0:o.cp)||0)+10*(((d=l.item.cost)==null?void 0:d.sp)||0)+50*(((p=l.item.cost)==null?void 0:p.ep)||0)+100*(((r=l.item.cost)==null?void 0:r.gp)||0)+1e3*(((m=l.item.cost)==null?void 0:m.pp)||0),y=(((f=c.item.cost)==null?void 0:f.cp)||0)+10*(((j=c.item.cost)==null?void 0:j.sp)||0)+50*(((x=c.item.cost)==null?void 0:x.ep)||0)+100*(((u=c.item.cost)==null?void 0:u.gp)||0)+1e3*(((g=c.item.cost)==null?void 0:g.pp)||0)-v;return y===0?l.item.name.localeCompare(c.item.name):y}else{if(n.sort==="equipped")return l.equipped&&c.equipped||!l.equipped&&!c.equipped?l.item.can_equip&&c.item.can_equip||!l.item.can_equip&&!c.item.can_equip?l.item.name.localeCompare(c.item.name):l.item.can_equip&&!c.item.can_equip?-1:1:l.equipped&&!c.equipped?-1:1;if(n.sort==="attuned")return l.attuned&&c.attuned||!l.attuned&&!c.attuned?l.item.requires_attuning&&c.item.requires_attuning||!l.item.requires_attuning&&!c.item.requires_attuning?l.item.name.localeCompare(c.item.name):l.item.requires_attuning&&!c.item.requires_attuning?-1:1:l.attuned&&!c.attuned?-1:1}return 0},a=l=>!l.embedded&&(!n.filter.consumable||l.item.consumable)&&(!n.filter.isEquipped||l.equipped)&&(!n.filter.isAttuned||l.attuned)&&(n.filter.search===""||l.item.name.toLowerCase().includes(n.filter.search.toLowerCase()));return e.jsxs("div",{children:[e.jsx("h3",{className:J.heading,children:"Inventory"}),e.jsx(M,{}),e.jsx(bn,{}),e.jsx("ul",{className:J.items,children:(t=s.equipment)==null?void 0:t.filter(a).sort(i).map((l,c)=>e.jsx(_n,{equipment:l},c))}),e.jsx("h3",{className:J.heading,children:"Other"}),e.jsx(M,{}),e.jsx("div",{children:(h=s.items)==null?void 0:h.join(", ")})]})},yn=()=>{const{statblock:s,item:n}=P(),{activeTab:i,setActiveTab:a}=xe(),t=n.id in i?i[n.id]:"general",h=b.useMemo(()=>{var o,d,p,r,m,f,j,x,u,g,v,S;const c=["general","skills"];return((o=s.actions)!=null&&o.length||(d=s.bonus_actions)!=null&&d.length||(p=s.mythic_actions)!=null&&p.length||(r=s.reactions)!=null&&r.length||(m=s.equipment)!=null&&m.some(y=>{var D,T,C,F,_,k;return((T=(D=y.item.bonus)==null?void 0:D.actions)==null?void 0:T.length)||((F=(C=y.item.bonus)==null?void 0:C.bonus_actions)==null?void 0:F.length)||((k=(_=y.item.bonus)==null?void 0:_.reactions)==null?void 0:k.length)}))&&c.push("actions"),((f=s.items)!=null&&f.length||(j=s.equipment)!=null&&j.length)&&c.push("inventory"),((x=s.spells)!=null&&x.length||(u=s.equipment)!=null&&u.some(y=>{var D;return(D=y.item.spells)==null?void 0:D.length}))&&c.push("spells"),((g=s.special_abilities)!=null&&g.length||(v=s.equipment)!=null&&v.some(y=>{var D,T;return(T=(D=y.item.bonus)==null?void 0:D.special_abilities)==null?void 0:T.length}))&&c.push("special"),(S=s.legendary_actions)!=null&&S.length&&c.push("legendary"),c},[s]),l=b.useMemo(()=>t==="general"?e.jsx(xt,{}):t==="skills"?e.jsx(vt,{}):t==="actions"?e.jsx(Tt,{}):t==="inventory"?e.jsx(Nn,{}):t==="spells"?e.jsx(cn,{}):t==="special"?e.jsx(G,{heading:"Specials & Traits",abilities:s.special_abilities,abilityKey:"special_abilities"}):t==="legendary"?e.jsx(G,{heading:"Legendary Actions",abilities:s.legendary_actions,abilityKey:"legendary_actions"}):e.jsx(e.Fragment,{}),[t,s]);return e.jsxs("div",{className:Z.wrapper,children:[e.jsx("ul",{className:Z.tabs,children:h.map((c,o)=>e.jsx("li",{className:t===c?`${Z.tab} ${Z.activeTab}`:Z.tab,onClick:()=>a(n.id,c),children:c},o))}),e.jsx("div",{className:Z.content,children:l})]})},kn=({proxyUrl:s,onClose:n,onSelectItem:i})=>{const[a,t]=b.useState(""),[h,l]=b.useState([]),[c,o]=b.useState(!1),[d,p]=b.useState(null);b.useEffect(()=>{const f=setTimeout(()=>{a.trim()?r(a):l([])},300);return()=>clearTimeout(f)},[a]);const r=async f=>{o(!0),p(null);try{const j=`${s}/e5/item/search/?search_string=${encodeURIComponent(f)}&take=200&skip=0`;console.log("ðŸ” Searching items:",j);const x=await fetch(j);if(!x.ok)throw new Error(`Search failed: ${x.status}`);const u=await x.json();l(u||[]),console.log("âœ… Found items:",(u==null?void 0:u.length)||0)}catch(j){p(`Search failed: ${j instanceof Error?j.message:String(j)}`),console.error("âŒ Search error:",j)}finally{o(!1)}},m=f=>{i(f),n()};return e.jsx("div",{className:"item-search-overlay",children:e.jsxs("div",{className:"item-search-modal",children:[e.jsxs("div",{className:"item-search-header",children:[e.jsx("h3",{children:"ðŸ” Search Items"}),e.jsx("button",{className:"close-btn",onClick:n,"aria-label":"Close search",children:"âœ•"})]}),e.jsxs("div",{className:"item-search-content",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Search for items...",value:a,onChange:f=>t(f.target.value),className:"search-input",autoFocus:!0}),c&&e.jsx("div",{className:"search-loading",children:"â³"})]}),d&&e.jsxs("div",{className:"search-error",children:["âš ï¸ ",d]}),e.jsxs("div",{className:"items-list",children:[h.length===0&&a&&!c&&e.jsxs("div",{className:"no-results",children:['No items found for "',a,'"']}),h.map(f=>e.jsxs("div",{className:"item-row",onClick:()=>m(f),children:[e.jsxs("div",{className:"item-info",children:[e.jsx("div",{className:"item-name",children:f.name}),f.type&&e.jsx("div",{className:"item-type",children:f.type}),f.rarity&&e.jsx("div",{className:"item-rarity",children:f.rarity})]}),e.jsxs("div",{className:"item-id",children:["ID: ",f.id]})]},f.id))]})]}),e.jsx("div",{className:"item-search-footer",children:e.jsx("button",{className:"cancel-btn",onClick:n,children:"Cancel"})})]})})},Sn=({proxyUrl:s,onClose:n,onSelectSpell:i})=>{const[a,t]=b.useState(""),[h,l]=b.useState([]),[c,o]=b.useState(!1),[d,p]=b.useState(null);b.useEffect(()=>{const j=setTimeout(()=>{a.trim()?r(a):l([])},300);return()=>clearTimeout(j)},[a]);const r=async j=>{o(!0),p(null);try{const x=`${s}/e5/spell/search/?search_string=${encodeURIComponent(j)}&take=200&skip=0`;console.log("ðŸ” Searching spells:",x);const u=await fetch(x);if(!u.ok)throw new Error(`Search failed: ${u.status}`);const g=await u.json();l(g||[]),console.log("âœ… Found spells:",(g==null?void 0:g.length)||0)}catch(x){p(`Search failed: ${x instanceof Error?x.message:String(x)}`),console.error("âŒ Search error:",x)}finally{o(!1)}},m=j=>{i(j),n()},f=j=>j===0?"Cantrip":j===1?"1st level":j===2?"2nd level":j===3?"3rd level":`${j}th level`;return e.jsx("div",{className:"spell-search-overlay",children:e.jsxs("div",{className:"spell-search-modal",children:[e.jsxs("div",{className:"spell-search-header",children:[e.jsx("h3",{children:"ðŸª„ Search Spells"}),e.jsx("button",{className:"close-btn",onClick:n,"aria-label":"Close search",children:"âœ•"})]}),e.jsxs("div",{className:"spell-search-content",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Search for spells...",value:a,onChange:j=>t(j.target.value),className:"search-input",autoFocus:!0}),c&&e.jsx("div",{className:"search-loading",children:"â³"})]}),d&&e.jsxs("div",{className:"search-error",children:["âš ï¸ ",d]}),e.jsxs("div",{className:"spells-list",children:[h.length===0&&a&&!c&&e.jsxs("div",{className:"no-results",children:['No spells found for "',a,'"']}),h.map(j=>{var x;return e.jsxs("div",{className:"spell-row",onClick:()=>m(j),children:[e.jsxs("div",{className:"spell-info",children:[e.jsx("div",{className:"spell-name",children:j.name}),e.jsxs("div",{className:"spell-details",children:[j.level!==void 0&&e.jsx("span",{className:"spell-level",children:f(j.level)}),((x=j.school)==null?void 0:x.name)&&e.jsx("span",{className:"spell-school",children:j.school.name}),j.classes&&j.classes.length>0&&e.jsx("span",{className:"spell-classes",children:j.classes.map(u=>u.name).join(", ")})]}),e.jsxs("div",{className:"spell-extra-info",children:[j.range&&e.jsxs("span",{className:"spell-range",children:["Range: ",j.range]}),j.casting_time&&e.jsxs("span",{className:"spell-casting-time",children:["Cast: ",j.casting_time]}),j.duration&&e.jsxs("span",{className:"spell-duration",children:["Duration: ",j.duration]})]})]}),e.jsxs("div",{className:"spell-id",children:["ID: ",j.id]})]},j.id)})]})]}),e.jsx("div",{className:"spell-search-footer",children:e.jsx("button",{className:"cancel-btn",onClick:n,children:"Cancel"})})]})})},wn=({isOpen:s,onClose:n,slug:i,proxyUrl:a,onSave:t,title:h="Edit JSON"})=>{const[l,c]=b.useState(""),[o,d]=b.useState(null),[p,r]=b.useState(!0),[m,f]=b.useState("raw"),[j,x]=b.useState(!1),[u,g]=b.useState(!1),[v,S]=b.useState(!1);b.useEffect(()=>{s&&i&&a&&(async()=>{x(!0),d(null);try{const $=await fetch(`${a}/edit/statblock/${i}`);if(!$.ok)throw new Error(`Failed to fetch: ${$.status}`);const q=await $.json();c(JSON.stringify(q,null,2)),r(!0)}catch($){d(`Failed to load JSON: ${$ instanceof Error?$.message:String($)}`),c(""),r(!1)}finally{x(!1)}})()},[s,i,a]);const y=N=>{const $=N.target.value;c($);try{JSON.parse($),d(null),r(!0)}catch{d("Invalid JSON format"),r(!1)}},D=async()=>{if(!p){d("Cannot save invalid JSON");return}x(!0);try{const N=JSON.parse(l),$=await fetch(`${a}/edit/statblock/${i}`,{method:"POST",headers:{"Content-Type":"application/json"},body:l});if(!$.ok)throw new Error(`Save failed: ${$.status}`);t(N),n()}catch(N){d(`Save failed: ${N instanceof Error?N.message:String(N)}`)}finally{x(!1)}},T=()=>{try{const N=JSON.parse(l);c(JSON.stringify(N,null,2)),d(null),r(!0)}catch{d("Cannot format invalid JSON")}},C=N=>{try{const $=JSON.parse(l);Array.isArray($.equipment)||($.equipment=[]);const q={item:N.id,equipped:!1,proficient:!1,embedded:!1,loot:!1,attuned:!1,count:1};$.equipment.push(q),c(JSON.stringify($,null,2)),g(!1),console.log("âœ… Item aggiunto:",N.name)}catch($){d("Failed to add item to equipment"),console.error("âŒ Errore aggiunta item:",$)}},F=()=>{try{const N=JSON.parse(l);return Array.isArray(N.equipment)}catch{return!1}},_=()=>{try{const N=JSON.parse(l);return Array.isArray(N.spells)}catch{return!1}},k=N=>{try{const $=JSON.parse(l);Array.isArray($.spells)||($.spells=[]),$.spells.includes(N.id)?console.log("âš ï¸ Spell giÃ  presente:",N.name):($.spells.push(N.id),c(JSON.stringify($,null,2)),console.log("âœ… Spell aggiunto:",N.name)),S(!1)}catch($){d("Failed to add spell to list"),console.error("âŒ Errore aggiunta spell:",$)}};return s?e.jsx("div",{className:"json-editor-overlay",children:e.jsxs("div",{className:"json-editor-modal",children:[e.jsxs("div",{className:"json-editor-header",children:[e.jsx("h2",{className:"json-editor-title",children:h}),e.jsxs("div",{className:"json-editor-controls",children:[e.jsxs("div",{className:"view-toggle",children:[e.jsx("button",{className:`toggle-btn ${m==="formatted"?"active":""}`,onClick:()=>f("formatted"),disabled:!p||j,children:"ðŸ‘ï¸ Preview"}),e.jsx("button",{className:`toggle-btn ${m==="raw"?"active":""}`,onClick:()=>f("raw"),disabled:j,children:"âœï¸ Edit"})]}),e.jsx("button",{className:"json-editor-close",onClick:n,"aria-label":"Close editor",disabled:j,children:"âœ•"})]})]}),e.jsxs("div",{className:"json-editor-toolbar",children:[e.jsxs("div",{className:"toolbar-left",children:[e.jsx("button",{className:"json-editor-btn json-editor-btn-secondary",onClick:T,disabled:!p||j,title:"Format and prettify JSON",children:"ðŸŽ¨ Format"}),F()&&e.jsx("button",{className:"json-editor-btn json-editor-btn-secondary",onClick:()=>g(!0),disabled:!p||j,title:"Add item to equipment",children:"âž• Add Item"}),_()&&e.jsx("button",{className:"json-editor-btn json-editor-btn-secondary",onClick:()=>S(!0),disabled:!p||j,title:"Add spell to spell list",children:"ðŸª„ Add Spell"}),e.jsx("span",{className:"json-status",children:j?e.jsx("span",{className:"status-loading",children:"â³ Loading..."}):p?e.jsx("span",{className:"status-valid",children:"âœ… Valid JSON"}):e.jsx("span",{className:"status-invalid",children:"âŒ Invalid JSON"})})]}),o&&e.jsxs("span",{className:"json-editor-error",children:["âš ï¸ ",o]})]}),u&&e.jsx(kn,{proxyUrl:a,onClose:()=>g(!1),onSelectItem:C}),v&&e.jsx(Sn,{proxyUrl:a,onClose:()=>S(!1),onSelectSpell:k}),e.jsx("div",{className:"json-editor-content",children:j?e.jsx("div",{className:"json-loading",children:e.jsx("div",{className:"loading-spinner",children:"â³ Loading JSON from server..."})}):m==="formatted"&&p?e.jsx("div",{className:"json-viewer",children:e.jsx(ss,{data:JSON.parse(l)})}):e.jsx("div",{className:"json-raw-editor",children:e.jsx("textarea",{className:`json-editor-textarea ${p?"":"json-editor-textarea-error"}`,value:l,onChange:y,placeholder:"Loading JSON from server...",spellCheck:!1,disabled:j})})}),e.jsxs("div",{className:"json-editor-footer",children:[e.jsxs("div",{className:"footer-info",children:[e.jsxs("span",{className:"char-count",children:[l.length," characters"]}),m==="formatted"&&e.jsx("span",{className:"view-hint",children:"ðŸ’¡ Switch to Edit mode to modify"})]}),e.jsxs("div",{className:"footer-buttons",children:[e.jsx("button",{className:"json-editor-btn json-editor-btn-secondary",onClick:n,disabled:j,children:"Cancel"}),e.jsx("button",{className:"json-editor-btn json-editor-btn-primary",onClick:D,disabled:!p||j,children:j?"â³ Saving...":"ðŸ’¾ Save Changes"})]})]})]})}):null},ss=({data:s,level:n=0})=>{const[i,a]=b.useState({}),t=l=>{a(c=>({...c,[l]:!c[l]}))},h=(l,c,o)=>{const d=i[`${n}-${l}`];if(typeof c=="object"&&c!==null){const p=Array.isArray(c),r=p?c.length===0:Object.keys(c).length===0;return e.jsxs("div",{className:"json-tree-item",children:[e.jsxs("div",{className:"json-tree-key expandable",onClick:()=>t(`${n}-${l}`),children:[e.jsx("span",{className:"collapse-icon",children:r?"ðŸ“„":d?"â–¶ï¸":"ðŸ”½"}),e.jsxs("span",{className:"key-name",children:['"',l,'"']}),e.jsx("span",{className:"key-colon",children:":"}),e.jsx("span",{className:"value-preview",children:p?`Array(${c.length})`:"Object"})]}),!d&&!r&&e.jsx("div",{className:"json-tree-children",children:e.jsx(ss,{data:c,level:n+1})})]},o)}return e.jsxs("div",{className:"json-tree-item",children:[e.jsxs("span",{className:"json-tree-key",children:['"',l,'"']}),e.jsx("span",{className:"key-colon",children:":"}),e.jsx("span",{className:`json-value json-${typeof c}`,children:typeof c=="string"?`"${c}"`:String(c)})]},o)};return Array.isArray(s)?e.jsx("div",{className:"json-tree",children:s.map((l,c)=>h(String(c),l,c))}):e.jsx("div",{className:"json-tree",children:Object.entries(s).map(([l,c],o)=>h(l,c,o))})},$n=()=>{const{statblock:s}=P(),[n,i]=b.useState(!1),a=K(L(l=>l.room)),t=s==null?void 0:s.slug,h=gs(a||void 0);return e.jsxs("div",{className:W.statblock,children:[e.jsxs("div",{className:W.title,children:[e.jsxs("div",{children:[e.jsx(O,{content:`${s.size} ${s.type}, ${s.alignment}`,children:e.jsx("h1",{className:W.name,children:s.name})}),e.jsxs("div",{className:W.note,children:[s.size," ",s.type,", ",s.alignment]})]}),e.jsxs("div",{className:W.headerActions,children:[e.jsx(Ps,{}),e.jsx("button",{className:"edit-json-btn",onClick:()=>i(!0),title:"Edit statblock JSON",children:"âš™ï¸"})]})]}),e.jsx(yn,{}),e.jsx(wn,{isOpen:n,onClose:()=>i(!1),slug:t||"",proxyUrl:h||"",onSave:l=>{console.log("JSON salvato:",l)},title:"Edit Statblock JSON"})]})},Cn=({slug:s,itemId:n})=>{const i=ws(s),a=i.isSuccess&&i.data?i.data:null;return a?e.jsx(Es,{itemId:n,statblock:a,children:e.jsx($n,{})}):e.jsx(te,{})},ts=b.createContext(null),Q=()=>{const s=b.useContext(ts);if(s===null)throw new Error("PFStatblockContext is not set");return s},Dn=s=>{const n=ke(L(i=>{var a;return(a=i.tokens)==null?void 0:a.get(s.itemId)}));if(n){const i=n.data,a=n.item;return e.jsx(ts.Provider,{value:{tokenName:ze(a),data:i,item:a,statblock:s.statblock,stats:{strength:s.statblock.stats.strength||0,dexterity:s.statblock.stats.dexterity||0,constitution:s.statblock.stats.constitution||0,wisdom:s.statblock.stats.wisdom||0,intelligence:s.statblock.stats.intelligence||0,charisma:s.statblock.stats.charisma||0}},children:s.children})}return e.jsx(te,{})},Tn="_values_15mtq_1",Rn={values:Tn},En=()=>{const{item:s}=Q();return e.jsxs("div",{className:Rn.values,children:[e.jsx(Qe,{id:s.id}),e.jsx(Ge,{id:s.id})]})},Ln="_general_1mcsm_1",Fn="_stats_1mcsm_5",zn="_heading_1mcsm_12",qn="_savingThrows_1mcsm_18",On="_stat_1mcsm_5",An="_traits_1mcsm_37",In="_trait_1mcsm_37",Pn="_name_1mcsm_47",Bn="_value_1mcsm_60",Mn="_header_1mcsm_76",Hn="_infos_1mcsm_84",Jn="_ac_1mcsm_91",A={general:Ln,stats:Fn,heading:zn,savingThrows:qn,stat:On,traits:An,trait:In,name:Pn,value:Bn,header:Mn,infos:Hn,ac:Jn},Vn=["strength","dexterity","constitution","intelligence","wisdom","charisma"],Wn=["reflex","will","fortitude"],Kn=()=>{var t,h,l,c,o,d,p,r,m,f,j,x;const{statblock:s,stats:n,tokenName:i,item:a}=Q();return e.jsxs("div",{className:A.general,children:[e.jsxs("div",{className:A.ac,children:[e.jsx("b",{children:"Armor Class:"})," ",e.jsx(Ue,{id:a.id,hideExtras:!0}),s.armor_class.special?e.jsxs("span",{children:["(",s.armor_class.special,")"]}):null]}),e.jsxs("div",{children:[e.jsx("b",{children:"Speed:"}),` ${s.speed}`]}),e.jsx(E,{}),e.jsxs("ul",{className:A.stats,children:[e.jsxs("li",{className:A.header,children:[e.jsx("div",{}),e.jsx("div",{children:"Check"})]}),Vn.map(u=>{const g=n[u];return e.jsxs("li",{className:A.stat,children:[e.jsx("div",{className:A.name,children:e.jsx("span",{children:u.substring(0,3)})}),e.jsx("div",{className:A.value,children:e.jsx(I,{dice:`d20+${g}`,text:`+${g}`,stats:n,context:`${w.capitalize(u)}: Check`,statblock:i})})]},u)})]}),e.jsx(E,{}),e.jsxs("ul",{className:A.savingThrows,children:[e.jsxs("li",{className:A.header,children:[e.jsx("div",{}),e.jsx("div",{children:"Save"})]}),Wn.map(u=>{const g=s.saving_throws[u];return e.jsxs("li",{className:A.stat,children:[e.jsx("div",{className:A.name,children:e.jsx("span",{children:u.substring(0,3)})}),e.jsx("div",{className:A.value,children:e.jsx(I,{dice:`d20+${g}`,text:`+${g}`,stats:n,context:`${w.capitalize(u)}: Save`,statblock:i})})]},u)})]}),s.saving_throws.special?e.jsx("i",{children:s.saving_throws.special}):null,e.jsx(E,{}),(t=s.senses)!=null&&t.length||(h=s.languages)!=null&&h.length||(l=s.immunities)!=null&&l.length||(c=s.weaknesses)!=null&&c.length||(o=s.resistances)!=null&&o.length?e.jsxs(e.Fragment,{children:[e.jsxs("ul",{className:A.infos,children:[(d=s.senses)!=null&&d.length?e.jsxs("li",{children:[e.jsx("b",{children:"Senses:"})," ",(s.senses||[]).join(", ")]}):null,(p=s.languages)!=null&&p.length?e.jsxs("li",{children:[e.jsx("b",{children:"Languages:"})," ",(r=s.languages)==null?void 0:r.join(", ")]}):null,(m=s.immunities)!=null&&m.length?e.jsxs("li",{children:[e.jsx("b",{children:"Immunities:"})," ",s.immunities.join(", ")]}):null,(f=s.weaknesses)!=null&&f.length?e.jsxs("li",{children:[e.jsx("b",{children:"Weaknesses:"})," ",s.weaknesses.join(", ")]}):null,(j=s.resistances)!=null&&j.length?e.jsxs("li",{children:[e.jsx("b",{children:"Resistances:"})," ",s.resistances.join(", ")]}):null]}),e.jsx(E,{})," "]}):null,s.traits&&s.traits.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h3",{className:A.heading,children:"Traits"}),e.jsx(M,{}),e.jsx("ul",{className:A.traits,children:(x=s.traits)==null?void 0:x.map((u,g)=>{let v=u.value;return u.value.includes(",")&&(v=u.value.split(",")[0]),e.jsxs("li",{className:A.trait,children:[e.jsxs("b",{children:[u.name,":"]}),e.jsx("div",{children:v})]},g)})})]}),e.jsx(E,{})]}):null,e.jsx(he,{slug:s.slug,about:s.about,stats:n,statblock:s,context:s.name})]})},Qn="_heading_13jjy_1",Gn="_skills_13jjy_7",Un="_skill_13jjy_7",be={heading:Qn,skills:Gn,skill:Un},Zn=()=>{var a;const{statblock:s,stats:n,tokenName:i}=Q();return e.jsxs("div",{children:[e.jsx("h3",{className:be.heading,children:"Skills"}),e.jsx(M,{}),e.jsx("ul",{className:be.skills,children:(a=s.skills)==null?void 0:a.map((t,h)=>{let l=0;try{l=parseInt(t.value)}catch{}return e.jsxs("li",{className:be.skill,style:{background:`linear-gradient(to right, #3f3f3f, transparent  ${l/30*100}%)`},children:[e.jsx("b",{children:w.capitalize(t.name.replaceAll("_"," "))}),e.jsx(I,{dice:`d20+${l}`,text:Intl.NumberFormat("en-US",{signDisplay:"always"}).format(Math.floor(l)),stats:n,context:`${w.capitalize(t.name)}: Check`,statblock:i})]},h)})})]})},Xn="_heading_1jstp_1",Yn="_itemName_1jstp_7",ei={heading:Xn,itemName:Yn},si=({ability:s,statblock:n,stats:i})=>{const[a,t]=b.useState(!1),h=Object.entries(s),l=()=>{let d=!1;return h.forEach(p=>{const[r,m]=p;!["name","type","description","value"].includes(r)&&m&&(d=!0)}),d},c=d=>{let p="";if(Object.keys(d).includes("type")){const r=d;if(r.type==="ONE")p="(one action)";else if(r.type==="TWO")p="(two actions)";else if(r.type==="THREE")p="(three actions)";else if(r.type==="FREE")p="(free action)";else return"";return e.jsx("span",{className:"action-type",children:p})}return""},o=d=>!!Object.keys(d).includes("type");return e.jsxs("div",{className:`pf-ability ${a?"open":""}`,children:[e.jsxs("div",{className:"main-info",children:[e.jsxs("div",{className:"name-and-description",children:[e.jsx("b",{className:"ability-name",children:s.name})," ",c(s),Object.keys(s).includes("description")&&s.description!==""?e.jsx("div",{className:`ability-description ${o(s)?"action":"ability"}`,children:e.jsx(V,{text:s.description,context:`${w.capitalize(s.name)}`,statblock:n,stats:i})}):null]}),l()?e.jsx("button",{className:`expand ${a?"open":""}`,onClick:()=>t(!a)}):null]}),e.jsx("div",{className:`action-details-wrapper  ${a?"open":null}`,children:e.jsx("ul",{className:"action-details",children:Object.entries(s).map(([d,p],r)=>{if(p!==null&&p!==""&&w.isString(p)&&!["name","type","description","value","limit"].includes(d))return e.jsxs("li",{children:[e.jsx("b",{children:d}),":"," ",e.jsx(V,{text:p,stats:i,context:`${w.capitalize(s.name)}: ${w.capitalize(d)}`,statblock:n,damageDie:d==="damage"})]},r)})})})]},s.name)},Ne=({heading:s,abilities:n})=>{const{statblock:i,stats:a}=Q();return e.jsxs("div",{children:[e.jsx("h3",{className:ei.heading,children:s}),e.jsx(M,{}),n==null?void 0:n.map((t,h)=>e.jsxs("div",{children:[e.jsx(si,{ability:t,statblock:i.name,stats:a},h),e.jsx(E,{})]},h))]})},ti=()=>{const{statblock:s,item:n}=Q(),{activeTab:i,setActiveTab:a}=xe(),t=`${n.id}-action`,h=b.useMemo(()=>{var d,p;const o=[];return(d=s.actions)!=null&&d.length&&o.push("action"),(p=s.reactions)!=null&&p.length&&o.push("reaction"),o},[s]),l=t in i?i[t]:h[0],c=b.useMemo(()=>l==="action"?e.jsx(Ne,{heading:"Actions",abilities:s.actions}):l==="reaction"?e.jsx(Ne,{heading:"Reactions",abilities:s.reactions}):e.jsx(e.Fragment,{}),[l]);return e.jsx(e.Fragment,{children:h.length===1?e.jsx(e.Fragment,{children:c}):e.jsxs("div",{className:z.actionWrapper,children:[e.jsx("ul",{className:z.tabs,children:h.map((o,d)=>e.jsx("li",{className:l===o?`${z.tab} ${z.activeTab}`:z.tab,onClick:()=>a(t,o),children:o},d))}),e.jsx("div",{className:z.content,children:c})]})})},ni="_heading_1vm31_1",ii="_sectionHeading_1vm31_7",ns={heading:ni,sectionHeading:ii},ai=s=>{var l,c,o;const[n,i]=b.useState(!1),a=$s(s.spell.slug),t=a.isSuccess&&a.data?a.data:null,h=Pe(((l=t==null?void 0:t.description)==null?void 0:l.text)||"");return e.jsxs("li",{className:"spell",children:[e.jsxs("div",{className:"spell-main",children:[e.jsxs("div",{className:"spell-info",children:[e.jsx("div",{className:"spell-header",children:e.jsx("h4",{className:"spell-name",children:t==null?void 0:t.name})}),h?e.jsxs("span",{className:"spell-damage",children:["Damage:"," ",e.jsx(V,{text:h,stats:s.stats,context:`${w.capitalize(t==null?void 0:t.name)} Damage`,statblock:s.statblock,damageDie:!0})]}):null,t!=null&&t.cast?e.jsxs("div",{className:"spell-components",children:[t.cast.verbal?"V":null,t.cast.somatic?"S":null,e.jsxs("span",{className:"spell-materials",children:[t.cast.material?"M":null,e.jsx("span",{className:"material-details",children:t.cast.cost?` (${t.cast.cost})`:null})]})]}):null]}),e.jsx("button",{className:`expand ${n?"open":null}`,onClick:()=>i(!n)})]}),e.jsx("div",{className:`spell-more-info ${n?"open":null}`,children:e.jsxs("div",{className:"more-info-content",children:[e.jsxs("div",{className:"info-bits",children:[t!=null&&t.traits&&t.traits.length>0?e.jsxs("span",{children:[e.jsx("b",{children:"Traits"}),": ",t.traits.map(d=>d.name).join(", ")]}):null,t!=null&&t.traditions&&t.traditions.length>0?e.jsxs("span",{children:[e.jsx("b",{children:"Traditions"}),": ",t.traditions.map(d=>d.name).join(", ")]}):null,t!=null&&t.bloodlines&&t.bloodlines.length>0?e.jsxs("span",{children:[e.jsx("b",{children:"Bloodlines"}),": ",t.bloodlines.map(d=>d.name).join(", ")]}):null,t!=null&&t.deities&&t.deities.length>0?e.jsxs("span",{children:[e.jsx("b",{children:"Deities"}),": ",t.deities.map(d=>d.name).join(", ")]}):null,t!=null&&t.domains&&t.domains.length>0?e.jsxs("span",{children:[e.jsx("b",{children:"Domains"}),": ",t.domains.map(d=>d.name).join(", ")]}):null,t!=null&&t.mysteries&&t.mysteries.length>0?e.jsxs("span",{children:[e.jsx("b",{children:"Mysteries"}),": ",t.mysteries.map(d=>d.name).join(", ")]}):null,t!=null&&t.range?e.jsxs("span",{children:[e.jsx("b",{children:"Range"}),": ",t==null?void 0:t.range]}):null,t!=null&&t.area?e.jsxs("span",{children:[e.jsx("b",{children:"Area"}),": ",t==null?void 0:t.area]}):null,t!=null&&t.targets?e.jsxs("span",{children:[e.jsx("b",{children:"Targets"}),": ",t==null?void 0:t.targets]}):null,t!=null&&t.duration?e.jsxs("span",{children:[e.jsx("b",{children:"Duration"}),": ",t==null?void 0:t.duration]}):null,t!=null&&t.saving_throws?e.jsxs("span",{children:[e.jsx("b",{children:"Saving Throws"}),": ",t==null?void 0:t.saving_throws]}):null,t!=null&&t.trigger?e.jsxs("span",{children:[e.jsx("b",{children:"Trigger"}),": ",t==null?void 0:t.trigger]}):null]}),e.jsxs("div",{className:"spell-description",children:[e.jsx("b",{children:"Description"}),":"," ",e.jsx(V,{text:((c=t==null?void 0:t.description)==null?void 0:c.text)||"",context:`${w.capitalize(t==null?void 0:t.name)}`,statblock:s.statblock,stats:s.stats}),(o=t==null?void 0:t.description)!=null&&o.details&&t.description.details.length>0?e.jsx("ul",{children:t==null?void 0:t.description.details.map((d,p)=>e.jsxs("li",{children:[e.jsx("b",{children:d.title}),":"," ",e.jsx(V,{text:d.text,context:`${w.capitalize(t.name)} ${d.title}`,statblock:s.statblock,stats:s.stats})]},p))}):null]}),t!=null&&t.heightened&&t.heightened.length>0?e.jsxs("div",{className:"spell-higher-level",children:[e.jsx("b",{children:"Heightened"}),":",e.jsx("div",{children:t.heightened.map((d,p)=>e.jsxs("div",{children:[e.jsx("div",{className:"modifier",children:e.jsx(V,{text:d.modifier,stats:s.stats,context:`${w.capitalize(t.name)}: Heightened`,statblock:s.statblock})}),e.jsx("div",{className:"description",children:e.jsx(V,{text:d.description,context:`${w.capitalize(t.name)}: Heightened`,statblock:s.statblock,stats:s.stats})})]},p))})]}):null]})})]})},li=s=>e.jsxs("div",{className:"spell-list",children:[e.jsxs("h4",{className:"spell-list-title",children:[e.jsxs("span",{className:"spell-list-type",children:[s.list.type,"s"]})," ",e.jsxs("span",{className:"spell-list-level",children:[s.list.level," Level"]})]}),e.jsx("ul",{className:"spells",children:s.list.spells?s.list.spells.map(n=>e.jsxs(e.Fragment,{children:[e.jsx(ai,{spell:n,statblock:s.statblock,stats:s.stats},n.slug),e.jsx(E,{})]})):null})]}),ci=s=>{const[n,i]=b.useState([]),[a,t]=b.useState(!1),h=(c,o)=>c==="All"?-1:o==="All"?1:c==="Cant"||c==="Const"?-1:o==="Cant"||o==="Const"?1:parseInt(c)-parseInt(o),l=["All"].concat(s.spellCategory.spell_lists?s.spellCategory.spell_lists.map(c=>c.type.toLowerCase().startsWith("cantrip")?"Cant":c.type.toLowerCase().startsWith("constant")?"Const":c.level):[]).filter((c,o,d)=>d.indexOf(c)===o).sort(h);return e.jsxs("div",{className:"spell-category",children:[e.jsxs("div",{className:"spell-category-main",children:[e.jsxs("div",{className:"spell-category-header",children:[e.jsx("h3",{className:ns.sectionHeading,children:s.spellCategory.name}),e.jsxs("span",{className:"spell-category-info",children:[s.spellCategory.dc?`DC: ${s.spellCategory.dc}`:null," ",s.spellCategory.attack?e.jsxs("span",{className:"text-roll",children:["Attack:"," ",e.jsx(I,{dice:`d20+${s.spellCategory.attack}`,text:`+${s.spellCategory.attack}`,stats:s.stats,context:`${w.capitalize(s.spellCategory.name)}: Attack`,statblock:s.statblock})]}):null]})]}),e.jsx("button",{className:`expand ${a?"open":null}`,onClick:()=>t(!a)})]}),e.jsx("div",{className:`spell-category-details ${a?"open":null}`,children:e.jsxs("div",{className:"spell-category-details-content",children:[e.jsx(Ye,{filters:l,spellFilter:n,setSpellFilter:i,left:!0}),s.spellCategory.spell_lists?s.spellCategory.spell_lists.sort((c,o)=>{let d=c.level,p=o.level;return c.type.toLowerCase().startsWith("cantrip")?d="Cant":c.type.toLowerCase().startsWith("constant")&&(d="Const"),o.type.toLowerCase().startsWith("cantrip")?p="Cant":o.type.toLowerCase().startsWith("constant")&&(p="Const"),h(d,p)}).filter(c=>n.length===0?!0:c.type==="spell"?n.indexOf(parseInt(c.level))>=0:c.type.toLowerCase().startsWith("cantrip")?n.indexOf(0)>=0:n.indexOf(-1)>=0).map(c=>e.jsx(li,{list:c,statblock:s.statblock,stats:s.stats},c.type+c.level)):null]})})]})},ri=s=>e.jsxs("div",{className:"spells",children:[e.jsx("h3",{className:ns.heading,children:"Spells"}),e.jsx(M,{}),s.spells.map((n,i)=>n?e.jsx(ci,{stats:s.stats,spellCategory:n,statblock:s.statblock},n.name+i):null),e.jsx(M,{})]}),oi=()=>{var n;const{statblock:s}=Q();return e.jsxs("div",{children:[e.jsx("h3",{className:J.heading,children:"Inventory"}),e.jsx(M,{}),e.jsx("ul",{children:(n=s.items)==null?void 0:n.map((i,a)=>e.jsx("li",{children:i},a))})]})},di=()=>{const{statblock:s,item:n}=Q(),{activeTab:i,setActiveTab:a}=xe(),t=n.id in i?i[n.id]:"general",h=b.useMemo(()=>{var o,d,p,r,m;const c=["general","skills"];return((o=s.actions)!=null&&o.length||(d=s.reactions)!=null&&d.length)&&c.push("actions"),(p=s.items)!=null&&p.length&&c.push("inventory"),(r=s.spells)!=null&&r.length&&c.push("spells"),(m=s.special_abilities)!=null&&m.length&&c.push("special"),c},[s]),l=b.useMemo(()=>t==="general"?e.jsx(Kn,{}):t==="skills"?e.jsx(Zn,{}):t==="actions"?e.jsx(ti,{}):t==="inventory"?e.jsx(oi,{}):t==="spells"?e.jsx(ri,{spells:s.spells,statblock:s.name,stats:s.stats}):t==="special"?e.jsx(Ne,{heading:"Reactions",abilities:s.special_abilities}):e.jsx(e.Fragment,{}),[t]);return e.jsxs("div",{className:z.wrapper,children:[e.jsx("ul",{className:z.tabs,children:h.map((c,o)=>e.jsx("li",{className:t===c?`${z.tab} ${z.activeTab}`:z.tab,onClick:()=>a(n.id,c),children:c},o))}),e.jsx("div",{className:z.content,children:l})]})},ui=()=>{const{statblock:s}=Q();return e.jsxs("div",{className:W.statblock,children:[e.jsxs("div",{className:W.title,children:[e.jsxs("div",{children:[e.jsx("h1",{className:W.name,children:s.name}),e.jsxs("div",{className:W.note,children:["Type: ",s.type,", Level: ",s.level]})]}),e.jsx(En,{})]}),e.jsx(di,{})]})},mi=({slug:s,itemId:n})=>{const i=Cs(s),a=i.isSuccess&&i.data?i.data:null;return a?e.jsx(Dn,{itemId:n,statblock:a,children:e.jsx(ui,{})}):e.jsx(te,{})},Ri=({id:s})=>{const n=K(L(t=>t.room)),i=ke(L(t=>{var h;return(h=t.tokens)==null?void 0:h.get(s)})),a=i==null?void 0:i.data;return i?e.jsx("div",{className:"statblock-wrapper",children:n&&n.ruleset==="e5"?e.jsx(Cn,{slug:a.sheet,itemId:s}):e.jsx(mi,{slug:a.sheet,itemId:s})}):null},ye=({options:s,current:n,setTheme:i})=>{const[a,t]=b.useState(n),[h,l]=b.useState(!1);return e.jsxs("div",{className:`select ${h?"open":"close"}`,children:[e.jsxs("div",{className:"select-current",onClick:()=>l(!0),children:[e.jsxs("span",{className:"current",children:[(a==null?void 0:a.icon)||null,e.jsx("span",{children:(a==null?void 0:a.name)||""})]}),e.jsx("div",{className:"expand-wrapper",children:e.jsx("button",{className:"expand button"})})]}),e.jsx("div",{className:"height-wrapper",children:e.jsxs("div",{className:"options-wrapper",children:[e.jsx("div",{className:"select-options",children:s.sort((c,o)=>c.value===(a==null?void 0:a.value)?-1:o.value===(a==null?void 0:a.value)?1:0).map(c=>e.jsxs("div",{className:`select-option ${(a==null?void 0:a.value)===c.value?"current":""}`,onClick:()=>{t(c),i(c.value),l(!1)},children:[c.icon||null,e.jsxs("span",{className:"name",children:[c.name," "]})]},c.value))}),e.jsx("div",{className:"expand-wrapper",onClick:()=>{l(!1)},children:e.jsx("button",{className:"expand button"})})]})})]})},hi=({setSettings:s})=>{var u;const n=K(L(g=>g.room)),[i,a,t,h,l]=me(L(g=>[g.rollerApi,g.theme,g.setTheme,g.themes,g.rooms])),c=ne(),[o,d]=b.useState(!0),[p,r]=b.useState(!1),[m,f]=b.useState(null),j=l.find(g=>{var v;return g.slug===((v=n==null?void 0:n.diceRoom)==null?void 0:v.slug)}),x=async(g,v)=>{var S;try{r(!0);const y=(S=await(i==null?void 0:i.theme.get(g)))==null?void 0:S.data;y&&Le(y)?y.id!==(a==null?void 0:a.id)&&(n&&c.id?(await re(n,c.id,{diceTheme:y.id}),d(!0),t(y)):(v&&(v.value=(a==null?void 0:a.id)||""),f("error updating theme"),d(!1))):d(!1)}catch{v&&(v.value=(a==null?void 0:a.id)||""),f("theme not found"),d(!1)}finally{r(!1)}};return b.useEffect(()=>{m&&setTimeout(()=>{f(null)},5e3)},[m]),e.jsxs("div",{className:"dice-settings",children:[e.jsx("button",{className:"close-button",onClick:()=>{s(!1)},children:"X"}),i?e.jsxs("div",{className:`setting dice-theme ${o?"valid":"invalid"} ${p?"searching":""}`,children:[e.jsx("span",{className:"setting-name",children:"dice theme:"}),e.jsx(ye,{options:w.isNull(h)?[]:h.filter(g=>Le(g)).map(g=>({value:g.id,name:g.name||g.id,icon:ee(g)})),current:a?{value:a.id,name:a.name,icon:ee(a)}:void 0,setTheme:x})]}):e.jsx("span",{children:"Unable to connect with dddice"}),m?e.jsx("span",{children:m}):null,c.role==="GM"?e.jsxs("div",{className:"setting dice-room-select valid",children:[e.jsx("span",{className:"setting-name",children:"dice room:"}),l.length===0&&!j?e.jsx(te,{className:"room-loader"}):e.jsx(ye,{options:l.map(g=>({value:g.slug,name:`${g.name} - ${g.slug}`})),current:j?{value:j.slug,name:`${j.name} - ${j.slug}`}:void 0,setTheme:async g=>{n&&await vs(n,g)}})]}):null,e.jsxs("div",{className:"setting dice-rendering",children:[e.jsx("span",{className:"text",children:"Render 3D Dice "}),e.jsx("input",{type:"checkbox",checked:((u=_e(n,c.id))==null?void 0:u.diceRendering)??!0,onChange:async()=>{if(n){const g=U.player.id,v=_e(n,g);v&&(await re(n,g,{diceRendering:!v.diceRendering}),v.diceRendering||await U.modal.open({...bs,url:`https://dddice.com/room/${n.diceRoom.slug}/stream?key=${v.apiKey}`}))}}})]})]})},se=()=>e.jsx("svg",{className:"dice-svg",viewBox:"0 0 50 50",version:"1.1",children:e.jsxs("g",{transform:"matrix(0.09730448,0,0,0.09730448,0.02976391,0.15890765)",children:[e.jsx("path",{d:"M 449.532,105.602 288.463,8.989 C 278.474,2.994 267.235,0 256.011,0 244.772,0 233.528,2.994 223.544,8.989 L 62.475,105.602 c -19.012,11.406 -30.647,31.95 -30.647,54.117 v 192.562 c 0,22.168 11.635,42.711 30.647,54.117 l 161.069,96.613 c 9.984,5.988 21.228,8.989 32.467,8.989 11.225,0 22.463,-3.001 32.452,-8.989 l 161.069,-96.613 c 19.012,-11.406 30.64,-31.949 30.64,-54.117 V 159.719 c 0,-22.167 -11.628,-42.711 -30.64,-54.117 z M 250.599,492.733 c -6.029,-0.745 -11.93,-2.719 -17.32,-5.948 L 72.21,390.172 C 58.904,382.183 50.754,367.803 50.754,352.281 V 159.719 c 0,-6.022 1.236,-11.862 3.518,-17.233 L 250.6,260.246 V 492.733 Z M 59.669,133.114 c 3.364,-4.464 7.593,-8.318 12.541,-11.285 L 233.279,25.216 c 6.995,-4.196 14.85,-6.291 22.732,-6.291 7.868,0 15.723,2.095 22.718,6.291 l 161.069,96.613 c 4.941,2.967 9.184,6.821 12.54,11.285 L 256.011,250.881 Z m 401.585,219.167 c 0,15.522 -8.15,29.902 -21.456,37.891 l -161.069,96.613 c -5.398,3.229 -11.292,5.203 -17.321,5.948 V 260.246 l 196.328,-117.76 c 2.283,5.37 3.518,11.211 3.518,17.233 z"}),e.jsx("path",{d:"m 160.209,119.875 c -9.828,-7.278 -26.021,-7.465 -36.165,-0.41 -10.144,7.056 -10.399,18.67 -0.57,25.947 9.828,7.277 26.022,7.459 36.159,0.41 10.15,-7.056 10.405,-18.67 0.576,-25.947 z"}),e.jsx("path",{d:"m 279.159,48.686 c -9.829,-7.277 -26.022,-7.458 -36.172,-0.403 -10.137,7.049 -10.393,18.664 -0.564,25.941 9.829,7.284 26.022,7.458 36.159,0.416 10.15,-7.062 10.405,-18.677 0.577,-25.954 z"}),e.jsx("path",{d:"m 220.59,82.024 c -9.834,-7.27 -26.028,-7.458 -36.172,-0.403 -10.15,7.049 -10.406,18.664 -0.571,25.941 9.829,7.284 26.022,7.458 36.166,0.416 10.138,-7.062 10.399,-18.676 0.577,-25.954 z"}),e.jsx("path",{d:"m 267.437,184.754 c -9.828,-7.277 -26.015,-7.459 -36.159,-0.41 -10.15,7.056 -10.405,18.671 -0.577,25.947 9.828,7.284 26.021,7.459 36.172,0.41 10.137,-7.056 10.392,-18.67 0.564,-25.947 z"}),e.jsx("path",{d:"m 386.385,113.564 c -9.828,-7.271 -26.021,-7.458 -36.158,-0.403 -10.151,7.049 -10.406,18.664 -0.577,25.941 9.828,7.284 26.02,7.458 36.172,0.416 10.137,-7.062 10.392,-18.676 0.563,-25.954 z"}),e.jsx("path",{d:"m 327.817,146.903 c -9.829,-7.27 -26.022,-7.458 -36.172,-0.403 -10.137,7.049 -10.392,18.664 -0.564,25.941 9.828,7.284 26.021,7.465 36.158,0.416 10.152,-7.062 10.407,-18.669 0.578,-25.954 z"}),e.jsx("path",{d:"m 89.289,248.303 c 11.158,6.083 20.194,1.961 20.194,-9.19 0,-11.158 -9.036,-25.128 -20.194,-31.21 -11.157,-6.083 -20.207,-1.967 -20.207,9.19 -10e-4,11.151 9.049,25.128 20.207,31.21 z"}),e.jsx("path",{d:"m 202.061,309.771 c 11.158,6.082 20.208,1.967 20.208,-9.184 0,-11.157 -9.05,-25.135 -20.208,-31.217 -11.15,-6.076 -20.194,-1.961 -20.194,9.198 0,11.151 9.044,25.121 20.194,31.203 z"}),e.jsx("path",{d:"m 89.289,361.082 c 11.158,6.076 20.194,1.967 20.194,-9.19 0,-11.158 -9.036,-25.129 -20.194,-31.21 -11.157,-6.083 -20.207,-1.968 -20.207,9.19 -10e-4,11.157 9.049,25.128 20.207,31.21 z"}),e.jsx("path",{d:"m 202.061,422.55 c 11.158,6.082 20.208,1.967 20.208,-9.191 0,-11.151 -9.05,-25.128 -20.208,-31.21 -11.15,-6.076 -20.194,-1.961 -20.194,9.19 0,11.158 9.044,25.129 20.194,31.211 z"}),e.jsx("path",{d:"m 145.675,335.424 c 11.158,6.082 20.201,1.967 20.201,-9.191 0,-11.151 -9.044,-25.128 -20.201,-31.204 -11.158,-6.082 -20.201,-1.967 -20.201,9.185 0,11.156 9.043,25.127 20.201,31.21 z"}),e.jsx("path",{d:"m 418.341,207.902 c -11.158,6.082 -20.208,20.053 -20.208,31.21 0,11.151 9.05,15.273 20.208,9.19 11.144,-6.082 20.194,-20.059 20.194,-31.21 0,-11.157 -9.049,-15.273 -20.194,-9.19 z"}),e.jsx("path",{d:"m 305.555,382.149 c -11.158,6.082 -20.194,20.059 -20.194,31.21 0,11.158 9.036,15.273 20.194,9.191 11.158,-6.082 20.194,-20.053 20.194,-31.211 0,-11.151 -9.035,-15.265 -20.194,-9.19 z"}),e.jsx("path",{d:"m 361.948,295.028 c -11.158,6.076 -20.207,20.053 -20.207,31.204 0,11.158 9.05,15.273 20.207,9.191 11.158,-6.083 20.194,-20.053 20.194,-31.21 0,-11.151 -9.036,-15.266 -20.194,-9.185 z"})]})}),xi=()=>e.jsx("svg",{className:"add-svg",height:"24",viewBox:"0 -960 960 960",width:"24",children:e.jsx("path",{d:"M440-440H200v-80h240v-240h80v240h240v80H520v240h-80v-240Z"})}),ji=()=>e.jsxs("svg",{className:"roll-log-svg",viewBox:"0 0 128 128",width:"64px",height:"64px",children:[e.jsx("path",{d:"M 114.638,0.55489756 H 23.775355 c -7.269012,0 -13.124604,5.85559234 -13.124604,13.12460444 v 77.73804 c 0,1.716297 1.31246,3.028759 3.028754,3.028759 1.716294,0 3.028755,-1.312462 3.028755,-3.028759 v -77.73804 c 0,-3.9373809 3.129713,-7.0670952 7.067095,-7.0670952 h 79.757215 c -1.31246,2.0191707 -2.01917,4.4421742 -2.01917,7.0670952 V 114.638 c 0,3.93738 -3.129714,7.06709 -7.06709,7.06709 -3.937384,0 -7.067098,-3.12971 -7.067098,-7.06709 v -10.09585 c 0,-1.7163 -1.312461,-3.02876 -3.028761,-3.02876 H 3.5836557 c -1.7162944,0 -3.02875499,1.31246 -3.02875499,3.02876 V 114.638 c 0,7.26901 5.85559229,13.1246 13.12460429,13.1246 H 94.44631 c 7.26901,0 13.1246,-5.85559 13.1246,-13.1246 V 13.679502 c 0,-3.9373809 3.12972,-7.0670952 7.06709,-7.0670952 3.93739,0 7.0671,3.1297143 7.0671,7.0670952 v 7.067095 h -7.0671 c -1.71629,0 -3.02875,1.31246 -3.02875,3.028755 0,1.716294 1.31246,3.028754 3.02875,3.028754 h 10.09585 c 1.7163,0 3.02876,-1.31246 3.02876,-3.028754 v -10.09585 c 0,-7.2690121 -5.85559,-13.12460444 -13.12461,-13.12460444 z M 13.679505,121.70509 c -3.9373809,0 -7.0670942,-3.12971 -7.0670942,-7.06709 v -7.0671 H 81.321701 v 7.0671 c 0,2.62492 0.807662,5.04792 2.019169,7.06709 z"}),e.jsxs("g",{transform:"matrix(0.15293651,0,0,0.15293651,20.080574,15.684728)",children:[e.jsx("path",{d:"M 449.532,105.602 288.463,8.989 C 278.474,2.994 267.235,0 256.011,0 244.772,0 233.528,2.994 223.544,8.989 L 62.475,105.602 c -19.012,11.406 -30.647,31.95 -30.647,54.117 v 192.562 c 0,22.168 11.635,42.711 30.647,54.117 l 161.069,96.613 c 9.984,5.988 21.228,8.989 32.467,8.989 11.225,0 22.463,-3.001 32.452,-8.989 l 161.069,-96.613 c 19.012,-11.406 30.64,-31.949 30.64,-54.117 V 159.719 c 0,-22.167 -11.628,-42.711 -30.64,-54.117 z M 250.599,492.733 c -6.029,-0.745 -11.93,-2.719 -17.32,-5.948 L 72.21,390.172 C 58.904,382.183 50.754,367.803 50.754,352.281 V 159.719 c 0,-6.022 1.236,-11.862 3.518,-17.233 L 250.6,260.246 V 492.733 Z M 59.669,133.114 c 3.364,-4.464 7.593,-8.318 12.541,-11.285 L 233.279,25.216 c 6.995,-4.196 14.85,-6.291 22.732,-6.291 7.868,0 15.723,2.095 22.718,6.291 l 161.069,96.613 c 4.941,2.967 9.184,6.821 12.54,11.285 L 256.011,250.881 Z m 401.585,219.167 c 0,15.522 -8.15,29.902 -21.456,37.891 l -161.069,96.613 c -5.398,3.229 -11.292,5.203 -17.321,5.948 V 260.246 l 196.328,-117.76 c 2.283,5.37 3.518,11.211 3.518,17.233 z"}),e.jsx("path",{d:"m 160.209,119.875 c -9.828,-7.278 -26.021,-7.465 -36.165,-0.41 -10.144,7.056 -10.399,18.67 -0.57,25.947 9.828,7.277 26.022,7.459 36.159,0.41 10.15,-7.056 10.405,-18.67 0.576,-25.947 z"}),e.jsx("path",{d:"m 279.159,48.686 c -9.829,-7.277 -26.022,-7.458 -36.172,-0.403 -10.137,7.049 -10.393,18.664 -0.564,25.941 9.829,7.284 26.022,7.458 36.159,0.416 10.15,-7.062 10.405,-18.677 0.577,-25.954 z"}),e.jsx("path",{d:"m 220.59,82.024 c -9.834,-7.27 -26.028,-7.458 -36.172,-0.403 -10.15,7.049 -10.406,18.664 -0.571,25.941 9.829,7.284 26.022,7.458 36.166,0.416 10.138,-7.062 10.399,-18.676 0.577,-25.954 z"}),e.jsx("path",{d:"m 267.437,184.754 c -9.828,-7.277 -26.015,-7.459 -36.159,-0.41 -10.15,7.056 -10.405,18.671 -0.577,25.947 9.828,7.284 26.021,7.459 36.172,0.41 10.137,-7.056 10.392,-18.67 0.564,-25.947 z"}),e.jsx("path",{d:"m 386.385,113.564 c -9.828,-7.271 -26.021,-7.458 -36.158,-0.403 -10.151,7.049 -10.406,18.664 -0.577,25.941 9.828,7.284 26.02,7.458 36.172,0.416 10.137,-7.062 10.392,-18.676 0.563,-25.954 z"}),e.jsx("path",{d:"m 327.817,146.903 c -9.829,-7.27 -26.022,-7.458 -36.172,-0.403 -10.137,7.049 -10.392,18.664 -0.564,25.941 9.828,7.284 26.021,7.465 36.158,0.416 10.152,-7.062 10.407,-18.669 0.578,-25.954 z"}),e.jsx("path",{d:"m 89.289,248.303 c 11.158,6.083 20.194,1.961 20.194,-9.19 0,-11.158 -9.036,-25.128 -20.194,-31.21 -11.157,-6.083 -20.207,-1.967 -20.207,9.19 -10e-4,11.151 9.049,25.128 20.207,31.21 z"}),e.jsx("path",{d:"m 202.061,309.771 c 11.158,6.082 20.208,1.967 20.208,-9.184 0,-11.157 -9.05,-25.135 -20.208,-31.217 -11.15,-6.076 -20.194,-1.961 -20.194,9.198 0,11.151 9.044,25.121 20.194,31.203 z"}),e.jsx("path",{d:"m 89.289,361.082 c 11.158,6.076 20.194,1.967 20.194,-9.19 0,-11.158 -9.036,-25.129 -20.194,-31.21 -11.157,-6.083 -20.207,-1.968 -20.207,9.19 -10e-4,11.157 9.049,25.128 20.207,31.21 z"}),e.jsx("path",{d:"m 202.061,422.55 c 11.158,6.082 20.208,1.967 20.208,-9.191 0,-11.151 -9.05,-25.128 -20.208,-31.21 -11.15,-6.076 -20.194,-1.961 -20.194,9.19 0,11.158 9.044,25.129 20.194,31.211 z"}),e.jsx("path",{d:"m 145.675,335.424 c 11.158,6.082 20.201,1.967 20.201,-9.191 0,-11.151 -9.044,-25.128 -20.201,-31.204 -11.158,-6.082 -20.201,-1.967 -20.201,9.185 0,11.156 9.043,25.127 20.201,31.21 z"}),e.jsx("path",{d:"m 418.341,207.902 c -11.158,6.082 -20.208,20.053 -20.208,31.21 0,11.151 9.05,15.273 20.208,9.19 11.144,-6.082 20.194,-20.059 20.194,-31.21 0,-11.157 -9.049,-15.273 -20.194,-9.19 z"}),e.jsx("path",{d:"m 305.555,382.149 c -11.158,6.082 -20.194,20.059 -20.194,31.21 0,11.158 9.036,15.273 20.194,9.191 11.158,-6.082 20.194,-20.053 20.194,-31.211 0,-11.151 -9.035,-15.265 -20.194,-9.19 z"}),e.jsx("path",{d:"m 361.948,295.028 c -11.158,6.076 -20.207,20.053 -20.207,31.204 0,11.158 9.05,15.273 20.207,9.191 11.158,-6.083 20.194,-20.053 20.194,-31.21 0,-11.151 -9.036,-15.266 -20.194,-9.185 z"})]})]}),pi=s=>{const[n,i,a,t]=me(L(_=>[_.rollerApi,_.theme,_.initialized,_.themes])),h=ue(L(_=>_.addRoll)),{buttons:l,setButtons:c}=Be(),[o,d]=K(L(_=>[_.room,_.taSettings])),[p,r]=b.useState(!1),[m,f]=b.useState(!1),[j,x]=b.useState(!1),[u,g]=b.useState(i),v=b.useRef(null),y=ne().role==="GM"&&!!d.gm_rolls_hidden;b.useEffect(()=>{g(i)},[i]);const D=_=>{if(!w.isNull(t)){const k=t.find(N=>N.id===_);k&&g(k)}},T=b.useCallback(()=>{if(s.customDice&&i&&!(o!=null&&o.disableDiceRoller))try{const _=ae.parseRollEquation(s.customDice.dice,s.customDice.theme??i.id);return e.jsx("div",{className:"custom-dice-preview-wrapper",children:_.dice.map((k,N)=>{var $;if(k.type!=="mod"){const q=Ds(i,k.type,N,($=s.customDice)==null?void 0:$.theme,t);if(q)return q}if(k.type!=="mod"&&i.preview.hasOwnProperty(k.type))return e.jsx("img",{className:"preview-image",src:i.preview[k.type],alt:k.type},N);if(k.type!=="mod"&&!i.preview.hasOwnProperty(k.type))return e.jsx("div",{className:"preview-image",children:oe(k.type)},N);if(k.value)return e.jsx("span",{className:"modifier",children:Intl.NumberFormat("en-US",{signDisplay:"always"}).format(k.value)},N)})})}catch{return e.jsx(se,{})}else if(s.customDice)try{const _=ae.parseRollEquation(s.customDice.dice,s.customDice.theme??"dddice-bees");return e.jsx("div",{className:"custom-dice-preview-wrapper",children:_.dice.map((k,N)=>{if(k.type!=="mod")return e.jsx("div",{className:"preview-image",children:oe(k.type)},N);if(k.value)return e.jsx("span",{className:"modifier",children:Intl.NumberFormat("en-US",{signDisplay:"always"}).format(k.value)},N)})})}catch{return e.jsx(se,{})}return e.jsx(se,{})},[i,s.customDice,o==null?void 0:o.disableDiceRoller,t,n]),C=async(_,k=!1)=>{if(_.classList.add("rolling"),!(o!=null&&o.disableDiceRoller)&&n&&i&&s.customDice){let N=He(s.customDice.dice,s.customDice.theme??i.id);await Je(n,N.dice,{operator:N.operator,label:"Roll: Custom",whisper:k?await Ve(o,n):void 0})}else s.customDice&&await We(s.customDice.dice,"Roll: Custom",h,k);_.classList.remove("rolling"),_.blur()},F=b.useCallback(()=>a&&!(o!=null&&o.disableDiceRoller)||(o==null?void 0:o.disableDiceRoller),[a,o==null?void 0:o.disableDiceRoller]);return e.jsxs("div",{className:`custom-dice-wrapper ${s.customDice&&!s.customDice.removed?"has-dice":""}`,onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:[e.jsx(O,{content:s.customDice&&!s.customDice.removed?s.customDice.dice:"Add new custom dice roll",children:e.jsx("button",{className:`button custom-dice dice-${s.button} ${F()?"enabled":"disabled"} ${m?"open":""}`,onClick:async _=>{(!s.customDice||s.customDice.removed)&&l.hasOwnProperty(String(s.button))?f(!0):s.customDice&&!s.customDice.removed&&await C(_.currentTarget,y)},children:s.customDice&&!s.customDice.removed?T():e.jsx(xi,{})})}),m?e.jsxs("div",{className:"add-custom-dice",children:[o!=null&&o.disableDiceRoller?null:e.jsx("div",{className:"setting dice-theme valid searching",children:e.jsx(ye,{options:w.isNull(t)?[]:t.map(_=>({value:_.id,name:_.name||_.id,icon:ee(_)})),current:{value:(u==null?void 0:u.id)||(i==null?void 0:i.id)||"",name:(u==null?void 0:u.name)||(i==null?void 0:i.name)||"",icon:u?ee(u):i?ee(i):void 0},setTheme:D})}),e.jsxs("div",{className:"dice-equation",children:[e.jsx("input",{ref:v,type:"text",onChange:_=>{var N,$,q,$e,Ce,De;const k=_.currentTarget.value;try{u&&!(o!=null&&o.disableDiceRoller)?ae.parseRollEquation(k,u)&&(x(!0),(N=v.current)==null||N.classList.remove("error"),($=v.current)==null||$.classList.add("success")):new Me(k)&&(x(!0),(q=v.current)==null||q.classList.remove("error"),($e=v.current)==null||$e.classList.add("success"))}catch{x(!1),(Ce=v.current)==null||Ce.classList.remove("success"),(De=v.current)==null||De.classList.add("error")}},onKeyDown:_=>{if(_.key==="Enter"&&j){const k={[s.button]:{dice:_.currentTarget.value,theme:u?u.id:i?i.id:"dddice-bees"}};c(k),f(!1),x(!1)}else _.key==="Escape"&&f(!1)}}),e.jsx("button",{className:"save-custom-dice",disabled:!j,onClick:()=>{if(v.current){const _={[s.button]:{dice:v.current.value,theme:u?u.id:i?i.id:"dddice-bees"}};c(_),f(!1),x(!1)}},children:"âˆš"}),e.jsx("button",{className:"abort-custom-dice",onClick:()=>{f(!1)},children:"X"})]})]}):null,s.customDice&&!s.customDice.removed?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`hidden-roll self ${p?"hover":""}`,onClick:_=>{_.currentTarget.parentElement&&C(_.currentTarget.parentElement,!y)},children:y?"SHOW":"HIDE"}),e.jsx("button",{className:`remove-dice ${p?"hover":""}`,onClick:()=>{if(s.customDice&&!s.customDice.removed&&l.hasOwnProperty(String(s.button))){const _={[s.button]:{...s.customDice,removed:!0}};c(_)}},children:"x"})]}):null]})},fi=({open:s})=>{const{theme:n,rollerApi:i}=me(),a=ue(L(m=>m.addRoll)),[t,h]=K(L(m=>[m.room,m.taSettings])),[l,c]=b.useState(!0),d=ne().role==="GM"&&!!h.gm_rolls_hidden,p=async(m,f,j=!1)=>{if(m.classList.add("rolling"),n&&f&&!(t!=null&&t.disableDiceRoller)){let x=He(f,n.id);i&&await Je(i,x.dice,{operator:x.operator,label:"Roll: Custom",whisper:j?await Ve(t,i):void 0})}else await We(f,"Roll: Custom",a,j);m.classList.remove("rolling"),m.blur()},r=()=>{const m=({preview:f,name:j})=>e.jsx(O,{content:j,children:e.jsxs("li",{className:"quick-roll",onClick:async x=>{await p(x.currentTarget,j,d)},children:[e.jsx("div",{className:"quick-preview",children:f}),e.jsx("button",{className:"self",onClick:async x=>{x.stopPropagation(),x.currentTarget.parentElement&&await p(x.currentTarget.parentElement,j,!d)},children:d?"SHOW":"HIDE"})]})});return n&&!(t!=null&&t.disableDiceRoller)?n.available_dice.map((f,j)=>{let x="",u="";try{if(f.hasOwnProperty("type")){const g=f.notation,v=f.id;n.preview.hasOwnProperty(v)?x=n.preview[v]:g&&n.preview.hasOwnProperty(g)?x=n.preview[g]:x=n.preview[f.type],u=f.notation??f.id}else x=n.preview[f],u=String(f);if(u)return u=u==="d10x"?"d100":u,e.jsx(m,{preview:x?e.jsx("img",{src:x,alt:u}):oe(u),name:u},j)}catch{return null}}):["d4","d6","d8","d10","d10x","d12","d20"].map((j,x)=>{const u=j==="d10x"?"d100":j;return e.jsx(m,{preview:oe(j),name:u},x)})};return e.jsx(e.Fragment,{children:e.jsxs("ul",{className:`quick-button-list ${s?"open":""}`,children:[r(),e.jsxs("li",{className:"quick-custom-roll",children:[e.jsx(se,{}),e.jsx("input",{className:`quick-custom-input ${l?"valid":"invalid"}`,type:"text",size:2,onChange:m=>{if(m.currentTarget.style.width=`${m.currentTarget.value.length}ch`,m.currentTarget.value===""){c(!0);return}try{if(n&&!(t!=null&&t.disableDiceRoller)){const f=ae.parseRollEquation(m.currentTarget.value,n.id);c(!!f)}else new Me(m.currentTarget.value)&&c(!0)}catch{c(!1)}},onKeyDown:async m=>{m.key==="Enter"&&l&&m.currentTarget.value&&await p(m.currentTarget,m.currentTarget.value)}})]})]})})},gi=s=>{const{buttons:n,setButtons:i}=Be(),[a,t]=b.useState(!1);return b.useEffect(()=>{n&&Object.entries(n).forEach(([h,l])=>{l&&w.isString(l)&&i({[h]:null})})},[n]),e.jsxs("div",{className:"dice-room-buttons",children:[Object.values(n).map((h,l)=>e.jsx(pi,{button:l+1,customDice:h},l)),e.jsx(O,{content:"Log & Settings",children:e.jsx("button",{className:`open-dice-tray button icon ${s.open?"open":"closed"}`,onClick:h=>{s.setOpen(!s.open),h.currentTarget.blur()},children:e.jsx(ji,{})})}),e.jsxs("div",{className:"quick-button-wrapper",children:[e.jsx(fi,{open:a}),e.jsx(O,{content:"Quick roll",children:e.jsx("button",{onClick:()=>t(!a),className:`quick-roll-button button icon ${a?"open":""}`,children:e.jsx(se,{})})})]})]})},vi=()=>e.jsx("svg",{className:"copy-icon",height:"18.499901",viewBox:"0 -960 619.99603 739.99603",width:"15.499901",version:"1.1",children:e.jsx("path",{d:"m 212.306,-360.002 q -30.308,0 -51.307,-21 -21,-21 -21,-51.308 v -455.382 q 0,-30.308 21,-51.308 20.999,-21 51.307,-21 h 335.383 q 30.307,0 51.307,21 21,21 21,51.308 v 455.382 q 0,30.308 -21,51.308 -21,21 -51.307,21 z m 0,-59.999 h 335.383 q 4.615,0 8.462,-3.846 3.846,-3.847 3.846,-8.463 v -455.382 q 0,-4.616 -3.846,-8.463 -3.847,-3.846 -8.462,-3.846 H 212.306 q -4.616,0 -8.462,3.846 -3.847,3.847 -3.847,8.463 v 455.382 q 0,4.616 3.847,8.463 3.846,3.846 8.462,3.846 z M 72.307001,-220.004 q -30.307,0 -51.307,-21 Q 1.0986328e-6,-262.004 1.0986328e-6,-292.311 V -807.692 H 59.999001 v 515.381 q 0,4.616 3.846,8.462 3.847,3.847 8.462,3.847 H 467.689 v 59.998 z M 199.997,-420.001 v -480 z"})}),bi=({className:s,user:n})=>{var d;const i=K(L(p=>p.room)),a=ue(L(p=>p.clear)),[t,h]=b.useState(!1),[l,c]=b.useState(!1),o=ne();return b.useEffect(()=>{l||h(!1)},[l]),e.jsxs("div",{className:`dice-room ${s} ${l?"open":"closed"}`,children:[e.jsx(gi,{open:l,setOpen:c}),e.jsx("div",{className:"dice-tray-wrapper",children:e.jsx("div",{className:`dice-tray ${l?"open":"closed"}`,children:e.jsxs("div",{className:"dice-tray-content",children:[e.jsx("div",{className:"top",children:i!=null&&i.disableDiceRoller?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"clear-log",onClick:()=>{a()},children:"Clear"}),o.role==="GM"?e.jsx("button",{onClick:async()=>{await _s(i,{disableDiceRoller:!1})},children:"Enabled dddice Integration"}):null]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"dddice-login",onClick:async()=>{let p=500,r=600;try{p=await U.viewport.getWidth(),r=await U.viewport.getHeight()}catch{}await U.modal.open({...Ns,width:Math.min(400,p*.9),height:Math.min(500,r*.9)})},children:n&&n.name!=="Guest User"?n.username:"Login"}),e.jsxs("div",{className:"room-link",children:[e.jsx("a",{href:`https://dddice.com/room/${(d=i==null?void 0:i.diceRoom)==null?void 0:d.slug}`,target:"_blank",children:"Room Link"}),e.jsx("button",{className:"copy-link",onClick:p=>{var r;navigator.clipboard.writeText(`https://dddice.com/room/${(r=i==null?void 0:i.diceRoom)==null?void 0:r.slug}`),p.currentTarget.blur()},children:e.jsx(vi,{})})]}),e.jsxs("div",{className:"side-buttons",children:[e.jsx("button",{className:"clear-log",onClick:()=>{a()},children:"Clear"}),e.jsxs("div",{className:"dice-settings-wrapper",children:[e.jsx("button",{className:"dice-settings-button",onClick:()=>{h(!t)},children:"Settings"}),t?e.jsx(hi,{setSettings:h}):null]})]})]})}),e.jsx(Ts,{})]})})})]})},je="https://dddice.com/api/1.0",_i=async(s,n)=>Ke.request({url:n??`${je}/dice-box`,headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json",Accept:"application/json"}}).then(i=>i.status===200?i.data:null),Ni=s=>Ze({queryKey:["themes"],queryFn:async({pageParam:n})=>await _i(s,n),initialPageParam:`${je}/dice-box`,getNextPageParam:n=>n.links.next,enabled:s!==""}),yi=async(s,n)=>Ke.request({url:n??`${je}/room`,headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json",Accept:"application/json"}}).then(i=>i.status===200?i.data:null),ki=s=>Ze({queryKey:["rooms"],queryFn:async({pageParam:n})=>await yi(s,n),initialPageParam:`${je}/room`,getNextPageParam:n=>n.links.next,enabled:s!==""}),Ei=s=>{var T;const[n,i,a,t,h,l,c,o,d]=me(L(C=>[C.rollerApi,C.setRollerApi,C.setInitialized,C.theme,C.setTheme,C.themes,C.setThemes,C.rooms,C.setRooms])),p=ne(),r=K(L(C=>C.room)),[m,f]=b.useState(),[j,x]=b.useState(),[u,g]=b.useState(),[v,S]=b.useState(),y=Ni((m==null?void 0:m.apiKey)||""),D=ki((m==null?void 0:m.apiKey)||"");return b.useEffect(()=>{if(p.role==="GM"&&o.length===0){if(D.hasNextPage&&!D.isFetchingNextPage)D.fetchNextPage();else if(!D.hasNextPage&&D.isSuccess){const C=D.isSuccess?D.data.pages.flatMap(F=>F.data):[];d(C)}}},[D.hasNextPage,D.isFetchingNextPage,D.isSuccess]),b.useEffect(()=>{if(w.isNull(l)){if(y.hasNextPage&&!y.isFetchingNextPage)y.fetchNextPage();else if(!y.hasNextPage&&y.isSuccess){const C=y.isSuccess?y.data.pages.flatMap(F=>F.data):[];c(C)}}},[y.hasNextPage,y.isFetchingNextPage,y.isSuccess]),b.useEffect(()=>{const C=_e(r,p.id);if(C){const F=C.apiKey,_=C.diceRendering;m?(F!==void 0&&F!==m.apiKey||_!==m.diceRendering)&&f({...C}):f({...C})}},[r]),b.useEffect(()=>{var F,_;const C=async()=>{var N;let k;a(!1),(m==null?void 0:m.apiKey)!==j&&(m==null?void 0:m.apiKey)!==void 0&&(x(m==null?void 0:m.apiKey),g((N=r==null?void 0:r.diceRoom)==null?void 0:N.slug),k=await ks(r,v),k&&(i(k),S(await Ss(k)))),a(!0)};(m&&m.apiKey!==void 0||!m)&&!(r!=null&&r.disableDiceRoller)&&m!=null&&m.apiKey&&C(),n&&((F=r==null?void 0:r.diceRoom)!=null&&F.slug)&&((_=r==null?void 0:r.diceRoom)==null?void 0:_.slug)!==u&&(g(r.diceRoom.slug),ys(n,r,v))},[m,r==null?void 0:r.disableDiceRoller,(T=r==null?void 0:r.diceRoom)==null?void 0:T.slug]),b.useEffect(()=>{const C=async()=>{var _;if(!w.isNull(l)&&l.length>0)h(l[0]),r&&await re(r,U.player.id,{diceTheme:l[0].id});else{const k=(_=await(n==null?void 0:n.theme.get("dddice-bees")))==null?void 0:_.data;k&&(h(k),r&&await re(r,U.player.id,{diceTheme:k.id}))}},F=async()=>{var _,k,N;if(t)!w.isNull(l)&&!l.includes(t)&&await C();else{const $=(k=(_=r==null?void 0:r.diceUser)==null?void 0:_.find(q=>q.playerId===p.id))==null?void 0:k.diceTheme;if($&&!w.isNull(l)&&l.map(q=>q.id).includes($)){const q=(N=await(n==null?void 0:n.theme.get($)))==null?void 0:N.data;q&&h(q)}else await C()}};n&&!w.isNull(l)&&F()},[n,y.isSuccess,m==null?void 0:m.diceTheme,l]),e.jsx(bi,{className:s.classes,user:v})};export{Ei as D,Ri as S};
