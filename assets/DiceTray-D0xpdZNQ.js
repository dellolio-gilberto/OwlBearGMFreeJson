import{Q as is,t as Te,w as as,x as ls,y as cs,u as R,j as e,L as te,a as H,M as rs,r as os,b as ne}from"./main-D33kKYtJ.js";import{u as ke}from"./TokenContextWrapper-CL6lkKq2.js";import{e as Pe,g as qe,f as Be,h as ds,i as us,j as ms}from"./usePfApi-Dw1gI2SG.js";import{r as _,at as hs,g as Ee,au as xs,L as we,f as Ae,i as le,av as Re,H as js,J as ps,aw as X,z as k,I as Me,K as Ie,M as Oe,ax as ce,d as ue,ay as He,az as gs,aA as fs,aB as ze,aC as vs,c as me,aD as Le,aE as bs,e as _e,O as Z,ap as re,a2 as _s,aF as Ke,aG as ae,aH as We,h as Ve,aI as Ge,j as Qe,l as Ue,a as ys,aJ as Ns,aK as Ze,$ as ks,a1 as ws,aL as $s}from"./diceHelper-DTvQmLvU.js";import{j as W,i as F,k as B,l as ee,a as Cs,g as oe}from"./DiceButtonWrapper-BVPHEttN.js";import{R as Ds}from"./RollLog-CC_BUVA_.js";var Ss=class extends is{constructor(s,t){super(s,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(s,t){super.setOptions({...s,behavior:Te()},t)}getOptimisticResult(s){return s.behavior=Te(),super.getOptimisticResult(s)}fetchNextPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"backward"}}})}createResult(s,t){var v,j;const{state:n}=s,a=super.createResult(s,t),{isFetching:l,isRefetching:i,isError:c,isRefetchError:r}=a,d=(j=(v=n.fetchMeta)==null?void 0:v.fetchMore)==null?void 0:j.direction,x=c&&d==="forward",h=l&&d==="forward",o=c&&d==="backward",u=l&&d==="backward";return{...a,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:as(t,n.data),hasPreviousPage:ls(t,n.data),isFetchNextPageError:x,isFetchingNextPage:h,isFetchPreviousPageError:o,isFetchingPreviousPage:u,isRefetchError:r&&!x&&!o,isRefetching:i&&!h&&!u}}};function Je(s,t){return cs(s,Ss)}const Xe=_.createContext(null),E=()=>{const s=_.useContext(Xe);if(s===null)throw new Error("E5StatblockContext is not set");return s},Ts=s=>{const t=ke(R(n=>{var a;return(a=n.tokens)==null?void 0:a.get(s.itemId)}));if(t){const n=t.data,a=t.item,l=hs(n,s.statblock.stats,s.statblock.equipment||[]);return e.jsx(Xe.Provider,{value:{tokenName:Ee(a),data:n,item:a,statblock:s.statblock,stats:{strength:l.stats.strength,dexterity:l.stats.dexterity,constitution:l.stats.constitution,wisdom:l.stats.wisdom,intelligence:l.stats.intelligence,charisma:l.stats.charisma},equipmentBonuses:l},children:s.children})}return e.jsx(te,{})},Rs="_statblock_y5n6w_1",zs="_title_y5n6w_11",Ls="_name_y5n6w_20",Fs="_note_y5n6w_27",G={statblock:Rs,title:zs,name:Ls,note:Fs},Ps="_values_1bw4j_1",qs={values:Ps},Bs=()=>{const{item:s}=E();return e.jsxs("div",{className:qs.values,children:[e.jsx(Pe,{id:s.id}),e.jsx(qe,{id:s.id})]})},Es="_content_19vac_10",As="_tabs_19vac_27",Ms="_tab_19vac_27",Is="_activeTab_19vac_51",Os="_wrapper_19vac_57",Hs="_actionWrapper_19vac_67",J={content:Es,tabs:As,tab:Ms,activeTab:Is,wrapper:Os,actionWrapper:Hs},Ks="_lineBreak_1ql1p_1",Ws="_line_1ql1p_1",Vs="_fancyLine_1ql1p_25",Gs="_decoration_1ql1p_30",de={lineBreak:Ks,line:Ws,fancyLine:Vs,decoration:Gs},z=()=>e.jsx("div",{className:de.lineBreak,children:e.jsx("span",{className:de.line})}),M=()=>e.jsx("div",{className:de.fancyLine,children:e.jsx("span",{className:de.decoration})}),Qs="_general_bqxrl_1",Us="_hitDiceWrapper_bqxrl_5",Zs="_hitDice_bqxrl_5",Js="_stats_bqxrl_15",Xs="_savingThrows_bqxrl_22",Ys="_stat_bqxrl_15",et="_name_bqxrl_35",st="_value_bqxrl_48",tt="_header_bqxrl_64",nt="_infos_bqxrl_75",it="_ac_bqxrl_82",O={general:Qs,hitDiceWrapper:Us,hitDice:Zs,stats:Js,savingThrows:Xs,stat:Ys,name:et,value:st,header:tt,infos:nt,ac:it},he=({about:s,slug:t,statblock:n,stats:a,context:l,defaultOpen:i,hideTitle:c})=>{const r=H.getState().room,[d,x]=xs(`${we}.about.${t}`,!!i);return s?e.jsxs("div",{className:`about ${c?"no-title":""}`,children:[c?null:e.jsx("h3",{children:"About"}),e.jsx("button",{className:`expand ${d?"open":null}`,onClick:()=>x(!d)}),e.jsx("div",{className:`about-content-wrapper ${d?"open":"hidden"}`,children:e.jsx("div",{className:"about-content",children:e.jsx(W,{text:s,context:l||(n==null?void 0:n.name)||"Custom Roll",statblock:n==null?void 0:n.name,stats:a||{strength:(n==null?void 0:n.stats.strength)||0,dexterity:(n==null?void 0:n.stats.dexterity)||0,constitution:(n==null?void 0:n.stats.constitution)||0,intelligence:(n==null?void 0:n.stats.intelligence)||0,wisdom:(n==null?void 0:n.stats.wisdom)||0,charisma:(n==null?void 0:n.stats.charisma)||0},proficiencyBonus:(r==null?void 0:r.ruleset)==="e5"?n.proficiency_bonus:null})})})]}):null},at="_box_9rgpd_1",lt="_used_9rgpd_16",ct="_unused_9rgpd_22",pe={box:at,used:lt,unused:ct},rt=({limitValues:s,itemId:t})=>e.jsx(e.Fragment,{children:Array(s.max).fill(0).map((n,a)=>{const l=a<s.used;return e.jsx("div",{className:`limit-use ${l?"used":""}`,onClick:async()=>{await Ae([t],i=>{i.forEach(c=>{var r;if(c){const d=c.metadata[le];if(d){const x=(r=d.stats.limits)==null?void 0:r.findIndex(h=>h.id===s.id);x!==void 0&&(c.metadata[le].stats.limits[x].used=l?s.used-1:s.used+1)}}})})}},a)})}),ot=({limitValues:s,itemId:t})=>{const n=s.max-s.used,a=async c=>{await Ae([t],r=>{r.forEach(d=>{var x;if(d){const h=d.metadata[le];if(h){const o=(x=h.stats.limits)==null?void 0:x.findIndex(u=>u.id===s.id);o!==void 0&&(d.metadata[le].stats.limits[o].used=Math.max(Math.min(s.used+c,s.max),0))}}})})},l=Re(async()=>await a(5),async()=>await a(1),500),i=Re(async()=>await a(-5),async()=>await a(-1),500);return e.jsxs("div",{className:`${pe.box} limit-box`,children:[s.used>0?e.jsx(F,{content:"Click to reduce uses by one (Long press for -5)",children:e.jsx("div",{className:pe.used,style:{flexGrow:s.used},...i,children:s.used})}):null,n>0?e.jsx(F,{content:"Click to mark on use (Long press for +5)",children:e.jsx("div",{className:pe.unused,style:{flexGrow:n},...l,children:n})}):null]})},Y=({limit:s,title:t,limitValues:n,itemId:a,hideReset:l,hideDescription:i})=>{const c=()=>t==="name"?e.jsx("h4",{children:s.name}):t==="uses"?e.jsx("b",{children:"uses"}):null;return e.jsxs("div",{className:"limit",children:[e.jsxs("div",{className:"limit-heading",children:[c(),e.jsx("div",{className:"limit-uses",children:n.max>10?e.jsx(ot,{limitValues:n,itemId:a}):e.jsx(rt,{limitValues:n,itemId:a})})]}),s.description&&!i?e.jsx(rs,{remarkPlugins:[os],children:s.description}):null,s.resets&&!l?e.jsxs("div",{children:[e.jsx("b",{children:"Resets after:"})," ",s.resets.join(", ")]}):null]})},dt=["strength","dexterity","constitution","intelligence","wisdom","charisma"],ut=()=>{var x,h;const{statblock:s,stats:t,tokenName:n,item:a,equipmentBonuses:l,data:i}=E(),c=(x=i.stats.limits)==null?void 0:x.find(o=>o.id==="Hit Dice");let r=null,d=null;if(s.hp.hit_dice)try{r={name:"Hit Dice",uses:Number(s.hp.hit_dice.split("d")[0]),resets:["Long Rest"]},d=s.hp.hit_dice.split("d")[1].split("+")[0]}catch{}return e.jsxs("div",{className:O.general,children:[e.jsxs("div",{className:O.ac,children:[e.jsx("b",{children:"Armor Class:"})," ",e.jsx(Be,{id:a.id,hideExtras:!0}),s.armor_class.special?e.jsxs("span",{children:["(",s.armor_class.special,")"]}):null]}),e.jsxs("div",{children:[e.jsx("b",{children:"Speed:"})," ",Object.entries(s.speed).map(([o,u])=>{if(o!=="notes"){const f=l.statblockBonuses.speed[o];if(u||f)return`${o} ${u+f} ft.`}return null}).filter(o=>!!o).join(", ")]}),s.proficiency_bonus?e.jsxs("div",{children:[e.jsx("b",{children:"Proficiency Bonus:"})," ",s.proficiency_bonus]}):null,e.jsx(z,{}),r&&c&&d?e.jsxs("div",{className:O.hitDiceWrapper,children:[e.jsx("h3",{className:O.hitDice,children:"Hit Dice"}),e.jsx(Y,{limit:r,title:"uses",limitValues:c,itemId:a.id,hideReset:!0}),e.jsx("div",{className:"dice-button-wrapper",children:e.jsx(B,{dice:`1d${d}+CON`,text:`1d${d}+CON`,context:"Hit Dice",stats:t,statblock:n,onRoll:async o=>{let u=0;try{o&&"total"in o?u=o.total:o&&"values"in o&&(u=o.values.map(f=>f.value).reduce((f,v)=>f+v,0))}catch{}if(u){const f={...i,hp:Math.min(i.hp+u,i.maxHp)};await js(a,f),await ps(f,[a.id])}await X(a.id,c)},limitReached:r.uses===c.used,proficiencyBonus:s.proficiency_bonus})}),e.jsx(z,{})]}):null,e.jsxs("ul",{className:O.stats,children:[e.jsxs("li",{className:O.header,children:[e.jsx("div",{}),e.jsx("div",{children:"Check"}),e.jsx("div",{children:"Save"})]}),dt.map(o=>{const u=`${o}_save`,f=l.stats[o],v=Math.floor((f-10)/2),j=s.saving_throws[u]||v,m=Object.hasOwn(l.statblockBonuses.savingThrows,u)?j+l.statblockBonuses.savingThrows[u]:j;return e.jsxs("li",{className:O.stat,children:[e.jsxs("div",{className:O.name,children:[e.jsx("span",{children:o.substring(0,3)}),e.jsx("span",{children:f})]}),e.jsxs("div",{className:O.value,children:[e.jsx(B,{dice:`d20${Intl.NumberFormat("en-US",{signDisplay:"always"}).format(Math.floor((f-10)/2))}`,text:Intl.NumberFormat("en-US",{signDisplay:"always"}).format(Math.floor((f-10)/2)),stats:t,context:`${k.capitalize(o)}: Check`,statblock:n,proficiencyBonus:s.proficiency_bonus}),e.jsx(B,{dice:`d20${Intl.NumberFormat("en-US",{signDisplay:"always"}).format(Math.floor(m))}`,text:Intl.NumberFormat("en-US",{signDisplay:"always"}).format(Math.floor(m)),stats:t,context:`${k.capitalize(o.substring(0,3))}: Save`,statblock:n,proficiencyBonus:s.proficiency_bonus})]})]},o)})]}),e.jsx(z,{}),s.limits&&s.limits.length>0?e.jsxs("div",{children:[e.jsx("h3",{className:O.hitDice,children:"Limits"}),s.limits.map((o,u)=>{var v,j;return((v=i.stats.limits)==null?void 0:v.find(m=>m.id===o.name))?e.jsxs("div",{children:[e.jsx(Y,{limit:o,title:"name",limitValues:(j=i.stats.limits)==null?void 0:j.find(m=>m.id===o.name),itemId:a.id}),e.jsx(z,{})]},u):null})]}):null,e.jsxs("ul",{className:O.infos,children:[s.senses||l.statblockBonuses.senses?e.jsxs("li",{children:[e.jsx("b",{children:"Senses:"})," ",(s.senses||[]).concat(...l.statblockBonuses.senses).join(", ")]}):null,e.jsxs("li",{children:[e.jsx("b",{children:"Languages:"})," ",(h=s.languages)==null?void 0:h.join(", ")]}),s.challenge_rating||!k.isNull(s.cr)?e.jsxs("li",{children:[e.jsx("b",{children:"Challenge:"})," ",s.cr," ",s.challenge_rating?`(${s.challenge_rating})`:null]}):null,s.damage_vulnerabilities||l.statblockBonuses.damageVulnerabilities?e.jsxs("li",{children:[e.jsx("b",{children:"Damage Vulnerabilities:"})," ",s.damage_vulnerabilities," ",l.statblockBonuses.damageVulnerabilities]}):null,s.damage_resistances||l.statblockBonuses.damageResistances?e.jsxs("li",{children:[e.jsx("b",{children:"Damage Resistances:"})," ",s.damage_resistances," ",l.statblockBonuses.damageResistances]}):null,s.damage_immunities||l.statblockBonuses.damageImmunities?e.jsxs("li",{children:[e.jsx("b",{children:"Damage Immunities:"})," ",s.damage_immunities," ",l.statblockBonuses.damageResistances]}):null,s.condition_immunities||l.statblockBonuses.conditionImmunities?e.jsxs("li",{children:[e.jsx("b",{children:"Condition Immunities:"})," ",s.condition_immunities," ",l.statblockBonuses.conditionImmunities]}):null]}),e.jsx(z,{}),e.jsx(he,{about:s.about,slug:s.slug,statblock:s,stats:t,context:s.name})]})},mt="_heading_quifz_1",ht="_skills_quifz_7",xt="_skill_quifz_7",ge={heading:mt,skills:ht,skill:xt},jt=(s,t)=>{let n=0;return s==="acrobatics"?n=t.dexterity:s==="animal_handling"?n=t.wisdom:s==="arcana"?n=t.intelligence:s==="athletics"?n=t.strength:s==="deception"?n=t.charisma:s==="history"?n=t.intelligence:s==="insight"?n=t.wisdom:s==="intimidation"?n=t.charisma:s==="investigation"?n=t.intelligence:s==="medicine"?n=t.wisdom:s==="nature"?n=t.intelligence:s==="perception"?n=t.wisdom:s==="performance"||s==="persuasion"?n=t.charisma:s==="religion"?n=t.intelligence:s==="sleight_of_hand"||s==="stealth"?n=t.dexterity:s==="survival"&&(n=t.wisdom),Math.floor((n-10)/2)},pt=()=>{const{statblock:s,stats:t,tokenName:n,equipmentBonuses:a}=E();return e.jsxs("div",{children:[e.jsx("h3",{className:ge.heading,children:"Skills"}),e.jsx(M,{}),e.jsx("ul",{className:ge.skills,children:s.skills?Object.entries(s.skills).map(([l,i])=>{const c=(i||jt(l,t))+a.statblockBonuses.skills[l]+(a.statblockBonuses.proficiencies.includes(l)?s.proficiency_bonus:0);return e.jsxs("li",{className:ge.skill,style:{background:`linear-gradient(to right, #3f3f3f, transparent  ${c/10*100}%)`},children:[e.jsx("b",{children:k.capitalize(l.replaceAll("_"," "))}),e.jsx(B,{dice:`d20${Intl.NumberFormat("en-US",{signDisplay:"always"}).format(Math.floor(c))}`,text:Intl.NumberFormat("en-US",{signDisplay:"always"}).format(Math.floor(c)),stats:t,context:`${k.capitalize(l)}: Check`,statblock:n,proficiencyBonus:s.proficiency_bonus})]},l)}):null})]})},xe=Me()(Ie(s=>({activeTab:{},setActiveTab:(t,n)=>s(a=>{const l=a.activeTab;return a.activeTab[t]!==n?(l[t]=n,{activeTab:l}):a})}),{name:`${we}.activeTab`,storage:Oe(()=>localStorage)})),gt="_heading_1jstp_1",ft="_itemName_1jstp_7",Fe={heading:gt,itemName:ft},fe=({ability:s,proficient:t,range:n})=>{var j;const{item:a,stats:l,data:i,tokenName:c,statblock:r}=E(),d=(j=i.stats.limits)==null?void 0:j.find(m=>{var p;return m.id===((p=s.limit)==null?void 0:p.name)}),x=d&&d.max===d.used,h=_.useMemo(()=>{let m={bonus:void 0,stat:""};const p=(g,w,y)=>{const C=Math.floor((w-10)/2);return k.isUndefined(y.bonus)||C>y.bonus?{bonus:C,stat:g}:y};return s.stat_bonus&&s.stat_bonus.forEach(g=>{g==="STR"?m=p(g,l.strength,m):g==="DEX"?m=p(g,l.dexterity,m):g==="CON"?m=p(g,l.constitution,m):g==="INT"?m=p(g,l.intelligence,m):g==="WIS"?m=p(g,l.wisdom,m):g==="CHA"&&(m=p(g,l.charisma,m))}),m},[s,l]),o=s.attack_bonus||0,u=t&&r.proficiency_bonus?r.proficiency_bonus:0,f=(h.bonus||0)+o+u,v=_.useMemo(()=>{const m=[];return o&&m.push(`Attack: ${o}`),h.bonus&&m.push(`Stat (${h.stat}): ${h.bonus}`),u&&m.push(`Proficiency: ${u}`),m.join(", ")},[o,h,u]);return s.needs_proficiency&&!t?null:e.jsxs("li",{className:"e5-ability",children:[e.jsxs("span",{className:"ability-info",children:[e.jsx("b",{className:"ability-name",children:s.name}),n?e.jsxs("div",{children:[e.jsx("b",{children:"Range: "}),e.jsx("span",{children:n.replace("units","ft")})]}):null,s.limit&&i.stats.limits&&d?e.jsx(Y,{limit:s.limit,title:"uses",limitValues:d,itemId:a.id}):null]}),e.jsx(he,{slug:s.name,statblock:r,stats:l,about:s.desc||"",context:k.capitalize(s.name),defaultOpen:!0,hideTitle:!0}),e.jsxs("span",{className:"ability-extra-info",children:[s.stat_bonus&&s.stat_bonus.length>0||o!=0?e.jsxs("span",{className:"extra-info-with-button",children:[e.jsx("i",{children:"Hit:"}),e.jsx(F,{content:v,duration:200,delay:1e3,children:e.jsx("span",{children:e.jsx(B,{dice:`d20+${f}`,text:`+${f}`,context:`${k.capitalize(s.name)}: To Hit`,statblock:c,stats:l,onRoll:async()=>{await X(a.id,d)},limitReached:x,proficiencyBonus:r.proficiency_bonus})})})]}):null,s.damage_dice?e.jsxs("span",{className:"extra-info-with-button",children:[e.jsx("i",{children:"Damage:"}),k.isInteger(Number(s.damage_dice))?e.jsx("b",{children:s.damage_dice}):e.jsx(B,{dice:s.damage_dice,text:s.damage_dice,context:`${k.capitalize(s.name)}: Damage`,statblock:c,stats:l,onRoll:s.attack_bonus?void 0:async()=>{await X(a.id,d)},limitReached:s.attack_bonus?void 0:x,damageDie:!0,proficiencyBonus:r.proficiency_bonus})]}):null]})]},s.name)},vt="_itemCharges_vtf5f_1",bt={itemCharges:vt},$e=({equippedItem:s,showReset:t})=>{var i;const{data:n,item:a}=E(),l=(i=n.stats.limits)==null?void 0:i.find(c=>{var r;return c.id===((r=s==null?void 0:s.charges)==null?void 0:r.name)});return e.jsx(e.Fragment,{children:s!=null&&s.charges&&l?e.jsxs("div",{className:bt.itemCharges,children:["Charges:",e.jsx(Y,{limit:s.charges,title:"none",hideReset:!t,hideDescription:!0,limitValues:l,itemId:a.id})]}):null})},U=({heading:s,abilities:t,abilityKey:n})=>{var r,d,x,h;const{statblock:a,equipmentBonuses:l,data:i}=E(),c=l.itemActions.items.flatMap(o=>({item:o.itemId,abilities:n in o?o[n]:[]}));return e.jsxs("div",{children:[e.jsx("h3",{className:Fe.heading,children:s}),e.jsx(M,{}),t==null?void 0:t.map((o,u)=>e.jsxs("div",{children:[e.jsx(fe,{ability:o,proficient:!!o.use_proficiency}),e.jsx(z,{})]},u)),(d=(r=a.equipment)==null?void 0:r.filter(o=>o.embedded&&ce(i,o)))==null?void 0:d.map(o=>c.filter(u=>u.item===o.item.id).map(u=>u.abilities.map((f,v)=>e.jsxs("div",{children:[e.jsx(fe,{ability:f,proficient:o.proficient}),e.jsx(z,{})]},v)))),(h=(x=a.equipment)==null?void 0:x.filter(o=>!o.embedded&&ce(i,o)))==null?void 0:h.map(o=>c.filter(u=>u.item===o.item.id).map((u,f)=>u.abilities.length?e.jsxs("div",{children:[e.jsx("h4",{className:Fe.itemName,children:o==null?void 0:o.item.name}),e.jsx($e,{equippedItem:o.item}),e.jsx(M,{}),u.abilities.map((v,j)=>e.jsxs("div",{children:[e.jsx(fe,{ability:v,proficient:o.proficient,range:o.item.tags&&o.item.tags.includes("throw")&&o.item.range||o.item.range?o.item.range:void 0}),e.jsx(z,{})]},j))]},f):null))]})},_t="_content_vnnfs_1",yt="_tabs_vnnfs_18",Nt="_tab_vnnfs_18",kt="_activeTab_vnnfs_42",wt="_wrapper_vnnfs_48",$t="_actionWrapper_vnnfs_53",L={content:_t,tabs:yt,tab:Nt,activeTab:kt,wrapper:wt,actionWrapper:$t},Ct=()=>{const{statblock:s,item:t}=E(),{activeTab:n,setActiveTab:a}=xe(),l=`${t.id}-action`,i=_.useMemo(()=>{var x,h,o,u,f,v,j,m;const d=[];return((x=s.actions)!=null&&x.length||(h=s.equipment)!=null&&h.some(p=>{var g,w;return(w=(g=p.item.bonus)==null?void 0:g.actions)==null?void 0:w.length}))&&d.push("action"),((o=s.bonus_actions)!=null&&o.length||(u=s.equipment)!=null&&u.some(p=>{var g,w;return(w=(g=p.item.bonus)==null?void 0:g.bonus_actions)==null?void 0:w.length}))&&d.push("bonus"),((f=s.reactions)!=null&&f.length||(v=s.equipment)!=null&&v.some(p=>{var g,w;return(w=(g=p.item.bonus)==null?void 0:g.reactions)==null?void 0:w.length}))&&d.push("reaction"),(j=s.mythic_actions)!=null&&j.length&&d.push("mythic"),(m=s.lair_actions)!=null&&m.length&&d.push("lair"),d},[s]),c=l in n?n[l]:i[0],r=_.useMemo(()=>c==="action"?e.jsx(U,{heading:"Actions",abilities:s.actions,abilityKey:"actions"}):c==="bonus"?e.jsx(U,{heading:"Bonus Actions",abilities:s.bonus_actions,abilityKey:"bonus_actions"}):c==="reaction"?e.jsx(U,{heading:"Reactions",abilities:s.reactions,abilityKey:"reactions"}):c==="mythic"?e.jsx(U,{heading:"Mythic Actions",abilities:s.mythic_actions,abilityKey:"mythic_actions"}):c==="lair"?e.jsx(U,{heading:"Lair Actions",abilities:s.lair_actions,abilityKey:"lair_actions"}):e.jsx(e.Fragment,{}),[c,s]);return e.jsx(e.Fragment,{children:i.length===1?e.jsx(e.Fragment,{children:r}):e.jsxs("div",{className:L.actionWrapper,children:[e.jsx("ul",{className:L.tabs,children:i.map((d,x)=>e.jsx("li",{className:c===d?`${L.tab} ${L.activeTab}`:L.tab,onClick:()=>a(l,d),children:d},x))}),e.jsx("div",{className:L.content,children:r})]})})},Dt="_spellFilters_1mi4b_1",St="_left_1mi4b_9",Tt="_spellFilter_1mi4b_1",Rt="_active_1mi4b_22",zt="_sticky_1mi4b_27",A={spellFilters:Dt,left:St,spellFilter:Tt,active:Rt,sticky:zt},Ye=s=>e.jsx("div",{className:`${A.spellFilters} ${s.left?A.left:null}`,children:s.filters.map(t=>{let n=!1;return t==="All"&&s.spellFilter.length===0||t==="Cant"&&s.spellFilter.indexOf(0)>=0||t==="Const"&&s.spellFilter.indexOf(-1)>=0?n=!0:n=s.spellFilter.indexOf(parseInt(t))>=0,e.jsx("button",{className:`button ${A.spellFilter} ${n?A.active:null}`,onClick:()=>{if(t==="All")s.setSpellFilter([]);else if(t==="Cant"){const a=Array.from(s.spellFilter);a.indexOf(0)>=0?a.splice(a.indexOf(0),1):a.push(0),s.setSpellFilter(a)}else if(t==="Const"){const a=Array.from(s.spellFilter);a.indexOf(-1)>=0?a.splice(a.indexOf(-1),1):a.push(-1),s.setSpellFilter(a)}else{const a=parseInt(t),l=Array.from(s.spellFilter);l.indexOf(a)>=0?l.splice(l.indexOf(a),1):l.push(a),s.setSpellFilter(l)}},children:t},t)})}),Lt="_heading_gze6k_1",Ft="_top_gze6k_7",Pt="_info_gze6k_13",qt="_sticky_gze6k_24",Bt="_spellAttack_gze6k_37",Et="_spellList_gze6k_43",At="_spellMain_gze6k_48",Mt="_spellInfo_gze6k_55",It="_spellHeader_gze6k_61",Ot="_spellName_gze6k_67",Ht="_spellLevel_gze6k_74",Kt="_spellDamage_gze6k_79",Wt="_spellComponents_gze6k_83",Vt="_materialDetails_gze6k_90",Gt="_spellMoreInfo_gze6k_96",Qt="_open_gze6k_102",Ut="_moreInfoContent_gze6k_106",Zt="_micOpen_gze6k_116",Jt="_infoBits_gze6k_120",S={heading:Lt,top:Ft,info:Pt,sticky:qt,spellAttack:Bt,spellList:Et,spellMain:At,spellInfo:Mt,spellHeader:It,spellName:Ot,spellLevel:Ht,spellDamage:Kt,spellComponents:Wt,materialDetails:Vt,spellMoreInfo:Gt,open:Qt,moreInfoContent:Ut,micOpen:Zt,infoBits:Jt},Xt="_spellSlots_1bdb5_1",Yt="_spellSlotLimits_1bdb5_5",en="_spellSlotEntry_1bdb5_11",sn="_spellSlotLevel_1bdb5_21",ie={spellSlots:Xt,spellSlotLimits:Yt,spellSlotEntry:en,spellSlotLevel:sn},tn=()=>{const{statblock:s,item:t,data:n}=E();return e.jsx(e.Fragment,{children:s.spell_slots&&s.spell_slots.length>0?e.jsx("div",{className:ie.spellSlots,children:e.jsx("div",{className:ie.spellSlotLimits,children:s.spell_slots.sort((a,l)=>a.level-l.level).map((a,l)=>{var c;const i=(c=n.stats.limits)==null?void 0:c.find(r=>r.id===a.limit.name);return i?e.jsxs("div",{className:ie.spellSlotEntry,children:[e.jsxs("div",{className:ie.spellSlotLevel,children:["Level: ",a.level]}),e.jsx(Y,{limit:a.limit,title:"none",hideReset:!0,limitValues:i,itemId:t.id})]},l):null})})}):null})},ve=({spell:s,statblock:t,stats:n,spellSlots:a,charges:l,chargesUsed:i,tokenData:c,itemId:r,dc:d,attack:x,embedded:h})=>{var C;const[o,u]=_.useState(!1),f=E(),v=H(R(D=>D.room)),j=ue(R(D=>D.addRoll)),m=()=>s.level===0?"Cantrip":s.level===1?"1st level":s.level===2?"2nd level":s.level===3?"3rd level":`${s.level}th level`,p=s.desc?He(s.desc):null,g=_.useMemo(()=>{var D;if(k.isUndefined(l)){if(a)return(D=a==null?void 0:a.find($=>$.level===s.level))==null?void 0:D.limit}else return l},[a,s,l]),w=(C=c==null?void 0:c.stats.limits)==null?void 0:C.find(D=>D.id===(g==null?void 0:g.name)),y=_.useMemo(()=>s.level===0?!1:w&&w.max<w.used+(i||1)||a&&a.length>0&&!g,[s,w,a,g]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:S.spellMain,children:[e.jsxs("div",{className:S.spellInfo,children:[e.jsxs("div",{className:S.spellHeader,children:[e.jsx("h4",{className:S.spellName,children:s.name}),e.jsxs("span",{className:S.spellLevel,children:["(",m(),")"]}),h&&l&&w&&r?e.jsx(Y,{limit:l,title:"none",limitValues:w,itemId:r,hideDescription:!0,hideReset:!0}):null,i?e.jsxs("span",{className:S.spellLevel,children:["(uses ",i," charges)"]}):null,a&&a.length>0||l?e.jsx(F,{content:"No more spellslots",disabled:!y,children:e.jsx("div",{className:`button-wrapper enabled ${v!=null&&v.disableDiceRoller?"calculated":"three-d-dice"}`,children:s.is_attack&&x?e.jsx(e.Fragment,{children:e.jsx(B,{dice:`1d20+${x}`,text:`+${x}&nbspattack`,context:`${k.capitalize(s.name)}: Attack`,statblock:t,stats:n,onRoll:async()=>{r&&w&&await X(r,w,i)},limitReached:y,proficiencyBonus:f.statblock.proficiency_bonus})}):e.jsx("button",{className:`dice-button button ${y?"limit":""}`,onClick:async()=>{r&&w&&await X(r,w,i),await gs(`${s.name}: Cast`,j,t)},children:"cast"})})}):null]}),s.dc?e.jsxs("span",{className:S.spellDamage,children:["DC: ",s.dc,e.jsx(B,{dice:"1d20",text:`DC ${d}`,context:`${k.capitalize(s.name)}: Attack`,stats:n,proficiencyBonus:f.statblock.proficiency_bonus})]}):null,p?e.jsxs("span",{className:S.spellDamage,children:["Damage:"," ",e.jsx(B,{dice:p,text:p,context:`${k.capitalize(s.name)}: Damage`,stats:n,statblock:t,limitReached:y,damageDie:!0,proficiencyBonus:f.statblock.proficiency_bonus})]}):null,e.jsxs("div",{className:S.spellComponents,children:[s.verbal?"V":null,s.somatic?"S":null,e.jsxs("span",{className:"spell-materials",children:[s.material?"M":null,e.jsx("span",{className:S.materialDetails,children:s.materials?` (${s.materials})`:null})]})]})]}),e.jsx("button",{className:`expand ${o?"open":null}`,onClick:()=>u(!o)})]}),e.jsx("div",{className:`${S.spellMoreInfo} ${o?S.open:null}`,children:e.jsxs("div",{className:`${S.moreInfoContent} ${o?S.micOpen:null}`,children:[e.jsxs("div",{className:S.infoBits,children:[s.school.name?e.jsxs("span",{children:[e.jsx("b",{children:"School"}),": ",s.school.name]}):null,s.archetypes&&s.archetypes.length>0?e.jsxs("span",{children:[e.jsx("b",{children:"Archetypes"}),": ",s.archetypes.map(D=>D.name).join(", ")]}):null,s.circles&&s.circles.length>0?e.jsxs("span",{children:[e.jsx("b",{children:"Circles"}),": ",s.circles.map(D=>D.name).join(", ")]}):null,s.classes&&s.classes.length>0?e.jsxs("span",{children:[e.jsx("b",{children:"Classes"}),": ",s.classes.map(D=>D.name).join(", ")]}):null,e.jsxs("span",{children:[e.jsx("b",{children:"Casting Time"}),": ",s.casting_time]}),e.jsxs("span",{children:[e.jsx("b",{children:"Range"}),": ",s.range]}),e.jsxs("span",{children:[e.jsx("b",{children:"Can be Ritual"}),": ",s.ritual?"Yes":"No"]}),e.jsxs("span",{children:[e.jsx("b",{children:"Duration"}),": ",s.duration]}),e.jsxs("span",{children:[e.jsx("b",{children:"Concentration"}),": ",s.concentration?"Yes":"No"]})]}),e.jsxs("div",{children:[e.jsx("b",{children:"Description"}),":",e.jsx(W,{text:s.desc||"",context:`${k.capitalize(s.name)}`,stats:n,statblock:t,onRoll:async()=>{r&&w&&await X(r,w)},limitReached:y,proficiencyBonus:f.statblock.proficiency_bonus})]}),s.higher_level?e.jsxs("div",{children:[e.jsx("b",{children:"Higher Levels"}),":"," ",e.jsx(W,{text:s.higher_level,stats:n,context:`${k.capitalize(s.name)}: Higher Level`,statblock:t,proficiencyBonus:f.statblock.proficiency_bonus})]}):null]})})]})},nn=()=>{var o,u,f,v;const[s,t]=_.useState([]),{stats:n,data:a,item:l,tokenName:i,statblock:c,equipmentBonuses:r}=E(),d=c.spells||[],x=r.statblockBonuses.spells.flatMap(j=>({item:j.itemId,spells:j.spells.map(m=>({spell:m.spell,charges:m.charges}))})),h=["All"].concat(d.map(j=>j.level===0?"Cant":j.level===1?"1st":j.level===2?"2nd":j.level===3?"3rd":`${j.level}th`)).concat(x.flatMap(j=>j.spells.map(m=>m.spell.level===0?"Cant":m.spell.level===1?"1st":m.spell.level===2?"2nd":m.spell.level===3?"3rd":`${m.spell.level}th`))).filter((j,m,p)=>p.indexOf(j)===m).sort((j,m)=>j==="All"?-1:m==="All"?1:j==="Cant"?-1:m==="Cant"?1:parseInt(j)-parseInt(m));return e.jsxs("div",{className:"spells",children:[e.jsx("div",{className:S.top,children:e.jsx("h3",{className:S.heading,children:"Spells"})}),e.jsx(M,{}),e.jsxs("div",{className:S.sticky,children:[e.jsx(Ye,{filters:h,spellFilter:s,setSpellFilter:t}),e.jsxs("div",{className:S.info,children:[c.spell_dc?e.jsxs("span",{children:["DC ",c.spell_dc]}):null,c.spell_attack?e.jsxs("span",{className:S.spellAttack,children:["Attack"," ",e.jsx(B,{dice:`d20+${c.spell_attack}`,text:`+${c.spell_attack}`,context:"Spell Attack",stats:n,proficiencyBonus:c.proficiency_bonus})]}):null]}),e.jsx(tn,{})]}),e.jsxs("ul",{className:S.spellList,children:[e.jsx("li",{children:e.jsx(z,{})}),d.sort((j,m)=>j.level-m.level).filter(j=>s.indexOf(j.level)>=0||s.length===0).map((j,m)=>e.jsxs("li",{children:[e.jsx(ve,{spell:j,statblock:i,stats:n,spellSlots:c.spell_slots,tokenData:a,itemId:l.id,dc:c.spell_dc,attack:c.spell_attack}),e.jsx(z,{})]},`${j.name}${m}`)),(u=(o=c.equipment)==null?void 0:o.filter(j=>j.embedded&&ce(a,j)))==null?void 0:u.map(j=>x.filter(m=>m.item===j.item.id).map(m=>m.spells.filter(p=>s.indexOf(p.spell.level)>=0||s.length===0).sort((p,g)=>p.spell.level-g.spell.level).map((p,g)=>e.jsxs("li",{children:[e.jsx(ve,{spell:p.spell,statblock:i,stats:n,spellSlots:c.spell_slots,charges:j.item.charges,chargesUsed:p.charges,tokenData:a,itemId:l.id,dc:c.spell_dc,attack:c.spell_attack,embedded:!0}),e.jsx(z,{})]},`${p.spell.name}${g}`)))),(v=(f=c.equipment)==null?void 0:f.filter(j=>!j.embedded&&ce(a,j)))==null?void 0:v.map(j=>x.filter(m=>m.item===j.item.id).map((m,p)=>m.spells.length?e.jsxs("li",{children:[e.jsx("h4",{className:S.heading,children:j.item.name}),e.jsx($e,{equippedItem:j.item}),e.jsx(M,{}),m.spells.filter(g=>s.indexOf(g.spell.level)>=0||s.length===0).sort((g,w)=>g.spell.level-w.spell.level).map((g,w)=>e.jsxs("div",{children:[e.jsx(ve,{spell:g.spell,statblock:i,stats:n,tokenData:a,charges:j.item.charges,chargesUsed:g.charges,itemId:l.id,dc:c.spell_dc,attack:c.spell_attack}),e.jsx(z,{})]},`${g.spell.name}${w}`))]},p):null))]})]})},an="_heading_1x8jz_1",ln="_items_1x8jz_7",cn="_top_1x8jz_14",rn="_itemName_1x8jz_21",on="_info_1x8jz_28",dn="_cost_1x8jz_34",un="_gp_1x8jz_41",mn="_cp_1x8jz_45",hn="_sp_1x8jz_49",xn="_ep_1x8jz_53",jn="_pp_1x8jz_57",pn="_equipmentOptions_1x8jz_61",K={heading:an,items:ln,top:cn,itemName:rn,info:on,cost:dn,gp:un,cp:mn,sp:hn,ep:xn,pp:jn,equipmentOptions:pn},es=Me()(Ie(s=>({filter:{filter:{consumable:!1,isEquipped:!1,isAttuned:!1,search:""},sort:"name"},setFilter:t=>s(()=>({filter:t}))}),{name:`${we}.inventory-filter`,storage:Oe(()=>localStorage)})),gn=()=>{const[s,t]=es(R(n=>[n.filter,n.setFilter]));return e.jsxs("div",{style:{display:"flex",gap:"10px",paddingBlock:"6px"},className:A.sticky,children:[e.jsxs("label",{children:["Sort:",e.jsxs("select",{value:s.sort,onChange:n=>{t({...s,sort:n.currentTarget.value})},children:[e.jsx("option",{children:"name"}),e.jsx("option",{children:"cost"}),e.jsx("option",{children:"equipped"}),e.jsx("option",{children:"attuned"})]})]}),e.jsxs("div",{className:`${A.spellFilters} ${A.left}`,style:{alignItems:"center"},children:[e.jsx(F,{content:"is equipped",children:e.jsx("button",{className:`button ${A.spellFilter} ${s.filter.isEquipped?A.active:null}`,onClick:()=>{t({...s,filter:{...s.filter,isEquipped:!s.filter.isEquipped}})},children:"equ"})}),e.jsx(F,{content:"is attuned",children:e.jsx("button",{className:`button ${A.spellFilter} ${s.filter.isAttuned?A.active:null}`,onClick:()=>{t({...s,filter:{...s.filter,isAttuned:!s.filter.isAttuned}})},children:"att"})}),e.jsx(F,{content:"can be consumed",children:e.jsx("button",{className:`button ${A.spellFilter} ${s.filter.consumable?A.active:null}`,onClick:()=>{t({...s,filter:{...s.filter,consumable:!s.filter.consumable}})},children:"con"})}),e.jsx(F,{content:"search",children:e.jsx("input",{style:{width:"40px",height:"20px",flexGrow:1},type:"text",value:s.filter.search,onChange:n=>{t({...s,filter:{...s.filter,search:n.target.value}})}})})]})]})},fn=({equipment:s})=>{const{statblock:t,stats:n,data:a,item:l}=E();return e.jsxs("li",{children:[e.jsxs("div",{className:K.top,children:[e.jsxs("span",{className:K.info,children:[e.jsxs("h4",{className:K.itemName,children:[s.count?`${s.count}x `:null,s.item.name]}),e.jsxs("span",{children:[s.item.consumable?e.jsx(F,{content:"Can be consumed",children:e.jsx("i",{children:"C"})}):null,s.proficient?e.jsx(F,{content:"proficient",children:e.jsx("i",{children:"P"})}):null,s.loot?e.jsx(F,{content:"loot",children:e.jsx("i",{children:"L"})}):null,s.item.sentient?e.jsx(F,{content:"sentient",children:e.jsx("i",{children:"S"})}):null]})]}),e.jsx("div",{className:K.cost,children:s.item.cost?e.jsx(e.Fragment,{children:Object.entries(s.item.cost).map(([i,c])=>i!=="id"&&c?e.jsxs("span",{className:K[i],children:[c,i]},i):null)}):null})]}),e.jsxs("span",{className:K.equipmentOptions,children:[s.item.can_equip?e.jsxs("label",{"aria-label":"equipped",children:["equipped:",e.jsx("input",{type:"checkbox",checked:fs(a,s),onChange:async i=>{var d,x;const c=[...((d=a.equipment)==null?void 0:d.equipped)||[]],r=[...((x=a.equipment)==null?void 0:x.attuned)||[]];i.target.checked?c.push(s.item.slug):c.splice(c.findIndex(h=>h===s.item.slug),1),await ze(a,c,r,t,l)}})]}):null,s.item.requires_attuning?e.jsxs("label",{"aria-label":"attuned",children:["attuned:",e.jsx("input",{type:"checkbox",checked:vs(a,s),onChange:async i=>{var d,x;const c=[...((d=a.equipment)==null?void 0:d.equipped)||[]],r=[...((x=a.equipment)==null?void 0:x.attuned)||[]];i.target.checked?r.push(s.item.slug):r.splice(r.findIndex(h=>h===s.item.slug),1),await ze(a,c,r,t,l)}})]}):null]}),e.jsx($e,{equippedItem:s.item}),e.jsx(he,{slug:s.item.name,statblock:t,stats:n,about:s.item.description,context:s.item.name}),e.jsx(z,{})]},s.id)},vn=()=>{var l,i;const{statblock:s}=E(),t=es(c=>c.filter),n=(c,r)=>{var d,x,h,o,u,f,v,j,m,p;if(t.sort==="name")return c.item.name.localeCompare(r.item.name);if(t.sort==="cost"){const g=(((d=c.item.cost)==null?void 0:d.cp)||0)+10*(((x=c.item.cost)==null?void 0:x.sp)||0)+50*(((h=c.item.cost)==null?void 0:h.ep)||0)+100*(((o=c.item.cost)==null?void 0:o.gp)||0)+1e3*(((u=c.item.cost)==null?void 0:u.pp)||0),y=(((f=r.item.cost)==null?void 0:f.cp)||0)+10*(((v=r.item.cost)==null?void 0:v.sp)||0)+50*(((j=r.item.cost)==null?void 0:j.ep)||0)+100*(((m=r.item.cost)==null?void 0:m.gp)||0)+1e3*(((p=r.item.cost)==null?void 0:p.pp)||0)-g;return y===0?c.item.name.localeCompare(r.item.name):y}else{if(t.sort==="equipped")return c.equipped&&r.equipped||!c.equipped&&!r.equipped?c.item.can_equip&&r.item.can_equip||!c.item.can_equip&&!r.item.can_equip?c.item.name.localeCompare(r.item.name):c.item.can_equip&&!r.item.can_equip?-1:1:c.equipped&&!r.equipped?-1:1;if(t.sort==="attuned")return c.attuned&&r.attuned||!c.attuned&&!r.attuned?c.item.requires_attuning&&r.item.requires_attuning||!c.item.requires_attuning&&!r.item.requires_attuning?c.item.name.localeCompare(r.item.name):c.item.requires_attuning&&!r.item.requires_attuning?-1:1:c.attuned&&!r.attuned?-1:1}return 0},a=c=>!c.embedded&&(!t.filter.consumable||c.item.consumable)&&(!t.filter.isEquipped||c.equipped)&&(!t.filter.isAttuned||c.attuned)&&(t.filter.search===""||c.item.name.toLowerCase().includes(t.filter.search.toLowerCase()));return e.jsxs("div",{children:[e.jsx("h3",{className:K.heading,children:"Inventory"}),e.jsx(M,{}),e.jsx(gn,{}),e.jsx("ul",{className:K.items,children:(l=s.equipment)==null?void 0:l.filter(a).sort(n).map((c,r)=>e.jsx(fn,{equipment:c},r))}),e.jsx("h3",{className:K.heading,children:"Other"}),e.jsx(M,{}),e.jsx("div",{children:(i=s.items)==null?void 0:i.join(", ")})]})},bn=()=>{const{statblock:s,item:t}=E(),{activeTab:n,setActiveTab:a}=xe(),l=t.id in n?n[t.id]:"general",i=_.useMemo(()=>{var d,x,h,o,u,f,v,j,m,p,g,w;const r=["general","skills"];return((d=s.actions)!=null&&d.length||(x=s.bonus_actions)!=null&&x.length||(h=s.mythic_actions)!=null&&h.length||(o=s.reactions)!=null&&o.length||(u=s.equipment)!=null&&u.some(y=>{var C,D,$,P,b,N;return((D=(C=y.item.bonus)==null?void 0:C.actions)==null?void 0:D.length)||((P=($=y.item.bonus)==null?void 0:$.bonus_actions)==null?void 0:P.length)||((N=(b=y.item.bonus)==null?void 0:b.reactions)==null?void 0:N.length)}))&&r.push("actions"),((f=s.items)!=null&&f.length||(v=s.equipment)!=null&&v.length)&&r.push("inventory"),((j=s.spells)!=null&&j.length||(m=s.equipment)!=null&&m.some(y=>{var C;return(C=y.item.spells)==null?void 0:C.length}))&&r.push("spells"),((p=s.special_abilities)!=null&&p.length||(g=s.equipment)!=null&&g.some(y=>{var C,D;return(D=(C=y.item.bonus)==null?void 0:C.special_abilities)==null?void 0:D.length}))&&r.push("special"),(w=s.legendary_actions)!=null&&w.length&&r.push("legendary"),r},[s]),c=_.useMemo(()=>l==="general"?e.jsx(ut,{}):l==="skills"?e.jsx(pt,{}):l==="actions"?e.jsx(Ct,{}):l==="inventory"?e.jsx(vn,{}):l==="spells"?e.jsx(nn,{}):l==="special"?e.jsx(U,{heading:"Specials & Traits",abilities:s.special_abilities,abilityKey:"special_abilities"}):l==="legendary"?e.jsx(U,{heading:"Legendary Actions",abilities:s.legendary_actions,abilityKey:"legendary_actions"}):e.jsx(e.Fragment,{}),[l,s]);return e.jsxs("div",{className:J.wrapper,children:[e.jsx("ul",{className:J.tabs,children:i.map((r,d)=>e.jsx("li",{className:l===r?`${J.tab} ${J.activeTab}`:J.tab,onClick:()=>a(t.id,r),children:r},d))}),e.jsx("div",{className:J.content,children:c})]})},_n=()=>{const{statblock:s}=E();return e.jsxs("div",{className:G.statblock,children:[e.jsxs("div",{className:G.title,children:[e.jsxs("div",{children:[e.jsx(F,{content:`${s.size} ${s.type}, ${s.alignment}`,children:e.jsx("h1",{className:G.name,children:s.name})}),e.jsxs("div",{className:G.note,children:[s.size," ",s.type,", ",s.alignment]})]}),e.jsx(Bs,{})]}),e.jsx(bn,{})]})},yn=({slug:s,itemId:t})=>{const n=H(R(i=>i.room)),a=ds(s,n==null?void 0:n.tabletopAlmanacAPIKey),l=a.isSuccess&&a.data?a.data:null;return l?e.jsx(Ts,{itemId:t,statblock:l,children:e.jsx(_n,{})}):e.jsx(te,{})},ss=_.createContext(null),Q=()=>{const s=_.useContext(ss);if(s===null)throw new Error("PFStatblockContext is not set");return s},Nn=s=>{const t=ke(R(n=>{var a;return(a=n.tokens)==null?void 0:a.get(s.itemId)}));if(t){const n=t.data,a=t.item;return e.jsx(ss.Provider,{value:{tokenName:Ee(a),data:n,item:a,statblock:s.statblock,stats:{strength:s.statblock.stats.strength||0,dexterity:s.statblock.stats.dexterity||0,constitution:s.statblock.stats.constitution||0,wisdom:s.statblock.stats.wisdom||0,intelligence:s.statblock.stats.intelligence||0,charisma:s.statblock.stats.charisma||0}},children:s.children})}return e.jsx(te,{})},kn="_values_15mtq_1",wn={values:kn},$n=()=>{const{item:s}=Q();return e.jsxs("div",{className:wn.values,children:[e.jsx(Pe,{id:s.id}),e.jsx(qe,{id:s.id})]})},Cn="_general_1mcsm_1",Dn="_stats_1mcsm_5",Sn="_heading_1mcsm_12",Tn="_savingThrows_1mcsm_18",Rn="_stat_1mcsm_5",zn="_traits_1mcsm_37",Ln="_trait_1mcsm_37",Fn="_name_1mcsm_47",Pn="_value_1mcsm_60",qn="_header_1mcsm_76",Bn="_infos_1mcsm_84",En="_ac_1mcsm_91",q={general:Cn,stats:Dn,heading:Sn,savingThrows:Tn,stat:Rn,traits:zn,trait:Ln,name:Fn,value:Pn,header:qn,infos:Bn,ac:En},An=["strength","dexterity","constitution","intelligence","wisdom","charisma"],Mn=["reflex","will","fortitude"],In=()=>{var l,i,c,r,d,x,h,o,u,f,v,j;const{statblock:s,stats:t,tokenName:n,item:a}=Q();return e.jsxs("div",{className:q.general,children:[e.jsxs("div",{className:q.ac,children:[e.jsx("b",{children:"Armor Class:"})," ",e.jsx(Be,{id:a.id,hideExtras:!0}),s.armor_class.special?e.jsxs("span",{children:["(",s.armor_class.special,")"]}):null]}),e.jsxs("div",{children:[e.jsx("b",{children:"Speed:"}),` ${s.speed}`]}),e.jsx(z,{}),e.jsxs("ul",{className:q.stats,children:[e.jsxs("li",{className:q.header,children:[e.jsx("div",{}),e.jsx("div",{children:"Check"})]}),An.map(m=>{const p=t[m];return e.jsxs("li",{className:q.stat,children:[e.jsx("div",{className:q.name,children:e.jsx("span",{children:m.substring(0,3)})}),e.jsx("div",{className:q.value,children:e.jsx(B,{dice:`d20+${p}`,text:`+${p}`,stats:t,context:`${k.capitalize(m)}: Check`,statblock:n})})]},m)})]}),e.jsx(z,{}),e.jsxs("ul",{className:q.savingThrows,children:[e.jsxs("li",{className:q.header,children:[e.jsx("div",{}),e.jsx("div",{children:"Save"})]}),Mn.map(m=>{const p=s.saving_throws[m];return e.jsxs("li",{className:q.stat,children:[e.jsx("div",{className:q.name,children:e.jsx("span",{children:m.substring(0,3)})}),e.jsx("div",{className:q.value,children:e.jsx(B,{dice:`d20+${p}`,text:`+${p}`,stats:t,context:`${k.capitalize(m)}: Save`,statblock:n})})]},m)})]}),s.saving_throws.special?e.jsx("i",{children:s.saving_throws.special}):null,e.jsx(z,{}),(l=s.senses)!=null&&l.length||(i=s.languages)!=null&&i.length||(c=s.immunities)!=null&&c.length||(r=s.weaknesses)!=null&&r.length||(d=s.resistances)!=null&&d.length?e.jsxs(e.Fragment,{children:[e.jsxs("ul",{className:q.infos,children:[(x=s.senses)!=null&&x.length?e.jsxs("li",{children:[e.jsx("b",{children:"Senses:"})," ",(s.senses||[]).join(", ")]}):null,(h=s.languages)!=null&&h.length?e.jsxs("li",{children:[e.jsx("b",{children:"Languages:"})," ",(o=s.languages)==null?void 0:o.join(", ")]}):null,(u=s.immunities)!=null&&u.length?e.jsxs("li",{children:[e.jsx("b",{children:"Immunities:"})," ",s.immunities.join(", ")]}):null,(f=s.weaknesses)!=null&&f.length?e.jsxs("li",{children:[e.jsx("b",{children:"Weaknesses:"})," ",s.weaknesses.join(", ")]}):null,(v=s.resistances)!=null&&v.length?e.jsxs("li",{children:[e.jsx("b",{children:"Resistances:"})," ",s.resistances.join(", ")]}):null]}),e.jsx(z,{})," "]}):null,s.traits&&s.traits.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h3",{className:q.heading,children:"Traits"}),e.jsx(M,{}),e.jsx("ul",{className:q.traits,children:(j=s.traits)==null?void 0:j.map((m,p)=>{let g=m.value;return m.value.includes(",")&&(g=m.value.split(",")[0]),e.jsxs("li",{className:q.trait,children:[e.jsxs("b",{children:[m.name,":"]}),e.jsx("div",{children:g})]},p)})})]}),e.jsx(z,{})]}):null,e.jsx(he,{slug:s.slug,about:s.about,stats:t,statblock:s,context:s.name})]})},On="_heading_13jjy_1",Hn="_skills_13jjy_7",Kn="_skill_13jjy_7",be={heading:On,skills:Hn,skill:Kn},Wn=()=>{var a;const{statblock:s,stats:t,tokenName:n}=Q();return e.jsxs("div",{children:[e.jsx("h3",{className:be.heading,children:"Skills"}),e.jsx(M,{}),e.jsx("ul",{className:be.skills,children:(a=s.skills)==null?void 0:a.map((l,i)=>{let c=0;try{c=parseInt(l.value)}catch{}return e.jsxs("li",{className:be.skill,style:{background:`linear-gradient(to right, #3f3f3f, transparent  ${c/30*100}%)`},children:[e.jsx("b",{children:k.capitalize(l.name.replaceAll("_"," "))}),e.jsx(B,{dice:`d20+${c}`,text:Intl.NumberFormat("en-US",{signDisplay:"always"}).format(Math.floor(c)),stats:t,context:`${k.capitalize(l.name)}: Check`,statblock:n})]},i)})})]})},Vn="_heading_1jstp_1",Gn="_itemName_1jstp_7",Qn={heading:Vn,itemName:Gn},Un=({ability:s,statblock:t,stats:n})=>{const[a,l]=_.useState(!1),i=Object.entries(s),c=()=>{let x=!1;return i.forEach(h=>{const[o,u]=h;!["name","type","description","value"].includes(o)&&u&&(x=!0)}),x},r=x=>{let h="";if(Object.keys(x).includes("type")){const o=x;if(o.type==="ONE")h="(one action)";else if(o.type==="TWO")h="(two actions)";else if(o.type==="THREE")h="(three actions)";else if(o.type==="FREE")h="(free action)";else return"";return e.jsx("span",{className:"action-type",children:h})}return""},d=x=>!!Object.keys(x).includes("type");return e.jsxs("div",{className:`pf-ability ${a?"open":""}`,children:[e.jsxs("div",{className:"main-info",children:[e.jsxs("div",{className:"name-and-description",children:[e.jsx("b",{className:"ability-name",children:s.name})," ",r(s),Object.keys(s).includes("description")&&s.description!==""?e.jsx("div",{className:`ability-description ${d(s)?"action":"ability"}`,children:e.jsx(W,{text:s.description,context:`${k.capitalize(s.name)}`,statblock:t,stats:n})}):null]}),c()?e.jsx("button",{className:`expand ${a?"open":""}`,onClick:()=>l(!a)}):null]}),e.jsx("div",{className:`action-details-wrapper  ${a?"open":null}`,children:e.jsx("ul",{className:"action-details",children:Object.entries(s).map(([x,h],o)=>{if(h!==null&&h!==""&&k.isString(h)&&!["name","type","description","value","limit"].includes(x))return e.jsxs("li",{children:[e.jsx("b",{children:x}),":"," ",e.jsx(W,{text:h,stats:n,context:`${k.capitalize(s.name)}: ${k.capitalize(x)}`,statblock:t,damageDie:x==="damage"})]},o)})})})]},s.name)},ye=({heading:s,abilities:t})=>{const{statblock:n,stats:a}=Q();return e.jsxs("div",{children:[e.jsx("h3",{className:Qn.heading,children:s}),e.jsx(M,{}),t==null?void 0:t.map((l,i)=>e.jsxs("div",{children:[e.jsx(Un,{ability:l,statblock:n.name,stats:a},i),e.jsx(z,{})]},i))]})},Zn=()=>{const{statblock:s,item:t}=Q(),{activeTab:n,setActiveTab:a}=xe(),l=`${t.id}-action`,i=_.useMemo(()=>{var x,h;const d=[];return(x=s.actions)!=null&&x.length&&d.push("action"),(h=s.reactions)!=null&&h.length&&d.push("reaction"),d},[s]),c=l in n?n[l]:i[0],r=_.useMemo(()=>c==="action"?e.jsx(ye,{heading:"Actions",abilities:s.actions}):c==="reaction"?e.jsx(ye,{heading:"Reactions",abilities:s.reactions}):e.jsx(e.Fragment,{}),[c]);return e.jsx(e.Fragment,{children:i.length===1?e.jsx(e.Fragment,{children:r}):e.jsxs("div",{className:L.actionWrapper,children:[e.jsx("ul",{className:L.tabs,children:i.map((d,x)=>e.jsx("li",{className:c===d?`${L.tab} ${L.activeTab}`:L.tab,onClick:()=>a(l,d),children:d},x))}),e.jsx("div",{className:L.content,children:r})]})})},Jn="_heading_1vm31_1",Xn="_sectionHeading_1vm31_7",ts={heading:Jn,sectionHeading:Xn},Yn=s=>{var r,d,x;const t=H(R(h=>h.room)),[n,a]=_.useState(!1),l=us(s.spell.slug,t==null?void 0:t.tabletopAlmanacAPIKey),i=l.isSuccess&&l.data?l.data:null,c=He(((r=i==null?void 0:i.description)==null?void 0:r.text)||"");return e.jsxs("li",{className:"spell",children:[e.jsxs("div",{className:"spell-main",children:[e.jsxs("div",{className:"spell-info",children:[e.jsx("div",{className:"spell-header",children:e.jsx("h4",{className:"spell-name",children:i==null?void 0:i.name})}),c?e.jsxs("span",{className:"spell-damage",children:["Damage:"," ",e.jsx(W,{text:c,stats:s.stats,context:`${k.capitalize(i==null?void 0:i.name)} Damage`,statblock:s.statblock,damageDie:!0})]}):null,i!=null&&i.cast?e.jsxs("div",{className:"spell-components",children:[i.cast.verbal?"V":null,i.cast.somatic?"S":null,e.jsxs("span",{className:"spell-materials",children:[i.cast.material?"M":null,e.jsx("span",{className:"material-details",children:i.cast.cost?` (${i.cast.cost})`:null})]})]}):null]}),e.jsx("button",{className:`expand ${n?"open":null}`,onClick:()=>a(!n)})]}),e.jsx("div",{className:`spell-more-info ${n?"open":null}`,children:e.jsxs("div",{className:"more-info-content",children:[e.jsxs("div",{className:"info-bits",children:[i!=null&&i.traits&&i.traits.length>0?e.jsxs("span",{children:[e.jsx("b",{children:"Traits"}),": ",i.traits.map(h=>h.name).join(", ")]}):null,i!=null&&i.traditions&&i.traditions.length>0?e.jsxs("span",{children:[e.jsx("b",{children:"Traditions"}),": ",i.traditions.map(h=>h.name).join(", ")]}):null,i!=null&&i.bloodlines&&i.bloodlines.length>0?e.jsxs("span",{children:[e.jsx("b",{children:"Bloodlines"}),": ",i.bloodlines.map(h=>h.name).join(", ")]}):null,i!=null&&i.deities&&i.deities.length>0?e.jsxs("span",{children:[e.jsx("b",{children:"Deities"}),": ",i.deities.map(h=>h.name).join(", ")]}):null,i!=null&&i.domains&&i.domains.length>0?e.jsxs("span",{children:[e.jsx("b",{children:"Domains"}),": ",i.domains.map(h=>h.name).join(", ")]}):null,i!=null&&i.mysteries&&i.mysteries.length>0?e.jsxs("span",{children:[e.jsx("b",{children:"Mysteries"}),": ",i.mysteries.map(h=>h.name).join(", ")]}):null,i!=null&&i.range?e.jsxs("span",{children:[e.jsx("b",{children:"Range"}),": ",i==null?void 0:i.range]}):null,i!=null&&i.area?e.jsxs("span",{children:[e.jsx("b",{children:"Area"}),": ",i==null?void 0:i.area]}):null,i!=null&&i.targets?e.jsxs("span",{children:[e.jsx("b",{children:"Targets"}),": ",i==null?void 0:i.targets]}):null,i!=null&&i.duration?e.jsxs("span",{children:[e.jsx("b",{children:"Duration"}),": ",i==null?void 0:i.duration]}):null,i!=null&&i.saving_throws?e.jsxs("span",{children:[e.jsx("b",{children:"Saving Throws"}),": ",i==null?void 0:i.saving_throws]}):null,i!=null&&i.trigger?e.jsxs("span",{children:[e.jsx("b",{children:"Trigger"}),": ",i==null?void 0:i.trigger]}):null]}),e.jsxs("div",{className:"spell-description",children:[e.jsx("b",{children:"Description"}),":"," ",e.jsx(W,{text:((d=i==null?void 0:i.description)==null?void 0:d.text)||"",context:`${k.capitalize(i==null?void 0:i.name)}`,statblock:s.statblock,stats:s.stats}),(x=i==null?void 0:i.description)!=null&&x.details&&i.description.details.length>0?e.jsx("ul",{children:i==null?void 0:i.description.details.map((h,o)=>e.jsxs("li",{children:[e.jsx("b",{children:h.title}),":"," ",e.jsx(W,{text:h.text,context:`${k.capitalize(i.name)} ${h.title}`,statblock:s.statblock,stats:s.stats})]},o))}):null]}),i!=null&&i.heightened&&i.heightened.length>0?e.jsxs("div",{className:"spell-higher-level",children:[e.jsx("b",{children:"Heightened"}),":",e.jsx("div",{children:i.heightened.map((h,o)=>e.jsxs("div",{children:[e.jsx("div",{className:"modifier",children:e.jsx(W,{text:h.modifier,stats:s.stats,context:`${k.capitalize(i.name)}: Heightened`,statblock:s.statblock})}),e.jsx("div",{className:"description",children:e.jsx(W,{text:h.description,context:`${k.capitalize(i.name)}: Heightened`,statblock:s.statblock,stats:s.stats})})]},o))})]}):null]})})]})},ei=s=>e.jsxs("div",{className:"spell-list",children:[e.jsxs("h4",{className:"spell-list-title",children:[e.jsxs("span",{className:"spell-list-type",children:[s.list.type,"s"]})," ",e.jsxs("span",{className:"spell-list-level",children:[s.list.level," Level"]})]}),e.jsx("ul",{className:"spells",children:s.list.spells?s.list.spells.map(t=>e.jsxs(e.Fragment,{children:[e.jsx(Yn,{spell:t,statblock:s.statblock,stats:s.stats},t.slug),e.jsx(z,{})]})):null})]}),si=s=>{const[t,n]=_.useState([]),[a,l]=_.useState(!1),i=(r,d)=>r==="All"?-1:d==="All"?1:r==="Cant"||r==="Const"?-1:d==="Cant"||d==="Const"?1:parseInt(r)-parseInt(d),c=["All"].concat(s.spellCategory.spell_lists?s.spellCategory.spell_lists.map(r=>r.type.toLowerCase().startsWith("cantrip")?"Cant":r.type.toLowerCase().startsWith("constant")?"Const":r.level):[]).filter((r,d,x)=>x.indexOf(r)===d).sort(i);return e.jsxs("div",{className:"spell-category",children:[e.jsxs("div",{className:"spell-category-main",children:[e.jsxs("div",{className:"spell-category-header",children:[e.jsx("h3",{className:ts.sectionHeading,children:s.spellCategory.name}),e.jsxs("span",{className:"spell-category-info",children:[s.spellCategory.dc?`DC: ${s.spellCategory.dc}`:null," ",s.spellCategory.attack?e.jsxs("span",{className:"text-roll",children:["Attack:"," ",e.jsx(B,{dice:`d20+${s.spellCategory.attack}`,text:`+${s.spellCategory.attack}`,stats:s.stats,context:`${k.capitalize(s.spellCategory.name)}: Attack`,statblock:s.statblock})]}):null]})]}),e.jsx("button",{className:`expand ${a?"open":null}`,onClick:()=>l(!a)})]}),e.jsx("div",{className:`spell-category-details ${a?"open":null}`,children:e.jsxs("div",{className:"spell-category-details-content",children:[e.jsx(Ye,{filters:c,spellFilter:t,setSpellFilter:n,left:!0}),s.spellCategory.spell_lists?s.spellCategory.spell_lists.sort((r,d)=>{let x=r.level,h=d.level;return r.type.toLowerCase().startsWith("cantrip")?x="Cant":r.type.toLowerCase().startsWith("constant")&&(x="Const"),d.type.toLowerCase().startsWith("cantrip")?h="Cant":d.type.toLowerCase().startsWith("constant")&&(h="Const"),i(x,h)}).filter(r=>t.length===0?!0:r.type==="spell"?t.indexOf(parseInt(r.level))>=0:r.type.toLowerCase().startsWith("cantrip")?t.indexOf(0)>=0:t.indexOf(-1)>=0).map(r=>e.jsx(ei,{list:r,statblock:s.statblock,stats:s.stats},r.type+r.level)):null]})})]})},ti=s=>e.jsxs("div",{className:"spells",children:[e.jsx("h3",{className:ts.heading,children:"Spells"}),e.jsx(M,{}),s.spells.map((t,n)=>t?e.jsx(si,{stats:s.stats,spellCategory:t,statblock:s.statblock},t.name+n):null),e.jsx(M,{})]}),ni=()=>{var t;const{statblock:s}=Q();return e.jsxs("div",{children:[e.jsx("h3",{className:K.heading,children:"Inventory"}),e.jsx(M,{}),e.jsx("ul",{children:(t=s.items)==null?void 0:t.map((n,a)=>e.jsx("li",{children:n},a))})]})},ii=()=>{const{statblock:s,item:t}=Q(),{activeTab:n,setActiveTab:a}=xe(),l=t.id in n?n[t.id]:"general",i=_.useMemo(()=>{var d,x,h,o,u;const r=["general","skills"];return((d=s.actions)!=null&&d.length||(x=s.reactions)!=null&&x.length)&&r.push("actions"),(h=s.items)!=null&&h.length&&r.push("inventory"),(o=s.spells)!=null&&o.length&&r.push("spells"),(u=s.special_abilities)!=null&&u.length&&r.push("special"),r},[s]),c=_.useMemo(()=>l==="general"?e.jsx(In,{}):l==="skills"?e.jsx(Wn,{}):l==="actions"?e.jsx(Zn,{}):l==="inventory"?e.jsx(ni,{}):l==="spells"?e.jsx(ti,{spells:s.spells,statblock:s.name,stats:s.stats}):l==="special"?e.jsx(ye,{heading:"Reactions",abilities:s.special_abilities}):e.jsx(e.Fragment,{}),[l]);return e.jsxs("div",{className:L.wrapper,children:[e.jsx("ul",{className:L.tabs,children:i.map((r,d)=>e.jsx("li",{className:l===r?`${L.tab} ${L.activeTab}`:L.tab,onClick:()=>a(t.id,r),children:r},d))}),e.jsx("div",{className:L.content,children:c})]})},ai=()=>{const{statblock:s}=Q();return e.jsxs("div",{className:G.statblock,children:[e.jsxs("div",{className:G.title,children:[e.jsxs("div",{children:[e.jsx("h1",{className:G.name,children:s.name}),e.jsxs("div",{className:G.note,children:["Type: ",s.type,", Level: ",s.level]})]}),e.jsx($n,{})]}),e.jsx(ii,{})]})},li=({slug:s,itemId:t})=>{const n=H(R(i=>i.room)),a=ms(s,n==null?void 0:n.tabletopAlmanacAPIKey),l=a.isSuccess&&a.data?a.data:null;return l?e.jsx(Nn,{itemId:t,statblock:l,children:e.jsx(ai,{})}):e.jsx(te,{})},wi=({id:s})=>{const t=H(R(l=>l.room)),n=ke(R(l=>{var i;return(i=l.tokens)==null?void 0:i.get(s)})),a=n==null?void 0:n.data;return n?e.jsx("div",{className:"statblock-wrapper",children:t&&t.ruleset==="e5"?e.jsx(yn,{slug:a.sheet,itemId:s}):e.jsx(li,{slug:a.sheet,itemId:s})}):null},Ne=({options:s,current:t,setTheme:n})=>{const[a,l]=_.useState(t),[i,c]=_.useState(!1);return e.jsxs("div",{className:`select ${i?"open":"close"}`,children:[e.jsxs("div",{className:"select-current",onClick:()=>c(!0),children:[e.jsxs("span",{className:"current",children:[(a==null?void 0:a.icon)||null,e.jsx("span",{children:(a==null?void 0:a.name)||""})]}),e.jsx("div",{className:"expand-wrapper",children:e.jsx("button",{className:"expand button"})})]}),e.jsx("div",{className:"height-wrapper",children:e.jsxs("div",{className:"options-wrapper",children:[e.jsx("div",{className:"select-options",children:s.sort((r,d)=>r.value===(a==null?void 0:a.value)?-1:d.value===(a==null?void 0:a.value)?1:0).map(r=>e.jsxs("div",{className:`select-option ${(a==null?void 0:a.value)===r.value?"current":""}`,onClick:()=>{l(r),n(r.value),c(!1)},children:[r.icon||null,e.jsxs("span",{className:"name",children:[r.name," "]})]},r.value))}),e.jsx("div",{className:"expand-wrapper",onClick:()=>{c(!1)},children:e.jsx("button",{className:"expand button"})})]})})]})},ci=({setSettings:s})=>{var m;const t=H(R(p=>p.room)),[n,a,l,i,c]=me(R(p=>[p.rollerApi,p.theme,p.setTheme,p.themes,p.rooms])),r=ne(),[d,x]=_.useState(!0),[h,o]=_.useState(!1),[u,f]=_.useState(null),v=c.find(p=>{var g;return p.slug===((g=t==null?void 0:t.diceRoom)==null?void 0:g.slug)}),j=async(p,g)=>{var w;try{o(!0);const y=(w=await(n==null?void 0:n.theme.get(p)))==null?void 0:w.data;y&&Le(y)?y.id!==(a==null?void 0:a.id)&&(t&&r.id?(await re(t,r.id,{diceTheme:y.id}),x(!0),l(y)):(g&&(g.value=(a==null?void 0:a.id)||""),f("error updating theme"),x(!1))):x(!1)}catch{g&&(g.value=(a==null?void 0:a.id)||""),f("theme not found"),x(!1)}finally{o(!1)}};return _.useEffect(()=>{u&&setTimeout(()=>{f(null)},5e3)},[u]),e.jsxs("div",{className:"dice-settings",children:[e.jsx("button",{className:"close-button",onClick:()=>{s(!1)},children:"X"}),n?e.jsxs("div",{className:`setting dice-theme ${d?"valid":"invalid"} ${h?"searching":""}`,children:[e.jsx("span",{className:"setting-name",children:"dice theme:"}),e.jsx(Ne,{options:k.isNull(i)?[]:i.filter(p=>Le(p)).map(p=>({value:p.id,name:p.name||p.id,icon:ee(p)})),current:a?{value:a.id,name:a.name,icon:ee(a)}:void 0,setTheme:j})]}):e.jsx("span",{children:"Unable to connect with dddice"}),u?e.jsx("span",{children:u}):null,r.role==="GM"?e.jsxs("div",{className:"setting dice-room-select valid",children:[e.jsx("span",{className:"setting-name",children:"dice room:"}),c.length===0&&!v?e.jsx(te,{className:"room-loader"}):e.jsx(Ne,{options:c.map(p=>({value:p.slug,name:`${p.name} - ${p.slug}`})),current:v?{value:v.slug,name:`${v.name} - ${v.slug}`}:void 0,setTheme:async p=>{t&&await bs(t,p)}})]}):null,e.jsxs("div",{className:"setting dice-rendering",children:[e.jsx("span",{className:"text",children:"Render 3D Dice "}),e.jsx("input",{type:"checkbox",checked:((m=_e(t,r.id))==null?void 0:m.diceRendering)??!0,onChange:async()=>{if(t){const p=Z.player.id,g=_e(t,p);g&&(await re(t,p,{diceRendering:!g.diceRendering}),g.diceRendering||await Z.modal.open({..._s,url:`https://dddice.com/room/${t.diceRoom.slug}/stream?key=${g.apiKey}`}))}}})]})]})},se=()=>e.jsx("svg",{className:"dice-svg",viewBox:"0 0 50 50",version:"1.1",children:e.jsxs("g",{transform:"matrix(0.09730448,0,0,0.09730448,0.02976391,0.15890765)",children:[e.jsx("path",{d:"M 449.532,105.602 288.463,8.989 C 278.474,2.994 267.235,0 256.011,0 244.772,0 233.528,2.994 223.544,8.989 L 62.475,105.602 c -19.012,11.406 -30.647,31.95 -30.647,54.117 v 192.562 c 0,22.168 11.635,42.711 30.647,54.117 l 161.069,96.613 c 9.984,5.988 21.228,8.989 32.467,8.989 11.225,0 22.463,-3.001 32.452,-8.989 l 161.069,-96.613 c 19.012,-11.406 30.64,-31.949 30.64,-54.117 V 159.719 c 0,-22.167 -11.628,-42.711 -30.64,-54.117 z M 250.599,492.733 c -6.029,-0.745 -11.93,-2.719 -17.32,-5.948 L 72.21,390.172 C 58.904,382.183 50.754,367.803 50.754,352.281 V 159.719 c 0,-6.022 1.236,-11.862 3.518,-17.233 L 250.6,260.246 V 492.733 Z M 59.669,133.114 c 3.364,-4.464 7.593,-8.318 12.541,-11.285 L 233.279,25.216 c 6.995,-4.196 14.85,-6.291 22.732,-6.291 7.868,0 15.723,2.095 22.718,6.291 l 161.069,96.613 c 4.941,2.967 9.184,6.821 12.54,11.285 L 256.011,250.881 Z m 401.585,219.167 c 0,15.522 -8.15,29.902 -21.456,37.891 l -161.069,96.613 c -5.398,3.229 -11.292,5.203 -17.321,5.948 V 260.246 l 196.328,-117.76 c 2.283,5.37 3.518,11.211 3.518,17.233 z"}),e.jsx("path",{d:"m 160.209,119.875 c -9.828,-7.278 -26.021,-7.465 -36.165,-0.41 -10.144,7.056 -10.399,18.67 -0.57,25.947 9.828,7.277 26.022,7.459 36.159,0.41 10.15,-7.056 10.405,-18.67 0.576,-25.947 z"}),e.jsx("path",{d:"m 279.159,48.686 c -9.829,-7.277 -26.022,-7.458 -36.172,-0.403 -10.137,7.049 -10.393,18.664 -0.564,25.941 9.829,7.284 26.022,7.458 36.159,0.416 10.15,-7.062 10.405,-18.677 0.577,-25.954 z"}),e.jsx("path",{d:"m 220.59,82.024 c -9.834,-7.27 -26.028,-7.458 -36.172,-0.403 -10.15,7.049 -10.406,18.664 -0.571,25.941 9.829,7.284 26.022,7.458 36.166,0.416 10.138,-7.062 10.399,-18.676 0.577,-25.954 z"}),e.jsx("path",{d:"m 267.437,184.754 c -9.828,-7.277 -26.015,-7.459 -36.159,-0.41 -10.15,7.056 -10.405,18.671 -0.577,25.947 9.828,7.284 26.021,7.459 36.172,0.41 10.137,-7.056 10.392,-18.67 0.564,-25.947 z"}),e.jsx("path",{d:"m 386.385,113.564 c -9.828,-7.271 -26.021,-7.458 -36.158,-0.403 -10.151,7.049 -10.406,18.664 -0.577,25.941 9.828,7.284 26.02,7.458 36.172,0.416 10.137,-7.062 10.392,-18.676 0.563,-25.954 z"}),e.jsx("path",{d:"m 327.817,146.903 c -9.829,-7.27 -26.022,-7.458 -36.172,-0.403 -10.137,7.049 -10.392,18.664 -0.564,25.941 9.828,7.284 26.021,7.465 36.158,0.416 10.152,-7.062 10.407,-18.669 0.578,-25.954 z"}),e.jsx("path",{d:"m 89.289,248.303 c 11.158,6.083 20.194,1.961 20.194,-9.19 0,-11.158 -9.036,-25.128 -20.194,-31.21 -11.157,-6.083 -20.207,-1.967 -20.207,9.19 -10e-4,11.151 9.049,25.128 20.207,31.21 z"}),e.jsx("path",{d:"m 202.061,309.771 c 11.158,6.082 20.208,1.967 20.208,-9.184 0,-11.157 -9.05,-25.135 -20.208,-31.217 -11.15,-6.076 -20.194,-1.961 -20.194,9.198 0,11.151 9.044,25.121 20.194,31.203 z"}),e.jsx("path",{d:"m 89.289,361.082 c 11.158,6.076 20.194,1.967 20.194,-9.19 0,-11.158 -9.036,-25.129 -20.194,-31.21 -11.157,-6.083 -20.207,-1.968 -20.207,9.19 -10e-4,11.157 9.049,25.128 20.207,31.21 z"}),e.jsx("path",{d:"m 202.061,422.55 c 11.158,6.082 20.208,1.967 20.208,-9.191 0,-11.151 -9.05,-25.128 -20.208,-31.21 -11.15,-6.076 -20.194,-1.961 -20.194,9.19 0,11.158 9.044,25.129 20.194,31.211 z"}),e.jsx("path",{d:"m 145.675,335.424 c 11.158,6.082 20.201,1.967 20.201,-9.191 0,-11.151 -9.044,-25.128 -20.201,-31.204 -11.158,-6.082 -20.201,-1.967 -20.201,9.185 0,11.156 9.043,25.127 20.201,31.21 z"}),e.jsx("path",{d:"m 418.341,207.902 c -11.158,6.082 -20.208,20.053 -20.208,31.21 0,11.151 9.05,15.273 20.208,9.19 11.144,-6.082 20.194,-20.059 20.194,-31.21 0,-11.157 -9.049,-15.273 -20.194,-9.19 z"}),e.jsx("path",{d:"m 305.555,382.149 c -11.158,6.082 -20.194,20.059 -20.194,31.21 0,11.158 9.036,15.273 20.194,9.191 11.158,-6.082 20.194,-20.053 20.194,-31.211 0,-11.151 -9.035,-15.265 -20.194,-9.19 z"}),e.jsx("path",{d:"m 361.948,295.028 c -11.158,6.076 -20.207,20.053 -20.207,31.204 0,11.158 9.05,15.273 20.207,9.191 11.158,-6.083 20.194,-20.053 20.194,-31.21 0,-11.151 -9.036,-15.266 -20.194,-9.185 z"})]})}),ri=()=>e.jsx("svg",{className:"add-svg",height:"24",viewBox:"0 -960 960 960",width:"24",children:e.jsx("path",{d:"M440-440H200v-80h240v-240h80v240h240v80H520v240h-80v-240Z"})}),oi=()=>e.jsxs("svg",{className:"roll-log-svg",viewBox:"0 0 128 128",width:"64px",height:"64px",children:[e.jsx("path",{d:"M 114.638,0.55489756 H 23.775355 c -7.269012,0 -13.124604,5.85559234 -13.124604,13.12460444 v 77.73804 c 0,1.716297 1.31246,3.028759 3.028754,3.028759 1.716294,0 3.028755,-1.312462 3.028755,-3.028759 v -77.73804 c 0,-3.9373809 3.129713,-7.0670952 7.067095,-7.0670952 h 79.757215 c -1.31246,2.0191707 -2.01917,4.4421742 -2.01917,7.0670952 V 114.638 c 0,3.93738 -3.129714,7.06709 -7.06709,7.06709 -3.937384,0 -7.067098,-3.12971 -7.067098,-7.06709 v -10.09585 c 0,-1.7163 -1.312461,-3.02876 -3.028761,-3.02876 H 3.5836557 c -1.7162944,0 -3.02875499,1.31246 -3.02875499,3.02876 V 114.638 c 0,7.26901 5.85559229,13.1246 13.12460429,13.1246 H 94.44631 c 7.26901,0 13.1246,-5.85559 13.1246,-13.1246 V 13.679502 c 0,-3.9373809 3.12972,-7.0670952 7.06709,-7.0670952 3.93739,0 7.0671,3.1297143 7.0671,7.0670952 v 7.067095 h -7.0671 c -1.71629,0 -3.02875,1.31246 -3.02875,3.028755 0,1.716294 1.31246,3.028754 3.02875,3.028754 h 10.09585 c 1.7163,0 3.02876,-1.31246 3.02876,-3.028754 v -10.09585 c 0,-7.2690121 -5.85559,-13.12460444 -13.12461,-13.12460444 z M 13.679505,121.70509 c -3.9373809,0 -7.0670942,-3.12971 -7.0670942,-7.06709 v -7.0671 H 81.321701 v 7.0671 c 0,2.62492 0.807662,5.04792 2.019169,7.06709 z"}),e.jsxs("g",{transform:"matrix(0.15293651,0,0,0.15293651,20.080574,15.684728)",children:[e.jsx("path",{d:"M 449.532,105.602 288.463,8.989 C 278.474,2.994 267.235,0 256.011,0 244.772,0 233.528,2.994 223.544,8.989 L 62.475,105.602 c -19.012,11.406 -30.647,31.95 -30.647,54.117 v 192.562 c 0,22.168 11.635,42.711 30.647,54.117 l 161.069,96.613 c 9.984,5.988 21.228,8.989 32.467,8.989 11.225,0 22.463,-3.001 32.452,-8.989 l 161.069,-96.613 c 19.012,-11.406 30.64,-31.949 30.64,-54.117 V 159.719 c 0,-22.167 -11.628,-42.711 -30.64,-54.117 z M 250.599,492.733 c -6.029,-0.745 -11.93,-2.719 -17.32,-5.948 L 72.21,390.172 C 58.904,382.183 50.754,367.803 50.754,352.281 V 159.719 c 0,-6.022 1.236,-11.862 3.518,-17.233 L 250.6,260.246 V 492.733 Z M 59.669,133.114 c 3.364,-4.464 7.593,-8.318 12.541,-11.285 L 233.279,25.216 c 6.995,-4.196 14.85,-6.291 22.732,-6.291 7.868,0 15.723,2.095 22.718,6.291 l 161.069,96.613 c 4.941,2.967 9.184,6.821 12.54,11.285 L 256.011,250.881 Z m 401.585,219.167 c 0,15.522 -8.15,29.902 -21.456,37.891 l -161.069,96.613 c -5.398,3.229 -11.292,5.203 -17.321,5.948 V 260.246 l 196.328,-117.76 c 2.283,5.37 3.518,11.211 3.518,17.233 z"}),e.jsx("path",{d:"m 160.209,119.875 c -9.828,-7.278 -26.021,-7.465 -36.165,-0.41 -10.144,7.056 -10.399,18.67 -0.57,25.947 9.828,7.277 26.022,7.459 36.159,0.41 10.15,-7.056 10.405,-18.67 0.576,-25.947 z"}),e.jsx("path",{d:"m 279.159,48.686 c -9.829,-7.277 -26.022,-7.458 -36.172,-0.403 -10.137,7.049 -10.393,18.664 -0.564,25.941 9.829,7.284 26.022,7.458 36.159,0.416 10.15,-7.062 10.405,-18.677 0.577,-25.954 z"}),e.jsx("path",{d:"m 220.59,82.024 c -9.834,-7.27 -26.028,-7.458 -36.172,-0.403 -10.15,7.049 -10.406,18.664 -0.571,25.941 9.829,7.284 26.022,7.458 36.166,0.416 10.138,-7.062 10.399,-18.676 0.577,-25.954 z"}),e.jsx("path",{d:"m 267.437,184.754 c -9.828,-7.277 -26.015,-7.459 -36.159,-0.41 -10.15,7.056 -10.405,18.671 -0.577,25.947 9.828,7.284 26.021,7.459 36.172,0.41 10.137,-7.056 10.392,-18.67 0.564,-25.947 z"}),e.jsx("path",{d:"m 386.385,113.564 c -9.828,-7.271 -26.021,-7.458 -36.158,-0.403 -10.151,7.049 -10.406,18.664 -0.577,25.941 9.828,7.284 26.02,7.458 36.172,0.416 10.137,-7.062 10.392,-18.676 0.563,-25.954 z"}),e.jsx("path",{d:"m 327.817,146.903 c -9.829,-7.27 -26.022,-7.458 -36.172,-0.403 -10.137,7.049 -10.392,18.664 -0.564,25.941 9.828,7.284 26.021,7.465 36.158,0.416 10.152,-7.062 10.407,-18.669 0.578,-25.954 z"}),e.jsx("path",{d:"m 89.289,248.303 c 11.158,6.083 20.194,1.961 20.194,-9.19 0,-11.158 -9.036,-25.128 -20.194,-31.21 -11.157,-6.083 -20.207,-1.967 -20.207,9.19 -10e-4,11.151 9.049,25.128 20.207,31.21 z"}),e.jsx("path",{d:"m 202.061,309.771 c 11.158,6.082 20.208,1.967 20.208,-9.184 0,-11.157 -9.05,-25.135 -20.208,-31.217 -11.15,-6.076 -20.194,-1.961 -20.194,9.198 0,11.151 9.044,25.121 20.194,31.203 z"}),e.jsx("path",{d:"m 89.289,361.082 c 11.158,6.076 20.194,1.967 20.194,-9.19 0,-11.158 -9.036,-25.129 -20.194,-31.21 -11.157,-6.083 -20.207,-1.968 -20.207,9.19 -10e-4,11.157 9.049,25.128 20.207,31.21 z"}),e.jsx("path",{d:"m 202.061,422.55 c 11.158,6.082 20.208,1.967 20.208,-9.191 0,-11.151 -9.05,-25.128 -20.208,-31.21 -11.15,-6.076 -20.194,-1.961 -20.194,9.19 0,11.158 9.044,25.129 20.194,31.211 z"}),e.jsx("path",{d:"m 145.675,335.424 c 11.158,6.082 20.201,1.967 20.201,-9.191 0,-11.151 -9.044,-25.128 -20.201,-31.204 -11.158,-6.082 -20.201,-1.967 -20.201,9.185 0,11.156 9.043,25.127 20.201,31.21 z"}),e.jsx("path",{d:"m 418.341,207.902 c -11.158,6.082 -20.208,20.053 -20.208,31.21 0,11.151 9.05,15.273 20.208,9.19 11.144,-6.082 20.194,-20.059 20.194,-31.21 0,-11.157 -9.049,-15.273 -20.194,-9.19 z"}),e.jsx("path",{d:"m 305.555,382.149 c -11.158,6.082 -20.194,20.059 -20.194,31.21 0,11.158 9.036,15.273 20.194,9.191 11.158,-6.082 20.194,-20.053 20.194,-31.211 0,-11.151 -9.035,-15.265 -20.194,-9.19 z"}),e.jsx("path",{d:"m 361.948,295.028 c -11.158,6.076 -20.207,20.053 -20.207,31.204 0,11.158 9.05,15.273 20.207,9.191 11.158,-6.083 20.194,-20.053 20.194,-31.21 0,-11.151 -9.036,-15.266 -20.194,-9.185 z"})]})]}),di=s=>{const[t,n,a,l]=me(R(b=>[b.rollerApi,b.theme,b.initialized,b.themes])),i=ue(R(b=>b.addRoll)),{buttons:c,setButtons:r}=Ke(),[d,x]=H(R(b=>[b.room,b.taSettings])),[h,o]=_.useState(!1),[u,f]=_.useState(!1),[v,j]=_.useState(!1),[m,p]=_.useState(n),g=_.useRef(null),y=ne().role==="GM"&&!!x.gm_rolls_hidden;_.useEffect(()=>{p(n)},[n]);const C=b=>{if(!k.isNull(l)){const N=l.find(T=>T.id===b);N&&p(N)}},D=_.useCallback(()=>{if(s.customDice&&n&&!(d!=null&&d.disableDiceRoller))try{const b=ae.parseRollEquation(s.customDice.dice,s.customDice.theme??n.id);return e.jsx("div",{className:"custom-dice-preview-wrapper",children:b.dice.map((N,T)=>{var V;if(N.type!=="mod"){const I=Cs(n,N.type,T,(V=s.customDice)==null?void 0:V.theme,l);if(I)return I}if(N.type!=="mod"&&n.preview.hasOwnProperty(N.type))return e.jsx("img",{className:"preview-image",src:n.preview[N.type],alt:N.type},T);if(N.type!=="mod"&&!n.preview.hasOwnProperty(N.type))return e.jsx("div",{className:"preview-image",children:oe(N.type)},T);if(N.value)return e.jsx("span",{className:"modifier",children:Intl.NumberFormat("en-US",{signDisplay:"always"}).format(N.value)},T)})})}catch{return e.jsx(se,{})}else if(s.customDice)try{const b=ae.parseRollEquation(s.customDice.dice,s.customDice.theme??"dddice-bees");return e.jsx("div",{className:"custom-dice-preview-wrapper",children:b.dice.map((N,T)=>{if(N.type!=="mod")return e.jsx("div",{className:"preview-image",children:oe(N.type)},T);if(N.value)return e.jsx("span",{className:"modifier",children:Intl.NumberFormat("en-US",{signDisplay:"always"}).format(N.value)},T)})})}catch{return e.jsx(se,{})}return e.jsx(se,{})},[n,s.customDice,d==null?void 0:d.disableDiceRoller,l,t]),$=async(b,N=!1)=>{if(b.classList.add("rolling"),!(d!=null&&d.disableDiceRoller)&&t&&n&&s.customDice){let T=Ve(s.customDice.dice,s.customDice.theme??n.id);await Ge(t,T.dice,{operator:T.operator,label:"Roll: Custom",whisper:N?await Qe(d,t):void 0})}else s.customDice&&await Ue(s.customDice.dice,"Roll: Custom",i,N);b.classList.remove("rolling"),b.blur()},P=_.useCallback(()=>a&&!(d!=null&&d.disableDiceRoller)||(d==null?void 0:d.disableDiceRoller),[a,d==null?void 0:d.disableDiceRoller]);return e.jsxs("div",{className:`custom-dice-wrapper ${s.customDice&&!s.customDice.removed?"has-dice":""}`,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[e.jsx(F,{content:s.customDice&&!s.customDice.removed?s.customDice.dice:"Add new custom dice roll",children:e.jsx("button",{className:`button custom-dice dice-${s.button} ${P()?"enabled":"disabled"} ${u?"open":""}`,onClick:async b=>{(!s.customDice||s.customDice.removed)&&c.hasOwnProperty(String(s.button))?f(!0):s.customDice&&!s.customDice.removed&&await $(b.currentTarget,y)},children:s.customDice&&!s.customDice.removed?D():e.jsx(ri,{})})}),u?e.jsxs("div",{className:"add-custom-dice",children:[d!=null&&d.disableDiceRoller?null:e.jsx("div",{className:"setting dice-theme valid searching",children:e.jsx(Ne,{options:k.isNull(l)?[]:l.map(b=>({value:b.id,name:b.name||b.id,icon:ee(b)})),current:{value:(m==null?void 0:m.id)||(n==null?void 0:n.id)||"",name:(m==null?void 0:m.name)||(n==null?void 0:n.name)||"",icon:m?ee(m):n?ee(n):void 0},setTheme:C})}),e.jsxs("div",{className:"dice-equation",children:[e.jsx("input",{ref:g,type:"text",onChange:b=>{var T,V,I,Ce,De,Se;const N=b.currentTarget.value;try{m&&!(d!=null&&d.disableDiceRoller)?ae.parseRollEquation(N,m)&&(j(!0),(T=g.current)==null||T.classList.remove("error"),(V=g.current)==null||V.classList.add("success")):new We(N)&&(j(!0),(I=g.current)==null||I.classList.remove("error"),(Ce=g.current)==null||Ce.classList.add("success"))}catch{j(!1),(De=g.current)==null||De.classList.remove("success"),(Se=g.current)==null||Se.classList.add("error")}},onKeyDown:b=>{if(b.key==="Enter"&&v){const N={[s.button]:{dice:b.currentTarget.value,theme:m?m.id:n?n.id:"dddice-bees"}};r(N),f(!1),j(!1)}else b.key==="Escape"&&f(!1)}}),e.jsx("button",{className:"save-custom-dice",disabled:!v,onClick:()=>{if(g.current){const b={[s.button]:{dice:g.current.value,theme:m?m.id:n?n.id:"dddice-bees"}};r(b),f(!1),j(!1)}},children:""}),e.jsx("button",{className:"abort-custom-dice",onClick:()=>{f(!1)},children:"X"})]})]}):null,s.customDice&&!s.customDice.removed?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`hidden-roll self ${h?"hover":""}`,onClick:b=>{b.currentTarget.parentElement&&$(b.currentTarget.parentElement,!y)},children:y?"SHOW":"HIDE"}),e.jsx("button",{className:`remove-dice ${h?"hover":""}`,onClick:()=>{if(s.customDice&&!s.customDice.removed&&c.hasOwnProperty(String(s.button))){const b={[s.button]:{...s.customDice,removed:!0}};r(b)}},children:"x"})]}):null]})},ui=({open:s})=>{const{theme:t,rollerApi:n}=me(),a=ue(R(u=>u.addRoll)),[l,i]=H(R(u=>[u.room,u.taSettings])),[c,r]=_.useState(!0),x=ne().role==="GM"&&!!i.gm_rolls_hidden,h=async(u,f,v=!1)=>{if(u.classList.add("rolling"),t&&f&&!(l!=null&&l.disableDiceRoller)){let j=Ve(f,t.id);n&&await Ge(n,j.dice,{operator:j.operator,label:"Roll: Custom",whisper:v?await Qe(l,n):void 0})}else await Ue(f,"Roll: Custom",a,v);u.classList.remove("rolling"),u.blur()},o=()=>{const u=({preview:f,name:v})=>e.jsx(F,{content:v,children:e.jsxs("li",{className:"quick-roll",onClick:async j=>{await h(j.currentTarget,v,x)},children:[e.jsx("div",{className:"quick-preview",children:f}),e.jsx("button",{className:"self",onClick:async j=>{j.stopPropagation(),j.currentTarget.parentElement&&await h(j.currentTarget.parentElement,v,!x)},children:x?"SHOW":"HIDE"})]})});return t&&!(l!=null&&l.disableDiceRoller)?t.available_dice.map((f,v)=>{let j="",m="";try{if(f.hasOwnProperty("type")){const p=f.notation,g=f.id;t.preview.hasOwnProperty(g)?j=t.preview[g]:p&&t.preview.hasOwnProperty(p)?j=t.preview[p]:j=t.preview[f.type],m=f.notation??f.id}else j=t.preview[f],m=String(f);if(m)return m=m==="d10x"?"d100":m,e.jsx(u,{preview:j?e.jsx("img",{src:j,alt:m}):oe(m),name:m},v)}catch{return null}}):["d4","d6","d8","d10","d10x","d12","d20"].map((v,j)=>{const m=v==="d10x"?"d100":v;return e.jsx(u,{preview:oe(v),name:m},j)})};return e.jsx(e.Fragment,{children:e.jsxs("ul",{className:`quick-button-list ${s?"open":""}`,children:[o(),e.jsxs("li",{className:"quick-custom-roll",children:[e.jsx(se,{}),e.jsx("input",{className:`quick-custom-input ${c?"valid":"invalid"}`,type:"text",size:2,onChange:u=>{if(u.currentTarget.style.width=`${u.currentTarget.value.length}ch`,u.currentTarget.value===""){r(!0);return}try{if(t&&!(l!=null&&l.disableDiceRoller)){const f=ae.parseRollEquation(u.currentTarget.value,t.id);r(!!f)}else new We(u.currentTarget.value)&&r(!0)}catch{r(!1)}},onKeyDown:async u=>{u.key==="Enter"&&c&&u.currentTarget.value&&await h(u.currentTarget,u.currentTarget.value)}})]})]})})},mi=s=>{const{buttons:t,setButtons:n}=Ke(),[a,l]=_.useState(!1);return _.useEffect(()=>{t&&Object.entries(t).forEach(([i,c])=>{c&&k.isString(c)&&n({[i]:null})})},[t]),e.jsxs("div",{className:"dice-room-buttons",children:[Object.values(t).map((i,c)=>e.jsx(di,{button:c+1,customDice:i},c)),e.jsx(F,{content:"Log & Settings",children:e.jsx("button",{className:`open-dice-tray button icon ${s.open?"open":"closed"}`,onClick:i=>{s.setOpen(!s.open),i.currentTarget.blur()},children:e.jsx(oi,{})})}),e.jsxs("div",{className:"quick-button-wrapper",children:[e.jsx(ui,{open:a}),e.jsx(F,{content:"Quick roll",children:e.jsx("button",{onClick:()=>l(!a),className:`quick-roll-button button icon ${a?"open":""}`,children:e.jsx(se,{})})})]})]})},hi=()=>e.jsx("svg",{className:"copy-icon",height:"18.499901",viewBox:"0 -960 619.99603 739.99603",width:"15.499901",version:"1.1",children:e.jsx("path",{d:"m 212.306,-360.002 q -30.308,0 -51.307,-21 -21,-21 -21,-51.308 v -455.382 q 0,-30.308 21,-51.308 20.999,-21 51.307,-21 h 335.383 q 30.307,0 51.307,21 21,21 21,51.308 v 455.382 q 0,30.308 -21,51.308 -21,21 -51.307,21 z m 0,-59.999 h 335.383 q 4.615,0 8.462,-3.846 3.846,-3.847 3.846,-8.463 v -455.382 q 0,-4.616 -3.846,-8.463 -3.847,-3.846 -8.462,-3.846 H 212.306 q -4.616,0 -8.462,3.846 -3.847,3.847 -3.847,8.463 v 455.382 q 0,4.616 3.847,8.463 3.846,3.846 8.462,3.846 z M 72.307001,-220.004 q -30.307,0 -51.307,-21 Q 1.0986328e-6,-262.004 1.0986328e-6,-292.311 V -807.692 H 59.999001 v 515.381 q 0,4.616 3.846,8.462 3.847,3.847 8.462,3.847 H 467.689 v 59.998 z M 199.997,-420.001 v -480 z"})}),xi=({className:s,user:t})=>{var x;const n=H(R(h=>h.room)),a=ue(R(h=>h.clear)),[l,i]=_.useState(!1),[c,r]=_.useState(!1),d=ne();return _.useEffect(()=>{c||i(!1)},[c]),e.jsxs("div",{className:`dice-room ${s} ${c?"open":"closed"}`,children:[e.jsx(mi,{open:c,setOpen:r}),e.jsx("div",{className:"dice-tray-wrapper",children:e.jsx("div",{className:`dice-tray ${c?"open":"closed"}`,children:e.jsxs("div",{className:"dice-tray-content",children:[e.jsx("div",{className:"top",children:n!=null&&n.disableDiceRoller?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"clear-log",onClick:()=>{a()},children:"Clear"}),d.role==="GM"?e.jsx("button",{onClick:async()=>{await ys(n,{disableDiceRoller:!1})},children:"Enabled dddice Integration"}):null]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"dddice-login",onClick:async()=>{let h=500,o=600;try{h=await Z.viewport.getWidth(),o=await Z.viewport.getHeight()}catch{}await Z.modal.open({...Ns,width:Math.min(400,h*.9),height:Math.min(500,o*.9)})},children:t&&t.name!=="Guest User"?t.username:"Login"}),e.jsxs("div",{className:"room-link",children:[e.jsx("a",{href:`https://dddice.com/room/${(x=n==null?void 0:n.diceRoom)==null?void 0:x.slug}`,target:"_blank",children:"Room Link"}),e.jsx("button",{className:"copy-link",onClick:h=>{var o;navigator.clipboard.writeText(`https://dddice.com/room/${(o=n==null?void 0:n.diceRoom)==null?void 0:o.slug}`),h.currentTarget.blur()},children:e.jsx(hi,{})})]}),e.jsxs("div",{className:"side-buttons",children:[e.jsx("button",{className:"clear-log",onClick:()=>{a()},children:"Clear"}),e.jsxs("div",{className:"dice-settings-wrapper",children:[e.jsx("button",{className:"dice-settings-button",onClick:()=>{i(!l)},children:"Settings"}),l?e.jsx(ci,{setSettings:i}):null]})]})]})}),e.jsx(Ds,{})]})})})]})},je="https://dddice.com/api/1.0",ji=async(s,t)=>Ze.request({url:t??`${je}/dice-box`,headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json",Accept:"application/json"}}).then(n=>n.status===200?n.data:null),pi=s=>Je({queryKey:["themes"],queryFn:async({pageParam:t})=>await ji(s,t),initialPageParam:`${je}/dice-box`,getNextPageParam:t=>t.links.next,enabled:s!==""}),gi=async(s,t)=>Ze.request({url:t??`${je}/room`,headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json",Accept:"application/json"}}).then(n=>n.status===200?n.data:null),fi=s=>Je({queryKey:["rooms"],queryFn:async({pageParam:t})=>await gi(s,t),initialPageParam:`${je}/room`,getNextPageParam:t=>t.links.next,enabled:s!==""}),$i=s=>{var D;const[t,n,a,l,i,c,r,d,x]=me(R($=>[$.rollerApi,$.setRollerApi,$.setInitialized,$.theme,$.setTheme,$.themes,$.setThemes,$.rooms,$.setRooms])),h=ne(),o=H(R($=>$.room)),[u,f]=_.useState(),[v,j]=_.useState(),[m,p]=_.useState(),[g,w]=_.useState(),y=pi((u==null?void 0:u.apiKey)||""),C=fi((u==null?void 0:u.apiKey)||"");return _.useEffect(()=>{if(h.role==="GM"&&d.length===0){if(C.hasNextPage&&!C.isFetchingNextPage)C.fetchNextPage();else if(!C.hasNextPage&&C.isSuccess){const $=C.isSuccess?C.data.pages.flatMap(P=>P.data):[];x($)}}},[C.hasNextPage,C.isFetchingNextPage,C.isSuccess]),_.useEffect(()=>{if(k.isNull(c)){if(y.hasNextPage&&!y.isFetchingNextPage)y.fetchNextPage();else if(!y.hasNextPage&&y.isSuccess){const $=y.isSuccess?y.data.pages.flatMap(P=>P.data):[];r($)}}},[y.hasNextPage,y.isFetchingNextPage,y.isSuccess]),_.useEffect(()=>{const $=_e(o,h.id);if($){const P=$.apiKey,b=$.diceRendering;u?(P!==void 0&&P!==u.apiKey||b!==u.diceRendering)&&f({...$}):f({...$})}},[o]),_.useEffect(()=>{var P,b;const $=async()=>{var T;let N;a(!1),(u==null?void 0:u.apiKey)!==v&&(u==null?void 0:u.apiKey)!==void 0&&(j(u==null?void 0:u.apiKey),p((T=o==null?void 0:o.diceRoom)==null?void 0:T.slug),N=await ws(o,g),N&&(n(N),w(await $s(N)))),a(!0)};(u&&u.apiKey!==void 0||!u)&&!(o!=null&&o.disableDiceRoller)&&u!=null&&u.apiKey&&$(),t&&((P=o==null?void 0:o.diceRoom)!=null&&P.slug)&&((b=o==null?void 0:o.diceRoom)==null?void 0:b.slug)!==m&&(p(o.diceRoom.slug),ks(t,o,g))},[u,o==null?void 0:o.disableDiceRoller,(D=o==null?void 0:o.diceRoom)==null?void 0:D.slug]),_.useEffect(()=>{const $=async()=>{var b;if(!k.isNull(c)&&c.length>0)i(c[0]),o&&await re(o,Z.player.id,{diceTheme:c[0].id});else{const N=(b=await(t==null?void 0:t.theme.get("dddice-bees")))==null?void 0:b.data;N&&(i(N),o&&await re(o,Z.player.id,{diceTheme:N.id}))}},P=async()=>{var b,N,T;if(l)!k.isNull(c)&&!c.includes(l)&&await $();else{const V=(N=(b=o==null?void 0:o.diceUser)==null?void 0:b.find(I=>I.playerId===h.id))==null?void 0:N.diceTheme;if(V&&!k.isNull(c)&&c.map(I=>I.id).includes(V)){const I=(T=await(t==null?void 0:t.theme.get(V)))==null?void 0:T.data;I&&i(I)}else await $()}};t&&!k.isNull(c)&&P()},[t,y.isSuccess,u==null?void 0:u.diceTheme,c]),e.jsx(xi,{className:s.classes,user:g})};export{$i as D,wi as S};
